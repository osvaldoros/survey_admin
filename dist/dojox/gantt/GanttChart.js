//>>built
define(["dijit","dojo","dojox","dojo/require!dijit/Tooltip,dojox/gantt/GanttProjectItem,dojox/gantt/GanttResourceItem,dojox/gantt/TabMenu,dojo/date/locale"],function(j,c,h){c.provide("dojox.gantt.GanttChart");c.require("dijit.Tooltip");c.require("dojox.gantt.GanttProjectItem");c.require("dojox.gantt.GanttResourceItem");c.require("dojox.gantt.TabMenu");c.require("dojo.date.locale");(function(){c.declare("dojox.gantt.GanttChart",null,{constructor:function(b,a){this.resourceChartHeight=b.resourceChartHeight!==
void 0?b.resourceChartHeight:!1;this.withResource=b.withResource!==void 0?b.withResource:!0;this.correctError=b.autoCorrectError!==void 0?b.autoCorrectError:!1;this.isShowConMenu=this.isContentEditable=!b.readOnly;this.withTaskId=b.withTaskId!==void 0?b.withTaskId:!b.readOnly;this.animation=b.animation!==void 0?b.animation:!0;this.saveProgramPath=b.saveProgramPath||"saveGanttData.php";this.dataFilePath=b.dataFilePath||"gantt_default.json";this.contentHeight=b.height||400;this.contentWidth=b.width||
600;this.content=c.byId(a);this.scrollBarWidth=18;this.panelTimeHeight=102;this.maxWidthTaskNames=this.maxWidthPanelNames=150;this.minWorkLength=8;this.heightTaskItem=12;this.heightTaskItemExtra=11;this.pixelsPerDay=24;this.hsPerDay=8;this.pixelsPerWorkHour=this.pixelsPerDay/this.hsPerDay;this.pixelsPerHour=this.pixelsPerDay/24;this.totalDays=this.countDays=0;this.startDate=null;this.contentDataHeight=this.initialPos=0;this.panelTimeExpandDelta=20;this.tabMenu=this.contentData=this.panelTime=this.panelNames=
this.divTimeInfo=null;this.project=[];this.arrProjects=[];this.xmlLoader=null;this.isResizing=this.isMoving=!1;this.animationNodes=[];this.scale=1;this.tempDayInPixels=0;this.resource=null;this.months=c.date.locale.getNames("months","wide");this._events=[]},getProject:function(b){return c.filter(this.arrProjects,function(a){return a.project.id==b},this)[0]},checkPosPreviousTask:function(b,a){var d=this.getWidthOnDuration(b.duration),c=this.getPosOnDate(b.startTime),f=this.getPosOnDate(a.startTime);
if(d+c>f)return!1;return!0},correctPosPreviousTask:function(b,a,d){var c=new Date(b.startTime);c.setHours(c.getHours()+b.duration/this.hsPerDay*24);c.getHours()>0&&(c.setHours(0),c.setDate(c.getDate()+1));d?d.setStartTime(c,!0):a.startTime=c;if(a.parentTask&&!this.checkPosParentTask(a.parentTask,a))b=new Date(a.parentTask.startTime),b.setHours(b.getHours()+a.parentTask.duration/this.hsPerDay*24),a.duration=parseInt(parseInt((b-a.startTime)/36E5)*this.hsPerDay/24)},correctPosParentTask:function(b,
a){if(a.previousTask)this.correctPosPreviousTask(a.previousTask,a);else{if(b.startTime>a.startTime)a.startTime=new Date(b.startTime);if(!this.checkPosParentTask(b,a))a.duration=b.duration}},checkPosParentTaskInTree:function(b){for(var a=!1,d=0;d<b.cldTasks.length;d++){var c=b.cldTasks[d];if(!this.checkPosParentTask(b,c))if(this.correctError)this.correctPosParentTask(b,c);else return!0;if(b.startTime>c.startTime)if(this.correctError)this.correctPosParentTask(b,c);else return!0;c.cldTasks.length>0&&
(a=this.checkPosParentTaskInTree(c))}return a},setPreviousTask:function(b){for(var a=!1,d=0;d<b.parentTasks.length;d++){a=b.parentTasks[d];if(a.previousTaskId){a.previousTask=b.getTaskById(a.previousTaskId);if(!a.previousTask&&!this.correctError)return!0;a.previousTask.cldPreTasks.push(a)}if(a.previousTask&&!this.checkPosPreviousTask(a.previousTask,a))if(this.correctError)this.correctPosPreviousTask(a.previousTask,a);else return!0;a=this.setPreviousTaskInTree(a)}return a},setPreviousTaskInTree:function(b){for(var a=
!1,d=0;d<b.cldTasks.length;d++){var c=b.cldTasks[d];if(c.previousTaskId){c.previousTask=b.project.getTaskById(c.previousTaskId);if(!c.previousTask&&!this.correctError)return!0;if(!this.checkPosPreviousTask(c.previousTask,c))if(this.correctError)this.correctPosPreviousTask(c.previousTask,c);else return!0;c.previousTask.cldPreTasks.push(c)}c.cldTasks.length>0&&(a=this.setPreviousTaskInTree(c))}return a},checkPosParentTask:function(b,a){var d=this.getWidthOnDuration(b.duration),c=this.getPosOnDate(b.startTime),
f=this.getPosOnDate(a.startTime),g=this.getWidthOnDuration(a.duration);return d+c>=f+g},addProject:function(b){this.project.push(b)},deleteProject:function(b){var a=this.getProject(b);if(a){if(a.arrTasks.length>0)for(;a.arrTasks.length>0;)a.deleteChildTask(a.arrTasks[0]);var d=this.heightTaskItemExtra+this.heightTaskItem;a.nextProject&&a.shiftNextProject(a,-d);this.project=c.filter(this.project,function(b){return b.id!=a.project.id},this);if(a.previousProject&&a.nextProject)d=a.previousProject,d.nextProject=
a.nextProject;if(a.previousProject&&!a.nextProject)d=a.previousProject,d.nextProject=null;if(!a.previousProject&&a.nextProject)a.nextProject.previousProject=null;for(d=0;d<this.arrProjects.length;d++)this.arrProjects[d].project.id==b&&this.arrProjects.splice(d,1);a.projectItem[0].parentNode.removeChild(a.projectItem[0]);a.descrProject.parentNode.removeChild(a.descrProject);a.projectNameItem.parentNode.removeChild(a.projectNameItem);this.contentDataHeight-=this.heightTaskItemExtra+this.heightTaskItem;
this.project.length==0&&(b=new Date(this.startDate),b=new Date(b.setDate(b.getDate()+1)),b=new h.gantt.GanttProjectItem({id:1,name:"New Project",startDate:b}),this.project.push(b),a=new h.gantt.GanttProjectControl(this,b),a.create(),this.arrProjects.push(a),this.contentDataHeight+=this.heightTaskItemExtra+this.heightTaskItem);this.checkPosition()}},insertProject:function(b,a,c){if(this.startDate>=c)return!1;if(this.getProject(b))return!1;this.checkHeighPanelTasks();b=new h.gantt.GanttProjectItem({id:b,
name:a,startDate:c});this.project.push(b);b=new h.gantt.GanttProjectControl(this,b);for(a=0;a<this.arrProjects.length;a++){var e=this.arrProjects[a-1],f=this.arrProjects[a+1];if(c<this.arrProjects[a].project.startDate){this.arrProjects.splice(a,0,b);if(a>0)b.previousProject=e,e.nextProject=b;if(a+1<=this.arrProjects.length)b.nextProject=f,f.previousProject=b,b.shiftNextProject(b,this.heightTaskItem+this.heightTaskItemExtra);b.create();b.hideDescrProject();this.checkPosition();return b}}if(this.arrProjects.length>
0)this.arrProjects[this.arrProjects.length-1].nextProject=b,b.previousProject=this.arrProjects[this.arrProjects.length-1];this.arrProjects.push(b);b.create();b.hideDescrProject();this.checkPosition();return b},openTree:function(b){var a=this.getLastCloseParent(b);this.openNode(a);b.taskItem.id!=a.taskItem.id&&this.openTree(b)},openNode:function(b){if(!b.isExpanded)c.removeClass(b.cTaskNameItem[2],"ganttImageTreeExpand"),c.addClass(b.cTaskNameItem[2],"ganttImageTreeCollapse"),b.isExpanded=!0,b.shiftCurrentTasks(b,
b.hideTasksHeight),b.showChildTasks(b,b.isExpanded),b.hideTasksHeight=0},getLastCloseParent:function(b){return b.parentTask?!b.parentTask.isExpanded||b.parentTask.cTaskNameItem[2].style.display=="none"?this.getLastCloseParent(b.parentTask):b:b},getProjectItemById:function(b){return c.filter(this.project,function(a){return a.id==b},this)[0]},clearAll:function(){this.contentDataHeight=0;this.startDate=null;this.clearData();this.clearItems();this.clearEvents()},clearEvents:function(){c.forEach(this._events,
c.disconnect);this._events=[]},clearData:function(){this.project=[];this.arrProjects=[]},clearItems:function(){this.contentData.removeChild(this.contentData.firstChild);this.contentData.appendChild(this.createPanelTasks());this.panelNames.removeChild(this.panelNames.firstChild);this.panelNames.appendChild(this.createPanelNamesTasks());this.panelTime.removeChild(this.panelTime.firstChild)},buildUIContent:function(){this.project.sort(this.sortProjStartDate);this.startDate=this.getStartDate();this.panelTime.appendChild(this.createPanelTime());
for(var b=0;b<this.project.length;b++){for(var a=this.project[b],c=0;c<a.parentTasks.length;c++){var e=a.parentTasks[c];if(e.startTime)this.setStartTimeChild(e);else return;if(this.setPreviousTask(a))return}for(c=0;c<a.parentTasks.length;c++){e=a.parentTasks[c];if(e.startTime<a.startDate)return;if(this.checkPosParentTaskInTree(e))return}this.sortTasksByStartTime(a)}for(b=0;b<this.project.length;b++){a=this.project[b];a=new h.gantt.GanttProjectControl(this,a);if(this.arrProjects.length>0)c=this.arrProjects[this.arrProjects.length-
1],a.previousProject=c,c.nextProject=a;a.create();this.checkHeighPanelTasks();this.arrProjects.push(a);this.createTasks(a)}this.resource&&this.resource.reConstruct();this.postLoadData();this.postBindEvents()},loadJSONData:function(b){var a=this;a.dataFilePath=b||a.dataFilePath;c.xhrGet({url:a.dataFilePath,sync:!0,load:function(b){a.loadJSONString(b);a.buildUIContent();alert("Successfully! Loaded data from: "+a.dataFilePath)},error:function(){alert("Failed! Load error: "+a.dataFilePath)}})},loadJSONString:function(b){if(b)this.clearAll(),
b=c.fromJson(b).items,c.forEach(b,function(a){var b=a.startdate.split("-"),e=new h.gantt.GanttProjectItem({id:a.id,name:a.name,startDate:new Date(b[0],parseInt(b[1])-1,b[2])});c.forEach(a.tasks,function(a){var b=a.id,c=a.name,d=a.starttime.split("-");duration=a.duration;percentage=a.percentage;previousTaskId=a.previousTaskId;taskOwner=a.taskOwner;b=new h.gantt.GanttTaskItem({id:b,name:c,startTime:new Date(d[0],parseInt(d[1])-1,d[2]),duration:duration,percentage:percentage,previousTaskId:previousTaskId,
taskOwner:taskOwner});a=a.children;a.length!=0&&this.buildChildTasksData(b,a);e.addTask(b)},this);this.addProject(e)},this)},buildChildTasksData:function(b,a){a&&c.forEach(a,function(a){var c=a.id,f=a.name,g=a.starttime.split("-"),k=a.duration,l=a.percentage,i=a.previousTaskId,j=a.taskOwner,c=new h.gantt.GanttTaskItem({id:c,name:f,startTime:new Date(g[0],parseInt(g[1])-1,g[2]),duration:k,percentage:l,previousTaskId:i,taskOwner:j});c.parentTask=b;b.addChildTask(c);a=a.children;a.length!=0&&this.buildChildTasksData(c,
a)},this)},getJSONData:function(){var b={identifier:"id",items:[]};c.forEach(this.project,function(a){var d={id:a.id,name:a.name,startdate:a.startDate.getFullYear()+"-"+(a.startDate.getMonth()+1)+"-"+a.startDate.getDate(),tasks:[]};b.items.push(d);c.forEach(a.parentTasks,function(a){a={id:a.id,name:a.name,starttime:a.startTime.getFullYear()+"-"+(a.startTime.getMonth()+1)+"-"+a.startTime.getDate(),duration:a.duration,percentage:a.percentage,previousTaskId:a.previousTaskId||"",taskOwner:a.taskOwner||
"",children:this.getChildTasksData(a.cldTasks)};d.tasks.push(a)},this)},this);return b},getChildTasksData:function(b){var a=[];b&&b.length>0&&c.forEach(b,function(b){b={id:b.id,name:b.name,starttime:b.startTime.getFullYear()+"-"+(b.startTime.getMonth()+1)+"-"+b.startTime.getDate(),duration:b.duration,percentage:b.percentage,previousTaskId:b.previousTaskId||"",taskOwner:b.taskOwner||"",children:this.getChildTasksData(b.cldTasks)};a.push(b)},this);return a},saveJSONData:function(b){var a=this;a.dataFilePath=
b&&c.trim(b).length>0?b:this.dataFilePath;try{c.xhrPost({url:a.saveProgramPath,content:{filename:a.dataFilePath,data:c.toJson(a.getJSONData())},handle:function(b,d){c._isDocumentOk(d.xhr)||d.xhr.status==405?alert("Successfully! Saved data to "+a.dataFilePath):alert("Failed! Saved error")}})}catch(d){alert("exception: "+d.message)}},sortTaskStartTime:function(b,a){return b.startTime<a.startTime?-1:b.startTime>a.startTime?1:0},sortProjStartDate:function(b,a){return b.startDate<a.startDate?-1:b.startDate>
a.startDate?1:0},setStartTimeChild:function(b){c.forEach(b.cldTasks,function(a){if(!a.startTime)a.startTime=b.startTime;a.cldTasks.length!=0&&this.setStartTimeChild(a)},this)},createPanelTasks:function(){var b=c.create("div",{className:"ganttTaskPanel"});c.style(b,{height:this.contentHeight-this.panelTimeHeight-this.scrollBarWidth+"px"});return b},refreshParams:function(b){this.pixelsPerDay=b;this.pixelsPerWorkHour=this.pixelsPerDay/this.hsPerDay;this.pixelsPerHour=this.pixelsPerDay/24},createPanelNamesTasksHeader:function(){var b=
c.create("div",{className:"ganttPanelHeader"}),a=c.create("table",{cellPadding:"0px",border:"0px",cellSpacing:"0px",bgColor:"#FFFFFF",className:"ganttToolbar"},b),d=a.insertRow(a.rows.length),e=a.insertRow(a.rows.length),f=a.insertRow(a.rows.length);a.insertRow(a.rows.length);var a=c.create("td",{align:"center",vAlign:"middle",className:"ganttToolbarZoomIn"},d),g=c.hitch(this,function(){this.scale*2>5||(this.scale*=2,this.switchTeleMicroView(this.pixelsPerDay*this.scale))});c.disconnect(this.zoomInClickEvent);
this.zoomInClickEvent=c.connect(a,"onclick",this,g);c.disconnect(this.zoomInKeyEvent);this.zoomInKeyEvent=c.connect(a,"onkeydown",this,function(a){a.keyCode==c.keys.ENTER&&g()});c.attr(a,"tabIndex",0);var d=c.create("td",{align:"center",vAlign:"middle",className:"ganttToolbarZoomOut"},d),k=c.hitch(this,function(){this.scale*0.5<0.2||(this.scale*=0.5,this.switchTeleMicroView(this.pixelsPerDay*this.scale))});c.disconnect(this.zoomOutClickEvent);this.zoomOutClickEvent=c.connect(d,"onclick",this,k);c.disconnect(this.zoomOutKeyEvent);
this.zoomOutKeyEvent=c.connect(d,"onkeydown",this,function(a){a.keyCode==c.keys.ENTER&&k()});c.attr(d,"tabIndex",0);var h=c.create("td",{align:"center",vAlign:"middle",className:"ganttToolbarMicro"},e);c.disconnect(this.microClickEvent);this.microClickEvent=c.connect(h,"onclick",this,c.hitch(this,this.refresh,this.animation?15:1,0,2));c.disconnect(this.microKeyEvent);this.microKeyEvent=c.connect(h,"onkeydown",this,function(a){a.keyCode==c.keys.ENTER&&(h.blur(),this.refresh(this.animation?15:1,0,2))});
c.attr(h,"tabIndex",0);var i=c.create("td",{align:"center",vAlign:"middle",className:"ganttToolbarTele"},e);c.disconnect(this.teleClickEvent);this.teleClickEvent=c.connect(i,"onclick",this,c.hitch(this,this.refresh,this.animation?15:1,0,0.5));c.disconnect(this.teleKeyEvent);this.teleKeyEvent=c.connect(i,"onkeydown",this,function(a){a.keyCode==c.keys.ENTER&&(i.blur(),this.refresh(this.animation?15:1,0,0.5))});c.attr(i,"tabIndex",0);e=c.create("td",{align:"center",vAlign:"middle",className:"ganttToolbarSave"},
f);c.disconnect(this.saveClickEvent);this.saveClickEvent=c.connect(e,"onclick",this,c.hitch(this,this.saveJSONData,""));c.disconnect(this.saveKeyEvent);this.saveKeyEvent=c.connect(e,"onkeydown",this,function(a){a.keyCode==c.keys.ENTER&&this.saveJSONData("")});c.attr(e,"tabIndex",0);f=c.create("td",{align:"center",vAlign:"middle",className:"ganttToolbarLoad"},f);c.disconnect(this.loadClickEvent);this.loadClickEvent=c.connect(f,"onclick",this,c.hitch(this,this.loadJSONData,""));c.disconnect(this.loadKeyEvent);
this.loadKeyEvent=c.connect(f,"onkeydown",this,function(a){a.keyCode==c.keys.ENTER&&this.loadJSONData("")});c.attr(f,"tabIndex",0);var m=["Enlarge timeline","Shrink timeline","Zoom in time zone(microscope view)","Zoom out time zone(telescope view)","Save gantt data to json file","Load gantt data from json file"];c.forEach([a,d,h,i,e,f],function(a,b){var d=m[b],e=function(){c.addClass(a,"ganttToolbarActionHover");j.showTooltip(d,a,["above","below"])};a.onmouseover=e;a.onfocus=e;e=function(){c.removeClass(a,
"ganttToolbarActionHover");a&&j.hideTooltip(a)};a.onmouseout=e;a.onblur=e},this);return b},createPanelNamesTasks:function(){var b=c.create("div",{innerHTML:"&nbsp;",className:"ganttPanelNames"});c.style(b,{height:this.contentHeight-this.panelTimeHeight-this.scrollBarWidth+"px",width:this.maxWidthPanelNames+"px"});return b},createPanelTime:function(){var b=c.create("div",{className:"ganttPanelTime"}),a=c.create("table",{cellPadding:"0px",border:"0px",cellSpacing:"0px",bgColor:"#FFFFFF",className:"ganttTblTime"},
b);this.totalDays=this.countDays;for(var d=a.insertRow(a.rows.length),e=oldYear=(new Date(this.startDate)).getFullYear(),f=0,g=0;g<this.countDays;g++,f++)e=new Date(this.startDate),e.setDate(e.getDate()+g),e=e.getFullYear(),e!=oldYear&&(this.addYearInPanelTime(d,f,oldYear),f=0,oldYear=e);this.addYearInPanelTime(d,f,e);c.style(d,"display","none");for(var f=a.insertRow(a.rows.length),h=oldMonth=(new Date(this.startDate)).getMonth(),d=0,e=1970,g=0;g<this.countDays;g++,d++)e=new Date(this.startDate),
e.setDate(e.getDate()+g),h=e.getMonth(),e=e.getFullYear(),h!=oldMonth&&(this.addMonthInPanelTime(f,d,oldMonth,e),d=0,oldMonth=h);this.addMonthInPanelTime(f,d,h,e);f=a.insertRow(a.rows.length);e=oldWeek=c.date.locale._getWeekOfYear(new Date(this.startDate));for(g=d=0;g<this.countDays;g++,d++)e=new Date(this.startDate),e.setDate(e.getDate()+g),e=c.date.locale._getWeekOfYear(e),e!=oldWeek&&(this.addWeekInPanelTime(f,d,oldWeek),d=0,oldWeek=e);this.addWeekInPanelTime(f,d,e);e=a.insertRow(a.rows.length);
for(g=0;g<this.countDays;g++)this.addDayInPanelTime(e);a=a.insertRow(a.rows.length);for(g=0;g<this.countDays;g++)this.addHourInPanelTime(a);c.style(a,"display","none");return b},adjustPanelTime:function(){var b=c.map(this.arrProjects,function(a){return parseInt(a.projectItem[0].style.left)+parseInt(a.projectItem[0].firstChild.style.width)+a.descrProject.offsetWidth+this.panelTimeExpandDelta},this).sort(function(a,b){return b-a})[0];if(this.maxTaskEndPos!=b){for(var a=this.panelTime.firstChild.firstChild.rows,
d=0;d<=4;d++)this.removeCell(a[d]);var e=Math.round((b+this.panelTimeExpandDelta)/this.pixelsPerDay);this.totalDays=e;for(var f=oldYear=(new Date(this.startDate)).getFullYear(),g=0,d=0;d<e;d++,g++)f=new Date(this.startDate),f.setDate(f.getDate()+d),f=f.getFullYear(),f!=oldYear&&(this.addYearInPanelTime(a[0],g,oldYear),g=0,oldYear=f);this.addYearInPanelTime(a[0],g,f);for(var h=oldMonth=(new Date(this.startDate)).getMonth(),g=0,f=1970,d=0;d<e;d++,g++)f=new Date(this.startDate),f.setDate(f.getDate()+
d),h=f.getMonth(),f=f.getFullYear(),h!=oldMonth&&(this.addMonthInPanelTime(a[1],g,oldMonth,f),g=0,oldMonth=h);this.addMonthInPanelTime(a[1],g,h,f);f=oldWeek=c.date.locale._getWeekOfYear(new Date(this.startDate));for(d=g=0;d<e;d++,g++)f=new Date(this.startDate),f.setDate(f.getDate()+d),f=c.date.locale._getWeekOfYear(f),f!=oldWeek&&(this.addWeekInPanelTime(a[2],g,oldWeek),g=0,oldWeek=f);this.addWeekInPanelTime(a[2],g,f);for(d=0;d<e;d++)this.addDayInPanelTime(a[3]);for(d=0;d<e;d++)this.addHourInPanelTime(a[4]);
this.panelTime.firstChild.firstChild.style.width=this.pixelsPerDay*a[3].cells.length+"px";this.contentData.firstChild.style.width=this.pixelsPerDay*a[3].cells.length+"px";this.maxTaskEndPos=b}},addYearInPanelTime:function(b,a,d){d="Year   "+d;b=c.create("td",{colSpan:a,align:"center",vAlign:"middle",className:"ganttYearNumber",innerHTML:this.pixelsPerDay*a>20?d:"",innerHTMLData:d},b);c.style(b,"width",this.pixelsPerDay*a+"px")},addMonthInPanelTime:function(b,a,d,e){d=this.months[d]+(e?" of "+e:"");
b=c.create("td",{colSpan:a,align:"center",vAlign:"middle",className:"ganttMonthNumber",innerHTML:this.pixelsPerDay*a>30?d:"",innerHTMLData:d},b);c.style(b,"width",this.pixelsPerDay*a+"px")},addWeekInPanelTime:function(b,a,d){d="Week   "+d;b=c.create("td",{colSpan:a,align:"center",vAlign:"middle",className:"ganttWeekNumber",innerHTML:this.pixelsPerDay*a>20?d:"",innerHTMLData:d},b);c.style(b,"width",this.pixelsPerDay*a+"px")},addDayInPanelTime:function(b){var a=new Date(this.startDate);a.setDate(a.getDate()+
parseInt(b.cells.length));var d=c.create("td",{align:"center",vAlign:"middle",className:"ganttDayNumber",innerHTML:this.pixelsPerDay>20?a.getDate():"",innerHTMLData:String(a.getDate()),data:b.cells.length},b);c.style(d,"width",this.pixelsPerDay+"px");a.getDay()>=5&&c.addClass(d,"ganttDayNumberWeekend");this._events.push(c.connect(d,"onmouseover",this,function(a){var a=a.target||a.srcElement,b=new Date(this.startDate.getTime());b.setDate(b.getDate()+parseInt(c.attr(a,"data")));j.showTooltip(b.getFullYear()+
"."+(b.getMonth()+1)+"."+b.getDate(),d,["above","below"])}));this._events.push(c.connect(d,"onmouseout",this,function(a){(a=a.target||a.srcElement)&&j.hideTooltip(a)}))},addHourInPanelTime:function(b){b=c.create("td",{align:"center",vAlign:"middle",className:"ganttHourNumber",data:b.cells.length},b);c.style(b,"width",this.pixelsPerDay+"px");for(var b=c.create("table",{cellPadding:"0",cellSpacing:"0"},b),b=b.insertRow(b.rows.length),a=0;a<this.hsPerDay;a++){var d=c.create("td",{className:"ganttHourClass"},
b);c.style(d,"width",this.pixelsPerDay/this.hsPerDay+"px");c.attr(d,"innerHTMLData",String(9+a));this.pixelsPerDay/this.hsPerDay>5&&c.attr(d,"innerHTML",String(9+a));c.addClass(d,a<=3?"ganttHourNumberAM":"ganttHourNumberPM")}},incHeightPanelTasks:function(b){var a=this.contentData.firstChild;a.style.height=parseInt(a.style.height)+b+"px"},incHeightPanelNames:function(b){var a=this.panelNames.firstChild;a.style.height=parseInt(a.style.height)+b+"px"},checkPosition:function(){c.forEach(this.arrProjects,
function(b){c.forEach(b.arrTasks,function(a){a.checkPosition()},this)},this)},checkHeighPanelTasks:function(){this.contentDataHeight+=this.heightTaskItemExtra+this.heightTaskItem;parseInt(this.contentData.firstChild.style.height)<=this.contentDataHeight&&(this.incHeightPanelTasks(this.heightTaskItem+this.heightTaskItemExtra),this.incHeightPanelNames(this.heightTaskItem+this.heightTaskItemExtra))},sortTasksByStartTime:function(b){b.parentTasks.sort(this.sortTaskStartTime);for(var a=0;a<b.parentTasks.length;a++)b.parentTasks[a]=
this.sortChildTasks(b.parentTasks[a])},sortChildTasks:function(b){b.cldTasks.sort(this.sortTaskStartTime);for(var a=0;a<b.cldTasks.length;a++)b.cldTasks[a].cldTasks.length>0&&this.sortChildTasks(b.cldTasks[a]);return b},refresh:function(b,a,d){if(!(this.arrProjects.length<=0)&&!(this.arrProjects[0].arrTasks.length<=0))if(!b||a>b)this.refreshController(),this.resource&&this.resource.refresh(),this.tempDayInPixels=0,this.panelNameHeadersCover&&c.style(this.panelNameHeadersCover,"display","none");else{if(this.tempDayInPixels==
0)this.tempDayInPixels=this.pixelsPerDay;this.panelNameHeadersCover&&c.style(this.panelNameHeadersCover,"display","");this.refreshParams(this.tempDayInPixels+this.tempDayInPixels*(d-1)*Math.pow(a/b,2));c.forEach(this.arrProjects,function(a){c.forEach(a.arrTasks,function(a){a.refresh()},this);a.refresh()},this);setTimeout(c.hitch(this,function(){this.refresh(b,++a,d)}),15)}},switchTeleMicroView:function(b){for(var a=this.panelTime.firstChild.firstChild,d=0;d<5;d++)b>40?c.style(a.rows[d],"display",
d==0||d==1?"none":""):b<20?c.style(a.rows[d],"display",d==2||d==4?"none":""):c.style(a.rows[d],"display",d==0||d==4?"none":"")},refreshController:function(){this.contentData.firstChild.style.width=Math.max(1200,this.pixelsPerDay*this.totalDays)+"px";this.panelTime.firstChild.style.width=this.pixelsPerDay*this.totalDays+"px";this.panelTime.firstChild.firstChild.style.width=this.pixelsPerDay*this.totalDays+"px";this.switchTeleMicroView(this.pixelsPerDay);c.forEach(this.panelTime.firstChild.firstChild.rows,
function(b){c.forEach(b.childNodes,function(a){var b=parseInt(c.attr(a,"colSpan")||1),e=c.trim(c.attr(a,"innerHTMLData")||"");e.length>0?c.attr(a,"innerHTML",this.pixelsPerDay*b<20?"":e):c.forEach(a.firstChild.rows[0].childNodes,function(a){var b=c.trim(c.attr(a,"innerHTMLData")||"");c.attr(a,"innerHTML",this.pixelsPerDay/this.hsPerDay>10?b:"")},this);b==1&&(c.style(a,"width",this.pixelsPerDay*b+"px"),e.length<=0&&c.forEach(a.firstChild.rows[0].childNodes,function(a){c.style(a,"width",this.pixelsPerDay*
b/this.hsPerDay+"px")},this))},this)},this)},init:function(){this.startDate=this.getStartDate();c.style(this.content,{width:this.contentWidth+"px",height:this.contentHeight+"px"});this.tableControl=c.create("table",{cellPadding:"0",cellSpacing:"0",className:"ganttTabelControl"});var b=this.tableControl.insertRow(this.tableControl.rows.length);this.content.appendChild(this.tableControl);this.countDays=this.getCountDays();this.panelTime=c.create("div",{className:"ganttPanelTimeContainer"});c.style(this.panelTime,
"height",this.panelTimeHeight+"px");this.panelTime.appendChild(this.createPanelTime());this.contentData=c.create("div",{className:"ganttContentDataContainer"});c.style(this.contentData,"height",this.contentHeight-this.panelTimeHeight+"px");this.contentData.appendChild(this.createPanelTasks());var a=c.create("td",{vAlign:"top"});this.panelNameHeaders=c.create("div",{className:"ganttPanelNameHeaders"},a);c.style(this.panelNameHeaders,{height:this.panelTimeHeight+"px",width:this.maxWidthPanelNames+"px"});
this.panelNameHeaders.appendChild(this.createPanelNamesTasksHeader());this.panelNames=c.create("div",{className:"ganttPanelNamesContainer"},a);this.panelNames.appendChild(this.createPanelNamesTasks());b.appendChild(a);var a=c.create("td",{vAlign:"top"}),d=c.create("div",{className:"ganttDivCell"});d.appendChild(this.panelTime);d.appendChild(this.contentData);a.appendChild(d);b.appendChild(a);c.style(this.panelNames,"height",this.contentHeight-this.panelTimeHeight-this.scrollBarWidth+"px");c.style(this.panelNames,
"width",this.maxWidthPanelNames+"px");c.style(this.contentData,"width",this.contentWidth-this.maxWidthPanelNames+"px");c.style(this.contentData.firstChild,"width",this.pixelsPerDay*this.countDays+"px");c.style(this.panelTime,"width",this.contentWidth-this.maxWidthPanelNames-this.scrollBarWidth+"px");c.style(this.panelTime.firstChild,"width",this.pixelsPerDay*this.countDays+"px");if(this.isShowConMenu)this.tabMenu=new h.gantt.TabMenu(this);var e=this;this.contentData.onscroll=function(){e.panelTime.scrollLeft=
this.scrollLeft;if(e.panelNames)e.panelNames.scrollTop=this.scrollTop,e.isShowConMenu&&e.tabMenu.hide();if(e.resource)e.resource.contentData.scrollLeft=this.scrollLeft};this.project.sort(this.sortProjStartDate);for(b=0;b<this.project.length;b++){a=this.project[b];for(d=0;d<a.parentTasks.length;d++){var f=a.parentTasks[d];if(!f.startTime)f.startTime=a.startDate;this.setStartTimeChild(f);if(this.setPreviousTask(a))return}for(d=0;d<a.parentTasks.length;d++){f=a.parentTasks[d];if(f.startTime<a.startDate)if(this.correctError)f.startTime=
a.startDate;else return;if(this.checkPosParentTaskInTree(f))return}this.sortTasksByStartTime(a)}for(b=0;b<this.project.length;b++){a=this.project[b];a=new h.gantt.GanttProjectControl(this,a);if(this.arrProjects.length>0)d=this.arrProjects[this.arrProjects.length-1],a.previousProject=d,d.nextProject=a;a.create();this.checkHeighPanelTasks();this.arrProjects.push(a);this.createTasks(a)}if(this.withResource)this.resource=new h.gantt.GanttResourceItem(this),this.resource.create();this.postLoadData();this.postBindEvents();
return this},postLoadData:function(){c.forEach(this.arrProjects,function(a){c.forEach(a.arrTasks,function(a){a.postLoadData()},this);a.postLoadData()},this);var b=c.coords(this.panelNameHeaders);if(!this.panelNameHeadersCover)this.panelNameHeadersCover=c.create("div",{className:"ganttHeaderCover"},this.panelNameHeaders.parentNode),c.style(this.panelNameHeadersCover,{left:b.l+"px",top:b.t+"px",height:b.h+"px",width:b.w+"px",display:"none"})},postBindEvents:function(){var b=c.position(this.tableControl,
!0);!c.isIE&&this._events.push(c.connect(this.tableControl,"onmousemove",this,function(a){var d=a.srcElement||a.target;if(d==this.panelNames.firstChild||d==this.contentData.firstChild){d=this.heightTaskItem+this.heightTaskItemExtra;a=parseInt(a.layerY/d)*d+this.panelTimeHeight-this.contentData.scrollTop;if(a!=this.oldHLTop&&a<b.h-50)this.highLightDiv?c.style(this.highLightDiv,"top",b.y+a+"px"):(this.highLightDiv=c.create("div",{className:"ganttRowHighlight"},c.body()),c.style(this.highLightDiv,{top:b.y+
a+"px",left:b.x+"px",width:b.w-20+"px",height:d+"px"}));this.oldHLTop=a}}))},getStartDate:function(){c.forEach(this.project,function(b){if(this.startDate){if(b.startDate<this.startDate)this.startDate=new Date(b.startDate)}else this.startDate=new Date(b.startDate)},this);this.initialPos=24*this.pixelsPerHour;return this.startDate?new Date(this.startDate.setHours(this.startDate.getHours()-24)):new Date},getCountDays:function(){return parseInt((this.contentWidth-this.maxWidthPanelNames)/(this.pixelsPerHour*
24))},createTasks:function(b){c.forEach(b.project.parentTasks,function(a,c){if(c>0)b.project.parentTasks[c-1].nextParentTask=a,a.previousParentTask=b.project.parentTasks[c-1];var e=new h.gantt.GanttTaskControl(a,b,this);b.arrTasks.push(e);e.create();this.checkHeighPanelTasks();a.cldTasks.length>0&&this.createChildItemControls(a.cldTasks,b)},this)},createChildItemControls:function(b,a){b&&c.forEach(b,function(c,e){if(e>0)c.previousChildTask=b[e-1],b[e-1].nextChildTask=c;(new h.gantt.GanttTaskControl(c,
a,this)).create();this.checkHeighPanelTasks();c.cldTasks.length>0&&this.createChildItemControls(c.cldTasks,a)},this)},getPosOnDate:function(b){return(b-this.startDate)/36E5*this.pixelsPerHour},getWidthOnDuration:function(b){return Math.round(this.pixelsPerWorkHour*b)},getLastChildTask:function(b){return b.childTask.length>0?this.getLastChildTask(b.childTask[b.childTask.length-1]):b},removeCell:function(b){for(;b.cells[0];)b.deleteCell(b.cells[0])}})})()});