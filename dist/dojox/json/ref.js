//>>built
define("dojox/json/ref",["dojo/_base/kernel","dojox","dojo/date/stamp","dojo/_base/array","dojo/_base/json"],function(p,t){p.getObject("json",!0,t);return t.json.ref={resolveJson:function(f,h){function m(d,y,i,a,o,j){var c,w,b,i=n in d?d[n]:i;if(n in d||i!==void 0&&a)i=(q+i).replace(u,"$2$3");a=j||d;if(i!==void 0){if(x)d.__id=i;if(h.schemas&&!(d instanceof Array)&&(b=i.match(/^(.+\/)[^\.\[]*$/)))o=h.schemas[b[1]];if(l[i]&&d instanceof Array==l[i]instanceof Array)a=l[i],delete a.$ref,delete a._loadObject,
w=!0;else if(b=o&&o.prototype)k.prototype=b,a=new k;l[i]=a;if(s)s[i]=h.time}for(;o;){if(b=o.properties)for(c in d){var v=b[c];v&&v.format=="date-time"&&typeof d[c]=="string"&&(d[c]=p.date.stamp.fromISOString(d[c]))}o=o["extends"]}o=d.length;for(c in d){if(c==o)break;if(d.hasOwnProperty(c)){b=d[c];if(typeof b=="object"&&b&&!(b instanceof Date)&&c!="__parent"){g=b[r]||t&&b[n];if((!g||!b.__parent)&&d!=e)b.__parent=a;if(g)if(delete d[c],j=g.toString().replace(/(#)([^\.\[])/,"$1.$2").match(/(^([^\[]*\/)?[^#\.\[]*)#?([\.\[].*)?/),
l[(q+g).replace(u,"$2$3")]?g=l[(q+g).replace(u,"$2$3")]:(g=j[1]=="$"||j[1]=="this"||j[1]==""?f:l[(q+j[1]).replace(u,"$2$3")])&&j[3]&&j[3].replace(/(\[([^\]]+)\])|(\.?([^\.\[]+))/g,function(a,c,b,d,e){g=g&&g[b?b.replace(/[\"\'\\]/,""):e]}),g)b=g;else{if(!y){var z;z||e.push(a);z=!0;b=m(b,!1,b[r],!0,v);b._loadObject=h.loader}}else y||(b=m(b,e==d,i===void 0?void 0:B(i,c),!1,v,a!=d&&typeof a[c]=="object"&&a[c]))}d[c]=b;if(a!=d&&!a.__isDirty&&(j=a[c],a[c]=b,w&&b!==j&&!a._loadObject&&!(c.charAt(0)=="_"&&
c.charAt(1)=="_")&&c!="$ref"&&!(b instanceof Date&&j instanceof Date&&b.getTime()==j.getTime())&&!(typeof b=="function"&&typeof j=="function"&&b.toString()==j.toString())&&l.onUpdate))l.onUpdate(a,c,j,b)}}if(w&&(n in d||a instanceof Array))for(c in a){if(!a.__isDirty&&a.hasOwnProperty(c)&&!d.hasOwnProperty(c)&&!(c.charAt(0)=="_"&&c.charAt(1)=="_")&&!(a instanceof Array&&isNaN(c))){if(l.onUpdate&&c!="_loadObject"&&c!="_idAttr")l.onUpdate(a,c,a[c],void 0);for(delete a[c];a instanceof Array&&a.length&&
a[a.length-1]===void 0;)a.length--}}else if(l.onLoad)l.onLoad(a);return a}var h=h||{},n=h.idAttribute||"id",r=this.refAttribute,t=h.idAsRef,q=h.idPrefix||"",x=h.assignAbsoluteIds,l=h.index||{},s=h.timeStamps,g,e=[],u=/^(.*\/)?(\w+:\/\/)|[^\/\.]+\/\.\.\/|^.*\/(\/)/,B=this._addProp,k=function(){};f&&typeof f=="object"&&(f=m(f,!1,h.defaultId,!0),m(e,!1));return f},fromJson:function(f,h){try{var m=eval("("+f+")")}catch(n){throw new SyntaxError("Invalid JSON string: "+n.message+" parsing: "+f);}if(m)return this.resolveJson(m,
h);return m},toJson:function(f,h,m,n){function r(e,f,g){if(typeof e=="object"&&e){if(e instanceof Date)return'"'+p.date.stamp.toISOString(e,{zulu:!0})+'"';var k=e.__id;if(k){if(f!="#"&&(A&&!k.match(/#/)||l[k]))return g=k,k.charAt(0)!="#"&&(g=e.__clientId==k?"cid:"+k:k.substring(0,m.length)==m?k.substring(m.length):k),e={},e[x]=g,r(e,"#");f=k}else e.__id=f,s[f]=e;l[f]=e;var g=g||"",d=h?g+p.toJsonIndentStr:"",n=h?"\n":"",k=h?" ":"";if(e instanceof Array)return"["+p.map(e,function(a,e){var b=r(a,q(f,
e),d);typeof b!="string"&&(b="undefined");return n+d+b}).join(","+k)+n+g+"]";var i=[],a;for(a in e)if(e.hasOwnProperty(a)){var o;if(typeof a=="number")o='"'+a+'"';else if(typeof a=="string"&&(a.charAt(0)!="_"||a.charAt(1)!="_"))o=p._escapeString(a);else continue;var j=r(e[a],q(f,a),d);typeof j=="string"&&i.push(n+d+o+":"+k+j)}return"{"+i.join(","+k)+n+g+"}"}else if(typeof e=="function"&&t.json.ref.serializeFunctions)return e.toString();return p.toJson(e)}var A=this._useRefs,q=this._addProp,x=this.refAttribute,
m=m||"",l={},s={},f=r(f,"#","");if(!n)for(var g in s)delete s[g].__id;return f},_addProp:function(f,h){return f+(f.match(/#/)?f.length==1?"":".":"#")+h},refAttribute:"$ref",_useRefs:!1,serializeFunctions:!1}});