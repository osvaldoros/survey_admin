//>>built
require({cache:{"url:dojox/grid/resources/Expando.html":'<div class="dojoxGridExpando"\n\t><div class="dojoxGridExpandoNode" dojoAttachEvent="onclick:onToggle"\n\t\t><div class="dojoxGridExpandoNodeInner" dojoAttachPoint="expandoInner"></div\n\t></div\n></div>\n'}});
define("dojox/grid/_TreeView",["dijit/registry","../main","dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/_base/event","dojo/dom-attr","dojo/dom-class","dojo/dom-style","dojo/dom-construct","dojo/query","dojo/parser","dojo/text!./resources/Expando.html","dijit/_Widget","dijit/_TemplatedMixin","./_View","./_Builder","./util"],function(p,z,i,t,u,B,h,g,A,C,f,D,n,E,F,G,H,I){i("dojox.grid._Expando",[E,F],{open:!1,toggleClass:"",itemId:"",cellIdx:-1,view:null,rowNode:null,rowIdx:-1,expandoCell:null,
level:0,templateString:n,_toggleRows:function(a,b){if(a&&this.rowNode)if(f("table.dojoxGridRowTableNeedsRowUpdate").length)this._initialized&&this.view.grid.updateRow(this.rowIdx);else{var c=this;if(this.view.grid.treeModel){var d=this._tableRow?h.get(this._tableRow,"dojoxTreeGridPath"):"";d&&f('tr[dojoxTreeGridPath^="'+d+'/"]',this.rowNode).forEach(function(c){var e=f(".dojoxGridExpando",c)[0];e&&e.parentNode&&e.parentNode.parentNode&&!g.contains(e.parentNode.parentNode,"dojoxGridNoChildren")&&(e=
p.byNode(e))&&e._toggleRows(a,e.open&&b);c.style.display=b?"":"none"})}else f("tr."+a,this.rowNode).forEach(function(a){if(g.contains(a,"dojoxGridExpandoRow")){var e=f(".dojoxGridExpando",a)[0];if(e){var d=p.byNode(e),o=d?d.toggleClass:e.getAttribute("toggleClass"),e=d?d.open:c.expandoCell.getOpenState(e.getAttribute("itemId"));c._toggleRows(o,e&&b)}}a.style.display=b?"":"none"})}},setOpen:function(a){a&&g.contains(this.domNode,"dojoxGridExpandoLoading")&&(a=!1);var b=this.view.grid,c=b.store,d=b.treeModel,
q=this;if(b._by_idx[this.rowIdx])if(d&&!this._loadedChildren)if(a){var e=b.getItem(h.get(this._tableRow,"dojoxTreeGridPath"));e?(this.expandoInner.innerHTML="o",g.add(this.domNode,"dojoxGridExpandoLoading"),d.getChildren(e,function(){q._loadedChildren=!0;q._setOpen(a)})):this._setOpen(a)}else this._setOpen(a);else!d&&c?a?(d=b._by_idx[this.rowIdx])&&!c.isItemLoaded(d.item)?(this.expandoInner.innerHTML="o",g.add(this.domNode,"dojoxGridExpandoLoading"),c.loadItem({item:d.item,onItem:u.hitch(this,function(e){var d=
c.getIdentity(e);b._by_idty[d]=b._by_idx[this.rowIdx]={idty:d,item:e};this._setOpen(a)})})):this._setOpen(a):this._setOpen(a):this._setOpen(a)},_setOpen:function(a){if(a&&this._tableRow&&g.contains(this._tableRow,"dojoxGridNoChildren"))this._setOpen(!1);else{this.expandoInner.innerHTML=a?"-":"+";g.remove(this.domNode,"dojoxGridExpandoLoading");g.toggle(this.domNode,"dojoxGridExpandoOpened",a);if(this._tableRow){g.toggle(this._tableRow,"dojoxGridRowCollapsed",!a);var b=h.get(this._tableRow,"dojoxTreeGridBaseClasses"),
c="",c=a?u.trim((" "+b+" ").replace(" dojoxGridRowCollapsed "," ")):(" "+b+" ").indexOf(" dojoxGridRowCollapsed ")<0?b+(b?" ":"")+"dojoxGridRowCollapsed":b;h.set(this._tableRow,"dojoxTreeGridBaseClasses",c)}b=this.open!==a;this.open=a;this.expandoCell&&this.itemId&&(this.expandoCell.openStates[this.itemId]=a);var c=this.view,d=c.grid;this.toggleClass&&b&&(!this._tableRow||!this._tableRow.style.display)&&this._toggleRows(this.toggleClass,a);c&&this._initialized&&this.rowIdx>=0&&(d.rowHeightChanged(this.rowIdx),
d.postresize(),c.hasVScrollbar(!0));this._initialized=!0}},onToggle:function(a){this.setOpen(!this.open);B.stop(a)},setRowNode:function(a,b,c){if(this.cellIdx<0||!this.itemId)return!1;this._initialized=!1;this.view=c;this.rowNode=b;this.rowIdx=a;this.expandoCell=c.structure.cells[0][this.cellIdx];if((a=this.domNode)&&a.parentNode&&a.parentNode.parentNode)this._tableRow=a.parentNode.parentNode;this.open=this.expandoCell.getOpenState(this.itemId);c.grid.treeModel&&(A.set(this.domNode,"marginLeft",this.level*
18+"px"),this.domNode.parentNode&&A.set(this.domNode.parentNode,"backgroundPosition",this.level*18+3+"px"));this.setOpen(this.open);return!0}});n=i("dojox.grid._TreeContentBuilder",H._ContentBuilder,{generateHtml:function(a,b){var c=this.getTableArray(),d=this.view,q=d.structure.cells[0],e=this.grid.getItem(b),j=this.grid,o=this.grid.store;I.fire(this.view,"onBeforeRow",[b,[q]]);var y=function(a,b,e,g,f,h){if(h){var v=c.length,g=g||[],i=g.join("|"),w=g[g.length-1],k=w+(e?" dojoxGridSummaryRow":"");
j.treeModel&&b&&!j.treeModel.mayHaveChildren(b)&&(k+=" dojoxGridNoChildren");c.push('<tr style="" class="'+k+'" dojoxTreeGridPath="'+f.join("/")+'" dojoxTreeGridBaseClasses="'+k+'">');for(var n=a+1,k=null,r=0,l;l=q[r];r++){var x=l.markup,p=l.customClasses=[],u=l.customStyles=[];x[5]=l.formatAtLevel(f,b,a,e,w,p);x[1]=p.join(" ");x[3]=u.join(";");c.push.apply(c,x);if(!k&&l.level===n&&l.parentCell)k=l.parentCell}c.push("</tr>");b&&o&&o.isItem(b)&&(r=o.getIdentity(b),typeof j._by_idty_paths[r]=="undefined"&&
(j._by_idty_paths[r]=f.join("/")));var s,m=f.concat([]);j.treeModel&&b?j.treeModel.mayHaveChildren(b)&&(e=d.structure.cells[0][j.expandoCell||0],s=e.getOpenState(b)&&h,e=new z.grid.TreePath(f.join("/"),j),e=e.children(!0)||[],t.forEach(e,function(a,b){var c=i.split("|");c.push(c[c.length-1]+"-"+b);m.push(b);y(n,a,!1,c,m,s);m.pop()})):b&&k&&!e?(e=d.structure.cells[0][k.level],s=e.getOpenState(b)&&h,o.hasAttribute(b,k.field)?(h=i.split("|"),h.pop(),e=new z.grid.TreePath(f.join("/"),j),e=e.children(!0)||
[],e.length?(c[v]='<tr class="'+h.join(" ")+' dojoxGridExpandoRow" dojoxTreeGridPath="'+f.join("/")+'">',t.forEach(e,function(a,c){var b=i.split("|");b.push(b[b.length-1]+"-"+c);m.push(c);y(n,a,!1,b,m,s);m.pop()}),m.push(e.length),y(a,b,!0,g,m,s)):c[v]='<tr class="'+w+' dojoxGridNoChildren" dojoxTreeGridPath="'+f.join("/")+'">'):o.isItemLoaded(b)?c[v]='<tr class="'+w+' dojoxGridNoChildren" dojoxTreeGridPath="'+f.join("/")+'">':c[0]=c[0].replace("dojoxGridRowTable","dojoxGridRowTable dojoxGridRowTableNeedsRowUpdate")):
b&&!e&&g.length>1&&(c[v]='<tr class="'+g[g.length-2]+'" dojoxTreeGridPath="'+f.join("/")+'">')}else c[0].indexOf("dojoxGridRowTableNeedsRowUpdate")==-1&&(c[0]=c[0].replace("dojoxGridRowTable","dojoxGridRowTable dojoxGridRowTableNeedsRowUpdate"))};y(0,e,!1,["dojoxGridRowToggle-"+b],[b],!0);c.push("</table>");return c.join("")},findTarget:function(a){for(;a&&a!=this.domNode;){if(a.tagName&&a.tagName.toLowerCase()=="tr")break;a=a.parentNode}return a!=this.domNode?a:null},getCellNode:function(a,b){var c=
f("td[idx='"+b+"']",a)[0];if(c&&c.parentNode&&!g.contains(c.parentNode,"dojoxGridSummaryRow"))return c},decorateEvent:function(a){a.rowNode=this.findRowTarget(a.target);if(!a.rowNode)return!1;a.rowIndex=h.get(a.rowNode,"dojoxTreeGridPath");this.baseDecorateEvent(a);a.cell=this.grid.getCell(a.cellIndex);return!0}});return i("dojox.grid._TreeView",G,{_contentBuilderClass:n,_onDndDrop:function(){this.grid&&this.grid.aggregator&&this.grid.aggregator.clearSubtotalCache();this.inherited(arguments)},postCreate:function(){this.inherited(arguments);
this.connect(this.grid,"_cleanupExpandoCache","_cleanupExpandoCache")},_cleanupExpandoCache:function(a,b){if(a!=-1)if(t.forEach(this.grid.layout.cells,function(a){typeof a.openStates!="undefined"&&b in a.openStates&&delete a.openStates[b]}),typeof a=="string"&&a.indexOf("/")>-1){for(var c=new z.grid.TreePath(a,this.grid),d=c.parent();d;)c=d,d=c.parent();if(c=c.item())if(d=this.grid.store.getIdentity(c),typeof this._expandos[d]!="undefined"){for(var g in this._expandos[d])(c=this._expandos[d][g])&&
c.destroy(),delete this._expandos[d][g];delete this._expandos[d]}}else{for(g in this._expandos)if(typeof this._expandos[g]!="undefined")for(d in this._expandos[g])(c=this._expandos[g][d])&&c.destroy();this._expandos={}}},postMixInProperties:function(){this.inherited(arguments);this._expandos={}},onBeforeRow:function(a){var b=this.grid;if(b._by_idx&&b._by_idx[a]&&b._by_idx[a].idty)b=b._by_idx[a].idty,this._expandos[b]=this._expandos[b]||{};this.inherited(arguments)},onAfterRow:function(a,b,c){t.forEach(f("span.dojoxGridExpando",
c),function(b){if(b&&b.parentNode){var d=b.getAttribute("toggleClass"),g,f,h=this.grid;if(h._by_idx&&h._by_idx[a]&&h._by_idx[a].idty)g=h._by_idx[a].idty,f=this._expandos[g][d];if(f){if(C.place(f.domNode,b,"replace"),f.itemId=b.getAttribute("itemId"),f.cellIdx=parseInt(b.getAttribute("cellIdx"),10),isNaN(f.cellIdx))f.cellIdx=-1}else g&&(f=D.parse(b.parentNode)[0],this._expandos[g][d]=f);f&&!f.setRowNode(a,c,this)&&f.domNode.parentNode.removeChild(f.domNode)}},this);var d=!1,i=this;f("tr[dojoxTreeGridPath]",
c).forEach(function(a){g.toggle(a,"dojoxGridSubRowAlt",d);h.set(a,"dojoxTreeGridBaseClasses",a.className);d=!d;i.grid.rows.styleRowNode(h.get(a,"dojoxTreeGridPath"),a)});this.inherited(arguments)},updateRowStyles:function(a){var b=f("tr[dojoxTreeGridPath='"+a+"']",this.domNode);b.length&&this.styleRowNode(a,b[0])},getCellNode:function(a,b){var c=f("tr[dojoxTreeGridPath='"+a+"']",this.domNode)[0];if(c)return this.content.getCellNode(c,b)},destroy:function(){this._cleanupExpandoCache();this.inherited(arguments)}})});