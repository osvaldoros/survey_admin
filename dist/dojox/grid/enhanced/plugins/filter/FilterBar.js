//>>built
define("dojox/grid/enhanced/plugins/filter/FilterBar",["dojo/_base/declare","dojo/_base/array","dojo/_base/connect","dojo/_base/lang","dojo/_base/sniff","dojo/_base/event","dojo/_base/html","dojo/_base/window","dojo/cache","dojo/query","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dojo/fx","dojo/_base/fx","dojo/string","dijit/focus"],function(n,o,l,d,p,q,f,r,s,t,u,v,w,m,j,k,i){var g=function(a){try{a&&a.preventDefault&&q.stop(a)}catch(b){}};return n("dojox.grid.enhanced.plugins.filter.FilterBar",
[u,v,w],{templateString:s("dojox.grid","enhanced/templates/FilterBar.html"),widgetsInTemplate:!0,_timeout_statusTooltip:300,_handle_statusTooltip:null,_curColIdx:-1,plugin:null,postMixInProperties:function(){var a=this.plugin,b=a.nls;this._filterBarDefBtnLabel=b.filterBarDefButton;this._filterBarClearBtnLabel=b.filterBarClearButton;this._closeFilterBarBtnLabel=b.closeFilterBarBtn;this._noFilterMsg=k.substitute(b.filterBarMsgNoFilterTemplate,["",a.args.itemsName||b.defaultItemsName]);b=this.plugin.args.statusTipTimeout;
if(typeof b=="number")this._timeout_statusTooltip=b;a=a.grid;a.showFilterBar=d.hitch(this,"showFilterBar");a.toggleFilterBar=d.hitch(this,"toggleFilterBar");a.isFilterBarShown=d.hitch(this,"isFilterBarShown")},postCreate:function(){this.inherited(arguments);this.plugin.args.closeFilterbarButton||f.style(this.closeFilterBarButton.domNode,"display","none");var a=this,b=this.plugin.grid,c=this.oldGetHeaderHeight=d.hitch(b,b._getHeaderHeight);this.placeAt(b.viewsHeaderNode,"after");this.connect(this.plugin.filterDefDialog,
"showDialog","_onShowFilterDefDialog");this.connect(this.plugin.filterDefDialog,"closeDialog","_onCloseFilterDefDialog");this.connect(b.layer("filter"),"onFiltered",this._onFiltered);this.defineFilterButton.domNode.title=this.plugin.nls.filterBarDefButton;f.hasClass(r.body(),"dijit_a11y")&&this.defineFilterButton.set("label",this.plugin.nls.a11yFilterBarDefButton);this.connect(this.defineFilterButton.domNode,"click",g);this.connect(this.clearFilterButton.domNode,"click",g);this.connect(this.closeFilterBarButton.domNode,
"click",g);this.toggleClearFilterBtn(!0);this._initAriaInfo();b._getHeaderHeight=function(){return c()+f.marginBox(a.domNode).h};b.focus.addArea({name:"filterbar",onFocus:d.hitch(this,this._onFocusFilterBar,!1),onBlur:d.hitch(this,this._onBlurFilterBar)});b.focus.placeArea("filterbar","after","header")},uninitialize:function(){var a=this.plugin.grid;a._getHeaderHeight=this.oldGetHeaderHeight;a.focus.removeArea("filterbar");this.plugin=null},isFilterBarShown:function(){return f.style(this.domNode,
"display")!="none"},showFilterBar:function(a,b,c){var e=this.plugin.grid;if(b){if(Boolean(a)!=this.isFilterBarShown()){var c=c||{},h=[];h.push(m[a?"wipeIn":"wipeOut"](d.mixin({node:this.domNode,duration:500},c)));var g=e.views.views[0].domNode.offsetHeight,i={duration:500,properties:{height:{end:d.hitch(this,function(){var b=this.domNode.scrollHeight;p("ff")&&(b-=2);return a?g-b:g+b})}}};o.forEach(e.views.views,function(a){h.push(j.animateProperty(d.mixin({node:a.domNode},i,c)),j.animateProperty(d.mixin({node:a.scrollboxNode},
i,c)))});h.push(j.animateProperty(d.mixin({node:e.viewsNode},i,c)));m.combine(h).play()}}else f.style(this.domNode,"display",a?"":"none"),e.update()},toggleFilterBar:function(a,b){this.showFilterBar(!this.isFilterBarShown(),a,b)},getColumnIdx:function(a){for(var b=t("[role='columnheader']",this.plugin.grid.viewsHeaderNode),c=-1,e=b.length-1;e>=0;--e){var h=f.position(b[e]);if(a>=h.x&&a<h.x+h.w){c=e;break}}return c>=0&&this.plugin.grid.layout.cells[c].filterable!==!1?c:-1},toggleClearFilterBtn:function(a){f.style(this.clearFilterButton.domNode,
"display",a?"none":"")},_closeFilterBar:function(a){g(a);if(this.plugin.filterDefDialog.getCriteria()){var b=l.connect(this.plugin.filterDefDialog,"clearFilter",this,function(){this.showFilterBar(!1,!0);l.disconnect(b)});this._clearFilterDefDialog(a)}else this.showFilterBar(!1,!0)},_showFilterDefDialog:function(a){g(a);this.plugin.filterDefDialog.showDialog(this._curColIdx);this.plugin.grid.focus.focusArea("filterbar")},_clearFilterDefDialog:function(a){g(a);this.plugin.filterDefDialog.onClearFilter();
this.plugin.grid.focus.focusArea("filterbar")},_onEnterButton:function(a){this._onBlurFilterBar();g(a)},_onMoveButton:function(){this._onBlurFilterBar()},_onLeaveButton:function(){this._leavingBtn=!0},_onShowFilterDefDialog:function(a){if(typeof a=="number")this._curColIdx=a;this._defPaneIsShown=!0},_onCloseFilterDefDialog:function(){this._defPaneIsShown=!1;this._curColIdx=-1;i.focus(this.defineFilterButton.domNode)},_onClickFilterBar:function(a){g(a);this._clearStatusTipTimeout();this.plugin.grid.focus.focusArea("filterbar");
this.plugin.filterDefDialog.showDialog(this.getColumnIdx(a.clientX))},_onMouseEnter:function(a){this._onFocusFilterBar(!0,null);this._updateTipPosition(a);this._setStatusTipTimeout()},_onMouseMove:function(a){if(this._leavingBtn)this._onFocusFilterBar(!0,null),this._leavingBtn=!1;this._isFocused&&(this._setStatusTipTimeout(),this._highlightHeader(this.getColumnIdx(a.clientX)),this._handle_statusTooltip&&this._updateTipPosition(a))},_onMouseLeave:function(){this._onBlurFilterBar()},_updateTipPosition:function(a){this._tippos=
{x:a.pageX,y:a.pageY}},_onFocusFilterBar:function(a,b,c){if(!this.isFilterBarShown())return!1;this._isFocused=!0;f.addClass(this.domNode,"dojoxGridFBarHover");if(!a){var a=f.style(this.clearFilterButton.domNode,"display")!=="none",e=f.style(this.closeFilterBarButton.domNode,"display")!=="none";if(typeof this._focusPos=="undefined")c>0?this._focusPos=0:(this._focusPos=e?1:0,a&&++this._focusPos);this._focusPos===0?i.focus(this.defineFilterButton.focusNode):this._focusPos===1&&a?i.focus(this.clearFilterButton.focusNode):
i.focus(this.closeFilterBarButton.focusNode)}g(b);return!0},_onBlurFilterBar:function(a,b){if(this._isFocused)this._isFocused=!1,f.removeClass(this.domNode,"dojoxGridFBarHover"),this._clearStatusTipTimeout(),this._clearHeaderHighlight();var c=!0;if(b){var e=3;f.style(this.closeFilterBarButton.domNode,"display")==="none"&&--e;f.style(this.clearFilterButton.domNode,"display")==="none"&&--e;if(e==1)delete this._focusPos;else{for(var h=this._focusPos,d=h+b;d<0;d+=e);d%=e;b>0&&d<h||b<0&&d>h?delete this._focusPos:
(this._focusPos=d,c=!1)}}return c},_onFiltered:function(a,b){var c=this.plugin,e=c.args.itemsName||c.nls.defaultItemsName,d="";c.grid.layer("filter").filterDef()?(d=k.substitute(c.nls.filterBarMsgHasFilterTemplate,[a,b,e]),f.addClass(this.domNode,"dojoxGridFBarFiltered")):(d=k.substitute(c.nls.filterBarMsgNoFilterTemplate,[b,e]),f.removeClass(this.domNode,"dojoxGridFBarFiltered"));this.statusBarNode.innerHTML=d;this._focusPos=0},_initAriaInfo:function(){this.defineFilterButton.domNode.setAttribute("aria-label",
this.plugin.nls.waiFilterBarDefButton);this.clearFilterButton.domNode.setAttribute("aria-label",this.plugin.nls.waiFilterBarClearButton)},_isInColumn:function(a,b){var c=f.position(b);return a>=c.x&&a<c.x+c.w},_setStatusTipTimeout:function(){this._clearStatusTipTimeout();if(!this._defPaneIsShown)this._handle_statusTooltip=setTimeout(d.hitch(this,this._showStatusTooltip),this._timeout_statusTooltip)},_clearStatusTipTimeout:function(){clearTimeout(this._handle_statusTooltip);this._handle_statusTooltip=
null},_showStatusTooltip:function(){this._handle_statusTooltip=null;this.plugin.filterStatusTip.showDialog(this._tippos.x,this._tippos.y,this.getColumnIdx(this._tippos.x))},_highlightHeader:function(a){if(a!=this._previousHeaderIdx){var b=this.plugin.grid,c=b.getCell(this._previousHeaderIdx);c&&f.removeClass(c.getHeaderNode(),"dojoxGridCellOver");(c=b.getCell(a))&&f.addClass(c.getHeaderNode(),"dojoxGridCellOver");this._previousHeaderIdx=a}},_clearHeaderHighlight:function(){if(typeof this._previousHeaderIdx!=
"undefined"){var a=this.plugin.grid,b=a.getCell(this._previousHeaderIdx);if(b)a.onHeaderCellMouseOut({cellNode:b.getHeaderNode()});delete this._previousHeaderIdx}}})});