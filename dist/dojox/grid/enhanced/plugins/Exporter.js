//>>built
define("dojox/grid/enhanced/plugins/Exporter",["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","../_Plugin","../../_RowSelector","../../EnhancedGrid","../../cells/_base"],function(k,g,c,l,m,n){var o=c.getObject("dojox.grid.cells"),e=k("dojox.grid.enhanced.plugins.Exporter",l,{name:"exporter",constructor:function(b,a){this.grid=b;this.formatter=a&&c.isObject(a)&&a.exportFormatter;this._mixinGrid()},_mixinGrid:function(){var b=this.grid;b.exportTo=c.hitch(this,this.exportTo);b.exportGrid=
c.hitch(this,this.exportGrid);b.exportSelected=c.hitch(this,this.exportSelected);b.setExportFormatter=c.hitch(this,this.setExportFormatter)},setExportFormatter:function(b){this.formatter=b},exportGrid:function(b,a,d){c.isFunction(a)&&(d=a,a={});if(c.isString(b)&&c.isFunction(d)){var a=a||{},f=this.grid,p=this,i=this._getExportWriter(b,a.writerArgs),a=a.fetchArgs&&c.isObject(a.fetchArgs)?a.fetchArgs:{},e=a.onComplete;if(f.store)a.onComplete=function(a,b){e&&e(a,b);d(p._goThroughGridData(a,i))},a.sort=
a.sort||f.getSortProps(),f._storeLayerFetch(a);else{for(var b=a.start||0,a=a.count||-1,j=[],h=b;h!=b+a&&h<f.rowCount;++h)j.push(f.getItem(h));d(this._goThroughGridData(j,i))}}},exportSelected:function(b,a){if(!c.isString(b))return"";var d=this._getExportWriter(b,a);return this._goThroughGridData(this.grid.selection.getSelected(),d)},_buildRow:function(b,a){var d=this;g.forEach(b._views,function(f,c){b.view=f;b.viewIdx=c;a.beforeView(b)&&(g.forEach(f.structure.cells,function(c,f){b.subrow=c;b.subrowIdx=
f;a.beforeSubrow(b)&&(g.forEach(c,function(c,f){b.isHeader&&d._isSpecialCol(c)&&b.spCols.push(c.index);b.cell=c;b.cellIdx=f;a.handleCell(b)}),a.afterSubrow(b))}),a.afterView(b))})},_goThroughGridData:function(b,a){var d=this.grid,c=g.filter(d.views.views,function(a){return!(a instanceof m)}),e={grid:d,isHeader:!0,spCols:[],_views:c,colOffset:c.length<d.views.views.length?-1:0};a.beforeHeader(d)&&(this._buildRow(e,a),a.afterHeader());e.isHeader=!1;a.beforeContent(b)&&(g.forEach(b,function(b,c){e.row=
b;e.rowIdx=c;a.beforeContentRow(e)&&(this._buildRow(e,a),a.afterContentRow(e))},this),a.afterContent());return a.toString()},_isSpecialCol:function(b){return b.isRowSelector||b instanceof o.RowIndex},_getExportWriter:function(b,a){var d,f;d=e;if(d.writerNames)if(d=d.writerNames[b.toLowerCase()],f=c.getObject(d))return d=new f(a),d.formatter=this.formatter,d;else throw Error('Please make sure class "'+d+'" is required.');throw Error('The writer for "'+b+'" has not been registered.');}});e.registerWriter=
function(b,a){e.writerNames=e.writerNames||{};e.writerNames[b]=a};n.registerPlugin(e);return e});