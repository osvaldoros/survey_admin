//>>built
define("dojox/grid/_Layout",["dojo/_base/kernel","../main","dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/dom-geometry","./cells","./_RowSelector"],function(o,k,m,l,e,n){return m("dojox.grid._Layout",null,{constructor:function(a){this.grid=a},cells:[],structure:null,defaultWidth:"6em",moveColumn:function(a,c,b,d,j){for(var h=this.structure[a].cells[0],g=this.structure[c].cells[0],f=null,e=f=0,a=0,i;i=h[a];a++)if(i.index==b){f=a;break}f=h.splice(f,1)[0];f.view=this.grid.views.views[c];
a=0;for(i=null;i=g[a];a++)if(i.index==d){e=a;break}j||(e+=1);g.splice(e,0,f);if(b=this.grid.getCell(this.grid.getSortIndex()))b._currentlySorted=this.grid.getSortAsc();this.cells=[];for(a=b=0;c=this.structure[a];a++)for(d=0;j=c.cells[d];d++)for(h=0;i=j[h];h++){i.index=b;this.cells.push(i);if("_currentlySorted"in i)g=b+1,g*=i._currentlySorted?1:-1,this.grid.sortInfo=g,delete i._currentlySorted;b++}l.forEach(this.cells,function(a){var b=a.markup[2].split(" ");parseInt(b[1].substring(5))!=a.index&&(b[1]=
'idx="'+a.index+'"',a.markup[2]=b.join(" "))});this.grid.setupHeaderMenu()},setColumnVisibility:function(a,c){var b=this.cells[a];if(b.hidden==c){b.hidden=!c;var d=b.view,e=d.viewWidth;if(e&&e!="auto")d._togglingColumn=n.getMarginBox(b.getHeaderNode()).w||0;d.update();return!0}else return!1},addCellDef:function(a,c,b){var d=this,j=function(a){var b=0;a.colSpan>1?b=0:(b=a.width||d._defaultCellProps.width||d.defaultWidth,isNaN(b)||(b+="em"));return b},a={grid:this.grid,subrow:a,layoutIndex:c,index:this.cells.length};
if(b&&b instanceof k.grid.cells._Base)return c=e.clone(b),a.unitWidth=j(c._props),c=e.mixin(c,this._defaultCellProps,b._props,a);c=b.type||b.cellType||this._defaultCellProps.type||this._defaultCellProps.cellType||k.grid.cells.Cell;e.isString(c)&&(c=e.getObject(c));a.unitWidth=j(b);return new c(e.mixin({},this._defaultCellProps,b,a))},addRowDef:function(a,c){for(var b=[],d=0,e=0,h=!0,g=0,f;f=c[g];g++)if(f=this.addCellDef(a,g,f),b.push(f),this.cells.push(f),h&&f.relWidth)d+=f.relWidth;else if(f.width)f=
f.width,typeof f=="string"&&f.slice(-1)=="%"?e+=window.parseInt(f,10):f=="auto"&&(h=!1);d&&h&&l.forEach(b,function(a){if(a.relWidth)a.width=a.unitWidth=a.relWidth/d*(100-e)+"%"});return b},addRowsDef:function(a){var c=[];if(e.isArray(a))if(e.isArray(a[0]))for(var b=0,d;a&&(d=a[b]);b++)c.push(this.addRowDef(b,d));else c.push(this.addRowDef(0,a));return c},addViewDef:function(a){this._defaultCellProps=a.defaultCell||{};a.width&&a.width=="auto"&&delete a.width;return e.mixin({},a,{cells:this.addRowsDef(a.rows||
a.cells)})},setStructure:function(a){this.fieldIndex=0;this.cells=[];var c=this.structure=[];if(this.grid.rowSelector){var b={type:k._scopeName+".grid._RowSelector"};if(e.isString(this.grid.rowSelector)){var d=this.grid.rowSelector;d=="false"?b=null:d!="true"&&(b.width=d)}else this.grid.rowSelector||(b=null);b&&c.push(this.addViewDef(b))}b=function(a){if(e.isArray(a)&&(e.isArray(a[0])||"name"in a[0]||"field"in a[0]||"get"in a[0]))return!0;return!1};d=function(a){return a!==null&&e.isObject(a)&&("cells"in
a||"rows"in a||"type"in a&&!("name"in a||"field"in a||"get"in a))};if(e.isArray(a)){for(var j=!1,h=0,g;g=a[h];h++)if(d(g)){j=!0;break}if(j)for(h=0;g=a[h];h++)b(g)?c.push(this.addViewDef({cells:g})):d(g)&&c.push(this.addViewDef(g));else c.push(this.addViewDef({cells:a}))}else d(a)&&c.push(this.addViewDef(a));this.cellCount=this.cells.length;this.grid.setupHeaderMenu()}})});