//>>built
define("dojox/form/uploader/plugins/Flash",["dojo/dom-form","dojo/dom-style","dojo/dom-construct","dojo/dom-attr","dojo/_base/declare","dojo/_base/config","dojo/_base/connect","dojo/_base/lang","dojo/_base/array","dojox/form/uploader/plugins/HTML5","dojox/embed/Flash"],function(d,e,f,g,h,i,j,c,k,m,l){d=h("dojox.form.uploader.plugins.Flash",[],{swfPath:i.uploaderPath||require.toUrl("dojox/form/resources/uploader.swf"),skipServerCheck:!0,serverTimeout:2E3,isDebug:!1,devMode:!1,deferredUploading:0,force:"",
postMixInProperties:function(){if(!this.supports("multiple"))this.uploadType="flash",this._files=[],this._fileMap={},this._createInput=this._createFlashUploader,this.getFileList=this.getFlashFileList,this.reset=this.flashReset,this.upload=this.uploadFlash,this.fieldname="flashUploadFiles";this.inherited(arguments)},onReady:function(){},onLoad:function(){},onFileChange:function(){},onFileProgress:function(){},getFlashFileList:function(){return this._files},flashReset:function(){this.flashMovie.reset();
this._files=[]},uploadFlash:function(a){this.onBegin(this.getFileList());this.flashMovie.doUpload(a)},_change:function(a){this._files=this._files.concat(a);k.forEach(a,function(a){a.bytesLoaded=0;a.bytesTotal=a.size;this._fileMap[a.name+"_"+a.size]=a},this);this.onChange(this._files);this.onFileChange(a)},_complete:function(a){this._getCustomEvent().type="load";this.onComplete(a)},_progress:function(a){this._fileMap[a.name+"_"+a.bytesTotal].bytesLoaded=a.bytesLoaded;var b=this._getCustomEvent();this.onFileProgress(a);
this.onProgress(b)},_error:function(a){this.onError(a)},_onFlashBlur:function(){},_getCustomEvent:function(){var a={bytesLoaded:0,bytesTotal:0,type:"progress",timeStamp:(new Date).getTime()},b;for(b in this._fileMap)a.bytesTotal+=this._fileMap[b].bytesTotal,a.bytesLoaded+=this._fileMap[b].bytesLoaded;a.decimal=a.bytesLoaded/a.bytesTotal;a.percent=Math.ceil(a.bytesLoaded/a.bytesTotal*100)+"%";return a},_connectFlash:function(){this._subs=[];this._cons=[];var a=c.hitch(this,function(a,c){this._subs.push(j.subscribe(this.id+
a,this,c))});a("/filesSelected","_change");a("/filesUploaded","_complete");a("/filesProgress","_progress");a("/filesError","_error");a("/filesCanceled","onCancel");a("/stageBlur","_onFlashBlur");this.connect(this.domNode,"focus",function(){this.flashMovie.focus();this.flashMovie.doFocus()});this.tabIndex>=0&&g.set(this.domNode,"tabIndex",this.tabIndex)},_createFlashUploader:function(){var a=this.getUrl();if(a){if(a.toLowerCase().indexOf("http")<0&&a.indexOf("/")!=0){var b=window.location.href.split("/");
b.pop();b=b.join("/")+"/";a=b+a}}else console.warn("Warning: no uploadUrl provided.");this.inputNode=f.create("div",{className:"dojoxFlashNode"},this.domNode,"first");e.set(this.inputNode,{position:"absolute",top:"-2px",width:this.btnSize.w+"px",height:this.btnSize.h+"px",opacity:0});var b=this.btnSize.w,d=this.btnSize.h,a={expressInstall:!0,path:(this.swfPath.uri||this.swfPath)+"?cb_"+(new Date).getTime(),width:b,height:d,allowScriptAccess:"always",allowNetworking:"all",vars:{uploadDataFieldName:this.flashFieldName||
this.name+"Flash",uploadUrl:a,uploadOnSelect:this.uploadOnSelect,deferredUploading:this.deferredUploading||0,selectMultipleFiles:this.multiple,id:this.id,isDebug:this.isDebug,noReturnCheck:this.skipServerCheck,serverTimeout:this.serverTimeout},params:{scale:"noscale",wmode:"transparent",wmode:"opaque",allowScriptAccess:"always",allowNetworking:"all"}};this.flashObject=new l(a,this.inputNode);this.flashObject.onError=c.hitch(function(a){console.error("Flash Error: "+a)});this.flashObject.onReady=c.hitch(this,
function(){this.onReady(this)});this.flashObject.onLoad=c.hitch(this,function(a){this.flashMovie=a;this.flashReady=!0;this.onLoad(this)});this._connectFlash()}});dojox.form.addUploaderPlugin(d);return d});