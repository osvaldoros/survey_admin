//>>built
define(["dijit","dojo","dojox"],function(i,b,h){b.provide("dojox.drawing.manager.keys");(function(){var d=!1,e=!0;h.drawing.manager.keys={arrowIncrement:1,arrowShiftIncrement:10,shift:!1,ctrl:!1,alt:!1,cmmd:!1,meta:!1,onDelete:function(){},onEsc:function(){},onEnter:function(){},onArrow:function(){},onKeyDown:function(){},onKeyUp:function(){},listeners:[],register:function(a){this.listeners.push({handle:h.drawing.util.common.uid("listener"),scope:a.scope||window,callback:a.callback,keyCode:a.keyCode})},
_getLetter:function(a){if(!a.meta&&a.keyCode>=65&&a.keyCode<=90)return"abcdefghijklmnopqrstuvwxyz".charAt(a.keyCode-65);return null},_mixin:function(a){a.meta=this.meta;a.shift=this.shift;a.alt=this.alt;a.cmmd=this.cmmd;a.letter=this._getLetter(a);return a},editMode:function(a){d=a},enable:function(a){e=a},scanForFields:function(){this._fieldCons&&b.forEach(this._fieldCons,b.disconnect,b);this._fieldCons=[];b.query("input").forEach(function(a){var c=b.connect(a,"focus",this,function(){this.enable(!1)}),
a=b.connect(a,"blur",this,function(){this.enable(!0)});this._fieldCons.push(c);this._fieldCons.push(a)},this)},init:function(){setTimeout(b.hitch(this,"scanForFields"),500);b.connect(document,"blur",this,function(){this.meta=this.shift=this.ctrl=this.cmmd=this.alt=!1});b.connect(document,"keydown",this,function(a){if(e){if(a.keyCode==16)this.shift=!0;if(a.keyCode==17)this.ctrl=!0;if(a.keyCode==18)this.alt=!0;if(a.keyCode==224)this.cmmd=!0;this.meta=this.shift||this.ctrl||this.cmmd||this.alt;d||(this.onKeyDown(this._mixin(a)),
(a.keyCode==8||a.keyCode==46)&&b.stopEvent(a))}});b.connect(document,"keyup",this,function(a){if(e){var c=!1;if(a.keyCode==16)this.shift=!1;if(a.keyCode==17)this.ctrl=!1;if(a.keyCode==18)this.alt=!1;if(a.keyCode==224)this.cmmd=!1;this.meta=this.shift||this.ctrl||this.cmmd||this.alt;!d&&this.onKeyUp(this._mixin(a));a.keyCode==13&&(console.warn("KEY ENTER"),this.onEnter(a),c=!0);a.keyCode==27&&(this.onEsc(a),c=!0);if(a.keyCode==8||a.keyCode==46)this.onDelete(a),c=!0;c&&!d&&b.stopEvent(a)}});b.connect(document,
"keypress",this,function(a){if(e){var c=this.shift?this.arrowIncrement*this.arrowShiftIncrement:this.arrowIncrement,f=0,g=0;a.keyCode==32&&!d&&b.stopEvent(a);a.keyCode==37&&(f=-c);a.keyCode==38&&(g=-c);a.keyCode==39&&(f=c);a.keyCode==40&&(g=c);if(f||g)a.x=f,a.y=g,a.shift=this.shift,d||(this.onArrow(a),b.stopEvent(a))}})}};b.addOnLoad(h.drawing.manager.keys,"init")})()});