//>>built
define(["dijit","dojo","dojox"],function(n,d,f){d.provide("dojox.drawing.manager.Mouse");f.drawing.manager.Mouse=f.drawing.util.oo.declare(function(a){this.util=a.util;this.keys=a.keys;this.id=a.id||this.util.uid("mouse");this.currentNodeId="";this.registered={}},{doublClickSpeed:400,_lastx:0,_lasty:0,__reg:0,_downOnCanvas:!1,init:function(a){this.container=a;this.setCanvas();var b,c=!1;d.connect(this.container,"rightclick",this,function(){console.warn("RIGHTCLICK")});d.connect(document.body,"mousedown",
this,function(){});d.connect(this.container,"mousedown",this,function(a){this.down(a);a.button!=d.mouseButtons.RIGHT&&(c=!0,b=d.connect(document,"mousemove",this,"drag"))});d.connect(document,"mouseup",this,function(a){d.disconnect(b);c=!1;this.up(a)});d.connect(document,"mousemove",this,function(a){c||this.move(a)});d.connect(this.keys,"onEsc",this,function(){this._dragged=!1})},setCanvas:function(){var a=d.coords(this.container.parentNode);this.origin=d.clone(a)},scrollOffset:function(){return{top:this.container.parentNode.scrollTop,
left:this.container.parentNode.scrollLeft}},resize:function(a,b){if(this.origin)this.origin.w=a,this.origin.h=b},register:function(a){var b=a.id||"reg_"+this.__reg++;this.registered[b]||(this.registered[b]=a);return b},unregister:function(a){this.registered[a]&&delete this.registered[a]},_broadcastEvent:function(a,b){for(var c in this.registered)if(this.registered[c][a])this.registered[c][a](b)},onDown:function(a){this._broadcastEvent(this.eventName("down"),a)},onDrag:function(a){var b=this.eventName("drag");
this._selected&&b=="onDrag"&&(b="onStencilDrag");this._broadcastEvent(b,a)},onMove:function(a){this._broadcastEvent("onMove",a)},overName:function(a,b){var c=a.id.split("."),b=b.charAt(0).toUpperCase()+b.substring(1);return c[0]=="dojox"&&(f.drawing.defaults.clickable||!f.drawing.defaults.clickMode)?"onStencil"+b:"on"+b},onOver:function(a){this._broadcastEvent(this.overName(a,"over"),a)},onOut:function(a){this._broadcastEvent(this.overName(a,"out"),a)},onUp:function(a){var b=this.eventName("up");
if(b=="onStencilUp")this._selected=!0;else if(this._selected&&b=="onUp")b="onStencilUp",this._selected=!1;console.info("Up Event:",this.id,b,"id:",a.id);this._broadcastEvent(b,a);if(f.gfx.renderer!="silverlight")this._clickTime=(new Date).getTime(),this._lastClickTime&&this._clickTime-this._lastClickTime<this.doublClickSpeed&&(b=this.eventName("doubleClick"),console.warn("DOUBLE CLICK",b,a),this._broadcastEvent(b,a)),this._lastClickTime=this._clickTime},zoom:1,setZoom:function(a){this.zoom=1/a},setEventMode:function(a){this.mode=
a?"on"+a.charAt(0).toUpperCase()+a.substring(1):""},eventName:function(a){a=a.charAt(0).toUpperCase()+a.substring(1);if(this.mode){if(this.mode=="onPathEdit")return"on"+a;return this.mode+a}else{if(!f.drawing.defaults.clickable&&f.drawing.defaults.clickMode)return"on"+a;var b=!this.drawingType||this.drawingType=="surface"||this.drawingType=="canvas"?"":this.drawingType;return"on"+(!b?"":b.charAt(0).toUpperCase()+b.substring(1))+a}},up:function(a){this.onUp(this.create(a))},down:function(a){this._downOnCanvas=
!0;var b=this.scrollOffset(),c=this._getXY(a);this._lastpagex=c.x;this._lastpagey=c.y;var e=this.origin,g=c.x-e.x+b.left,b=c.y-e.y+b.top,f=g>=0&&b>=0&&g<=e.w&&b<=e.h;g*=this.zoom;b*=this.zoom;e.startx=g;e.starty=b;this._lastx=g;this._lasty=b;this.drawingType=this.util.attr(a,"drawingType")||"";e=this._getId(a);a.button==d.mouseButtons.RIGHT&&this.id=="mse"||(a.preventDefault(),d.stopEvent(a));this.onDown({mid:this.id,x:g,y:b,pageX:c.x,pageY:c.y,withinCanvas:f,id:e})},over:function(a){this.onOver(a)},
out:function(a){this.onOut(a)},move:function(a){a=this.create(a);if(a.id!=this.currentNodeId){var b={},c;for(c in a)b[c]=a[c];(b.id=this.currentNodeId)&&this.out(b);a.id&&this.over(a);this.currentNodeId=a.id}this.onMove(a)},drag:function(a){this.onDrag(this.create(a,!0))},create:function(a,b){var c=this.scrollOffset(),e=this._getXY(a),f=e.x,k=e.y,h=this.origin,i=e.x-h.x+c.left,j=e.y-h.y+c.top,l=i>=0&&j>=0&&i<=h.w&&j<=h.h;i*=this.zoom;j*=this.zoom;var m=l?this._getId(a,b):"",c={mid:this.id,x:i,y:j,
pageX:e.x,pageY:e.y,page:{x:e.x,y:e.y},orgX:h.x,orgY:h.y,last:{x:this._lastx,y:this._lasty},start:{x:this.origin.startx,y:this.origin.starty},move:{x:f-this._lastpagex,y:k-this._lastpagey},scroll:c,id:m,withinCanvas:l};this._lastx=i;this._lasty=j;this._lastpagex=f;this._lastpagey=k;d.stopEvent(a);return c},_getId:function(a,b){return this.util.attr(a,"id",null,b)},_getXY:function(a){return{x:a.pageX,y:a.pageY}},setCursor:function(a,b){b?d.style(b,"cursor",a):d.style(this.container,"cursor",a)}})});