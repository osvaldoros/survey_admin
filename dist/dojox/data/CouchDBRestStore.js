//>>built
define("dojox/data/CouchDBRestStore",["dojo","dojox","dojox/data/JsonRestStore"],function(g,e){g.declare("dojox.data.CouchDBRestStore",e.data.JsonRestStore,{save:function(){for(var a=this.inherited(arguments),c=this.service.servicePath,b=0;b<a.length;b++)(function(a,b){b.addCallback(function(b){if(b)a.__id=c+b.id,a._rev=b.rev;return b})})(a[b].content,a[b].deferred)},fetch:function(a){a.query=a.query||"_all_docs?";if(a.start)a.query=(a.query?a.query+"&":"")+"startkey="+a.start,delete a.start;if(a.count)a.query=
(a.query?a.query+"&":"")+"limit="+a.count,delete a.count;return this.inherited(arguments)},_processResults:function(a){var c=a.rows;if(c){for(var b=this.service.servicePath,d=0;d<c.length;d++){var f=c[d].value;f.__id=b+c[d].id;f._id=c[d].id;f._loadObject=e.rpc.JsonRest._loader;c[d]=f}return{totalCount:a.total_rows,items:a.rows}}else return{items:a}}});e.data.CouchDBRestStore.getStores=function(a){var c={};g.xhrGet({url:a+"_all_dbs",handleAs:"json",sync:!0}).addBoth(function(b){for(var d=0;d<b.length;d++)c[b[d]]=
new e.data.CouchDBRestStore({target:a+b[d],idAttribute:"_id"});return c});return c};return e.data.CouchDBRestStore});