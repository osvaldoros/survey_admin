//>>built
define("dojox/data/GoogleSearchStore",["dojo/_base/kernel","dojo/_base/lang","dojo/_base/declare","dojo/_base/window","dojo/_base/query","dojo/dom-construct","dojo/io/script"],function(c,k,d,m,v,w,x){c.experimental("dojox.data.GoogleSearchStore");var c=d("dojox.data.GoogleSearchStore",null,{constructor:function(a){if(a){if(a.label)this.label=a.label;if(a.key)this._key=a.key;if(a.lang)this._lang=a.lang;if("urlPreventCache"in a)this.urlPreventCache=a.urlPreventCache?!0:!1}this._id=dojox.data.GoogleSearchStore.prototype._id++},
_id:0,_requestCount:0,_googleUrl:"http://ajax.googleapis.com/ajax/services/search/",_storeRef:"_S",_attributes:["unescapedUrl","url","visibleUrl","cacheUrl","title","titleNoFormatting","content","estimatedResultCount"],_aggregatedAttributes:{estimatedResultCount:"cursor.estimatedResultCount"},label:"titleNoFormatting",_type:"web",urlPreventCache:!0,_queryAttrs:{text:"q"},_assertIsItem:function(a){if(!this.isItem(a))throw Error("dojox.data.GoogleSearchStore: a function was passed an item argument that was not an item");
},_assertIsAttribute:function(a){if(typeof a!=="string")throw Error("dojox.data.GoogleSearchStore: a function was passed an attribute argument that was not an attribute name string");},getFeatures:function(){return{"dojo.data.api.Read":!0}},getValue:function(a,b,e){if((a=this.getValues(a,b))&&a.length>0)return a[0];return e},getAttributes:function(){return this._attributes},hasAttribute:function(a,b){if(this.getValue(a,b))return!0;return!1},isItemLoaded:function(a){return this.isItem(a)},loadItem:function(){},
getLabel:function(a){return this.getValue(a,this.label)},getLabelAttributes:function(){return[this.label]},containsValue:function(a,b,e){a=this.getValues(a,b);for(b=0;b<a.length;b++)if(a[b]===e)return!0;return!1},getValues:function(a,b){this._assertIsItem(a);this._assertIsAttribute(b);var e=a[b];return k.isArray(e)?e:e!==void 0?[e]:[]},isItem:function(a){if(a&&a[this._storeRef]===this)return!0;return!1},close:function(){},_format:function(a){return a},fetch:function(a){function b(b){t++;p.content.context=
p.content.start=b.start;b=x.get(p);q.push(b.ioArgs.id);b.addErrback(function(b){a.onError&&a.onError.call(e,b,a)})}var a=a||{},e=a.scope||m.global;if(!a.query&&a.onError)a.onError.call(e,Error(this.declaredClass+": A query must be specified."));else{var c={},d;for(d in this._queryAttrs)c[d]=a.query[d];var a={query:c,onComplete:a.onComplete,onError:a.onError,onItem:a.onItem,onBegin:a.onBegin,start:a.start,count:a.count},n="GoogleSearchStoreCallback_"+this._id+"_"+ ++this._requestCount,c=this._createContent(c,
n,a);if(typeof a.start==="undefined"||a.start===null)a.start=0;if(!a.count)a.count=8;d={start:a.start-a.start%8};var r=this,p={url:this._googleUrl+this._type,preventCache:this.urlPreventCache,content:c},j=[],s=0,k=!1,l=a.start-1,t=0,q=[],u=function(d,c){q.length>0&&v("#"+q.splice(0,1)).forEach(w.destroy);if(!k){var i=r._getItems(c),f=c?c.cursor:null;if(i){for(var g=0;g<i.length&&g+d<a.count+a.start;g++)r._processItem(i[g],c),j[g+d]=i[g];s++;if(s==1){var h=(g=f?f.pages:null)?Number(g[g.length-1].start):
0;a.onBegin&&(f=f?f.estimatedResultCount:i.length,a.onBegin.call(e,f?Math.min(f,h+i.length):h+i.length,a));i=a.start-a.start%8+8;for(f=1;g;){if(!g[f]||Number(g[f].start)>=a.start+a.count)break;Number(g[f].start)>=i&&b({start:g[f].start});f++}}if(a.onItem&&j[l+1]){do l++,a.onItem.call(e,j[l],a);while(j[l+1]&&l<a.start+a.count)}s==t&&(k=!0,m.global[n]=null,a.onItem?a.onComplete.call(e,null,a):(j=j.slice(a.start,a.start+a.count),a.onComplete.call(e,j,a)))}}},h=[],o=d.start-1;m.global[n]=function(b,c,
d){try{if(d!=200)a.onError&&a.onError.call(e,Error("Response from Google was: "+d),a),m.global[n]=function(){};else if(b==o+1){if(u(Number(b),c),o+=8,h.length>0)for(h.sort(r._getSort());h.length>0&&h[0].start==o+1;)u(Number(h[0].start),h[0].data),h.splice(0,1),o+=8}else h.push({start:b,data:c})}catch(f){a.onError.call(e,f,a)}};b(d)}},_getSort:function(){return function(a,b){if(a.start<b.start)return-1;if(b.start<a.start)return 1;return 0}},_processItem:function(a,b){a[this._storeRef]=this;for(var c in this._aggregatedAttributes)a[c]=
k.getObject(this._aggregatedAttributes[c],!1,b)},_getItems:function(a){return a.results||a},_createContent:function(a,b){var c={v:"1.0",rsz:"large",callback:b,key:this._key,hl:this._lang},d;for(d in this._queryAttrs)c[this._queryAttrs[d]]=a[d];return c}}),y=d("dojox.data.GoogleWebSearchStore",c,{}),z=d("dojox.data.GoogleBlogSearchStore",c,{_type:"blogs",_attributes:["blogUrl","postUrl","title","titleNoFormatting","content","author","publishedDate"],_aggregatedAttributes:{}}),A=d("dojox.data.GoogleLocalSearchStore",
c,{_type:"local",_attributes:["title","titleNoFormatting","url","lat","lng","streetAddress","city","region","country","phoneNumbers","ddUrl","ddUrlToHere","ddUrlFromHere","staticMapUrl","viewport"],_aggregatedAttributes:{viewport:"viewport"},_queryAttrs:{text:"q",centerLatLong:"sll",searchSpan:"sspn"}}),B=d("dojox.data.GoogleVideoSearchStore",c,{_type:"video",_attributes:["title","titleNoFormatting","content","url","published","publisher","duration","tbWidth","tbHeight","tbUrl","playUrl"],_aggregatedAttributes:{}}),
C=d("dojox.data.GoogleNewsSearchStore",c,{_type:"news",_attributes:["title","titleNoFormatting","content","url","unescapedUrl","publisher","clusterUrl","location","publishedDate","relatedStories"],_aggregatedAttributes:{}}),D=d("dojox.data.GoogleBookSearchStore",c,{_type:"books",_attributes:["title","titleNoFormatting","authors","url","unescapedUrl","bookId","pageCount","publishedYear"],_aggregatedAttributes:{}}),d=d("dojox.data.GoogleImageSearchStore",c,{_type:"images",_attributes:["title","titleNoFormatting",
"visibleUrl","url","unescapedUrl","originalContextUrl","width","height","tbWidth","tbHeight","tbUrl","content","contentNoFormatting"],_aggregatedAttributes:{}});return{Search:c,ImageSearch:d,BookSearch:D,NewsSearch:C,VideoSearch:B,LocalSearch:A,BlogSearch:z,WebSearch:y}});