//>>built
define("dojox/editor/plugins/AutoUrlLink",["dojo","dijit","dojox","dijit/_editor/range","dijit/_editor/selection","dijit/_editor/_Plugin","dijit/form/Button","dojo/_base/connect","dojo/_base/declare","dojo/string"],function(d,e,f){d.declare("dojox.editor.plugins.AutoUrlLink",[e._editor._Plugin],{_template:"<a _djrealurl='${url}' href='${url}'>${url}</a>",setEditor:function(a){this.editor=a;d.isIE||(d.some(a._plugins,function(a){if(a.isInstanceOf(e._editor.plugins.EnterKeyHandling))return this.blockNodeForEnter=
a.blockNodeForEnter,!0;return!1},this),this.connect(a,"onKeyPress","_keyPress"),this.connect(a,"onClick","_recognize"),this.connect(a,"onBlur","_recognize"))},_keyPress:function(a){var j=d.keys,c=a.keyCode,b=a.charCode;b==j.SPACE||a.ctrlKey&&(b==118||b==86)?setTimeout(d.hitch(this,"_recognize"),0):c==j.ENTER?setTimeout(d.hitch(this,function(){this._recognize({enter:!0})}),0):this._saved=this.editor.window.getSelection().anchorNode},_recognize:function(a){var j=this._template,c=a?a.enter:!1,a=this.editor,
b=a.window.getSelection();if(b){var c=c?this._findLastEditingNode(b.anchorNode):this._saved||b.anchorNode,l=this._saved=b.anchorNode,h=b.anchorOffset;if(c.nodeType==3&&!this._inLink(c)){var g=!1,m=this._findUrls(c,l,h),i=a.document.createRange(),k,f=0,n=l==c;for(k=m.shift();k;)i.setStart(c,k.start),i.setEnd(c,k.end),b.removeAllRanges(),b.addRange(i),a.execCommand("insertHTML",d.string.substitute(j,{url:i.toString()})),f+=k.end,k=m.shift(),g=!0;if(!(n&&(h-=f)<=0)&&g)try{i.setStart(l,0),i.setEnd(l,
h),b.removeAllRanges(),b.addRange(i),d.withGlobal(a.window,"collapse",e._editor.selection,[])}catch(o){}}}},_inLink:function(a){for(var d=this.editor.editNode,c=!1,b,a=a.parentNode;a&&a!==d;){b=a.tagName?a.tagName.toLowerCase():"";if(b=="a"){c=!0;break}a=a.parentNode}return c},_findLastEditingNode:function(a){var j=e.range.BlockTagNames,c=this.editor.editNode,b;if(!a)return a;if(this.blockNodeForEnter=="BR"&&(!(b=e.range.getBlockAncestor(a,null,c).blockNode)||b.tagName.toUpperCase()!="LI"))for(;(a=
a.previousSibling)&&a.nodeType!=3;);else{for(a=(b||(b=e.range.getBlockAncestor(a,null,c).blockNode))&&b.tagName.toUpperCase()=="LI"?b:e.range.getBlockAncestor(a,null,c).blockNode;(a=a.previousSibling)&&(!a.tagName||!a.tagName.match(j)););if(a)for(a=a.lastChild;a;)if(a.nodeType==3&&d.trim(a.nodeValue)!="")break;else a=a.nodeType==1?a.lastChild:a.previousSibling}return a},_findUrls:function(a,d,c){var b=/(http|https|ftp):\/\/[^\s]+/ig,e=[],h=0,g=a.nodeValue,f;for(a===d&&c<g.length&&(g=g.substr(0,c));(a=
b.exec(g))!=null;)if(a.index==0||(f=g.charAt(a.index-1))==" "||f=="\u00a0")e.push({start:a.index-h,end:a.index+a[0].length-h}),h=a.index+a[0].length;return e}});d.subscribe(e._scopeName+".Editor.getPlugin",null,function(a){if(!a.plugin&&a.args.name.toLowerCase()==="autourllink")a.plugin=new f.editor.plugins.AutoUrlLink});return f.editor.plugins.AutoUrlLink});