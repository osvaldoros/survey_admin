//>>built
define(["dijit","dojo","dojox","dojo/require!dojox/editor/plugins/TablePlugins"],function(r,a,o){a.provide("dojox.editor.plugins.ResizeTableColumn");a.require("dojox.editor.plugins.TablePlugins");a.declare("dojox.editor.plugins.ResizeTableColumn",o.editor.plugins.TablePlugins,{constructor:function(){this.isLtr=this.dir?this.dir=="ltr":a._isBodyLtr();this.ruleDiv=a.create("div",{style:"top: -10000px; z-index: 10001"},a.body(),"last")},setEditor:function(k){function m(b,e){var c=a.withGlobal(k.window,
"query",a,["> td",b.parentNode]);switch(e){case "first":return c[0]==b;case "last":return c[c.length-1]==b;default:return!1}}function o(b){for(b=b.nextSibling;b;){if(b.tagName&&b.tagName.toLowerCase()=="td")break;b=b.nextSibling}return b}function p(b){for(;(b=b.parentNode)&&b.tagName.toLowerCase()!="table";);return b}function u(b){for(var e=a.withGlobal(k.window,"query",a,["td",p(b)]),c=e.length,d=0;d<c;d++)if(a.coords(e[d]).x==a.coords(b).x)return e[d];return null}function q(b,e){function c(b,a){if(!a)return 0;
if(a=="medium")return 1;if(a.slice&&a.slice(-2)=="px")return parseFloat(a);with(b){var c=style.left,d=runtimeStyle.left;runtimeStyle.left=currentStyle.left;try{style.left=a,a=style.pixelLeft}catch(e){a=0}style.left=c;runtimeStyle.left=d}return a}if(a.isIE){var d=b.currentStyle,f=c(b,d.borderLeftWidth),g=c(b,d.borderRightWidth),k=c(b,d.paddingLeft),d=c(b,d.paddingRight);b.style.width=e-f-g-k-d}else a.marginBox(b,{w:e})}var i=this.ruleDiv;this.editor=k;this.editor.customUndo=!0;this.onEditorLoaded();
k.onLoadDeferred.addCallback(a.hitch(this,function(){this.connect(this.editor.editNode,"onmousemove",function(b){var e=a.coords(k.iframe,!0),c=e.x,d=b.clientX;if(this.isDragging){var f=this.activeCell,b=a.coords(f),e=b.x,b=b.w,g=o(f),j,h,l=a.coords(p(f).parentNode),f=l.x,l=l.w;if(g)j=a.coords(g),h=j.x,j=j.w;(this.isLtr&&(i.headerColumn&&g&&f<d&&d<e+b||!g&&e<d&&d<f+l||g&&e<d&&d<h+j)||!this.isLtr&&(i.headerColumn&&g&&f>d&&d>e||!g&&e+b>d&&d>f||g&&e+b>d&&d>h))&&a.style(i,{left:c+d+"px"})}else if(h=b.target,
h.tagName&&h.tagName.toLowerCase()=="td"){j=a.coords(h);b=j.x;g=j.w;c=c+j.x-2;if(this.isLtr){if(i.headerColumn=!0,!m(h,"first")||d>b+g/2)c+=g,i.headerColumn=!1}else if(i.headerColumn=!1,m(h,"first")&&d>b+g/2)c+=g,i.headerColumn=!0;a.style(i,{position:"absolute",cursor:"col-resize",display:"block",width:"4px",backgroundColor:"transparent",top:e.y+j.y+"px",left:c+"px",height:j.h+"px"});this.activeCell=h}else a.style(i,{display:"none",top:"-10000px"})});this.connect(i,"onmousedown",function(b){var e=
a.coords(k.iframe,!0),c=a.coords(p(this.activeCell));this.isDragging=!0;a.style(k.editNode,{cursor:"col-resize"});a.style(i,{width:"1px",left:b.clientX+"px",top:e.y+c.y+"px",height:c.h+"px",backgroundColor:"#777"})});this.connect(i,"onmouseup",function(b){var e=this.activeCell,c=a.coords(e),d=c.w,f=c.x,c=o(e),g,j,h=a.coords(k.iframe).x,l=p(e),r=a.coords(l),n=l.getAttribute("cellspacing"),b=b.clientX,v=u(e),s,t;if(!n||(n=parseInt(n,10))<0)n=2;if(c)g=a.coords(c),j=g.x,g=g.w,s=u(c);this.isLtr?i.headerColumn?
f=h+f+d-b:(f=b-h-f,c&&(t=h+j+g-b-n)):i.headerColumn?f=b-h-f:(f=h+f+d-b,c&&(t=b-h-j-n));this.isDragging=!1;q(v,f);c&&(i.headerColumn||q(s,t));(i.headerColumn&&m(e,"first")||m(e,"last"))&&a.marginBox(l,{w:r.w+f-d});q(v,a.coords(e).w);c&&q(s,a.coords(c).w);a.style(k.editNode,{cursor:"auto"});a.style(i,{display:"none",top:"-10000px"});this.activeCell=null})}))}});a.subscribe(r._scopeName+".Editor.getPlugin",null,function(a){if(!a.plugin&&a.args&&a.args.command){var m=a.args.command.charAt(0).toLowerCase()+
a.args.command.substring(1,a.args.command.length);if(m=="resizeTableColumn")a.plugin=new o.editor.plugins.ResizeTableColumn({commandName:m})}})});