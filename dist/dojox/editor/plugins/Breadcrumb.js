//>>built
define("dojox/editor/plugins/Breadcrumb",["dojo","dijit","dojox","dijit/_Widget","dijit/_TemplatedMixin","dijit/Toolbar","dijit/Menu","dijit/MenuItem","dijit/MenuSeparator","dijit/_editor/range","dijit/_editor/selection","dijit/_editor/_Plugin","dijit/form/Button","dijit/form/ComboButton","dojo/_base/connect","dojo/_base/declare","dojo/i18n","dojo/string","dojo/i18n!dojox/editor/plugins/nls/Breadcrumb"],function(a,b,g){a.experimental("dojox.editor.plugins.Breadcrumb");a.declare("dojox.editor.plugins._BreadcrumbMenuTitle",
[b._Widget,b._TemplatedMixin,b._Contained],{templateString:'<tr><td dojoAttachPoint="title" colspan="4" class="dijitToolbar" style="font-weight: bold; padding: 3px;"></td></tr>',menuTitle:"",postCreate:function(){a.setSelectable(this.domNode,!1);this.domNode.setAttribute("aria-labelledby",this.id+"_text")},_setMenuTitleAttr:function(a){this.title.innerHTML=a},_getMenuTitleAttr:function(){return this.title.innerHTML}});a.declare("dojox.editor.plugins.Breadcrumb",b._editor._Plugin,{_menu:null,breadcrumbBar:null,
setEditor:function(d){this.editor=d;this._buttons=[];this.breadcrumbBar=new b.Toolbar;var e=a.i18n.getLocalization("dojox.editor.plugins","Breadcrumb");this._titleTemplate=e.nodeActions;a.place(this.breadcrumbBar.domNode,d.footer);this.editor.onLoadDeferred.addCallback(a.hitch(this,function(){this._menu=new b.Menu({});a.addClass(this.breadcrumbBar.domNode,"dojoxEditorBreadcrumbArrow");var c=new b.form.ComboButton({showLabel:!0,label:"body",_selNode:d.editNode,dropDown:this._menu,onClick:a.hitch(this,
function(){this._menuTarget=d.editNode;this._selectContents()})});this._menuTitle=new g.editor.plugins._BreadcrumbMenuTitle({menuTitle:e.nodeActions});this._selCMenu=new b.MenuItem({label:e.selectContents,onClick:a.hitch(this,this._selectContents)});this._delCMenu=new b.MenuItem({label:e.deleteContents,onClick:a.hitch(this,this._deleteContents)});this._selEMenu=new b.MenuItem({label:e.selectElement,onClick:a.hitch(this,this._selectElement)});this._delEMenu=new b.MenuItem({label:e.deleteElement,onClick:a.hitch(this,
this._deleteElement)});this._moveSMenu=new b.MenuItem({label:e.moveStart,onClick:a.hitch(this,this._moveCToStart)});this._moveEMenu=new b.MenuItem({label:e.moveEnd,onClick:a.hitch(this,this._moveCToEnd)});this._menu.addChild(this._menuTitle);this._menu.addChild(this._selCMenu);this._menu.addChild(this._delCMenu);this._menu.addChild(new b.MenuSeparator({}));this._menu.addChild(this._selEMenu);this._menu.addChild(this._delEMenu);this._menu.addChild(new b.MenuSeparator({}));this._menu.addChild(this._moveSMenu);
this._menu.addChild(this._moveEMenu);c._ddConnect=a.connect(c,"openDropDown",a.hitch(this,function(){this._menuTarget=c._selNode;this._menuTitle.set("menuTitle",a.string.substitute(this._titleTemplate,{nodeName:"&lt;body&gt;"}));this._selEMenu.set("disabled",!0);this._delEMenu.set("disabled",!0);this._selCMenu.set("disabled",!1);this._delCMenu.set("disabled",!1);this._moveSMenu.set("disabled",!1);this._moveEMenu.set("disabled",!1)}));this.breadcrumbBar.addChild(c);this.connect(this.editor,"onNormalizedDisplayChanged",
"updateState")}));this.breadcrumbBar.startup();a.isIE&&setTimeout(a.hitch(this,function(){this.breadcrumbBar.domNode.className=this.breadcrumbBar.domNode.className}),100)},_selectContents:function(){this.editor.focus();if(this._menuTarget)switch(this._menuTarget.tagName.toLowerCase()){case "br":case "hr":case "img":case "input":case "base":case "meta":case "area":case "basefont":break;default:try{a.withGlobal(this.editor.window,"collapse",b._editor.selection,[null]),a.withGlobal(this.editor.window,
"selectElementChildren",b._editor.selection,[this._menuTarget]),this.editor.onDisplayChanged()}catch(d){}}},_deleteContents:function(){this._menuTarget&&(this.editor.beginEditing(),this._selectContents(),a.withGlobal(this.editor.window,"remove",b._editor.selection,[this._menuTarget]),this.editor.endEditing(),this._updateBreadcrumb(),this.editor.onDisplayChanged())},_selectElement:function(){this.editor.focus();this._menuTarget&&(a.withGlobal(this.editor.window,"collapse",b._editor.selection,[null]),
a.withGlobal(this.editor.window,"selectElement",b._editor.selection,[this._menuTarget]),this.editor.onDisplayChanged())},_deleteElement:function(){this._menuTarget&&(this.editor.beginEditing(),this._selectElement(),a.withGlobal(this.editor.window,"remove",b._editor.selection,[this._menuTarget]),this.editor.endEditing(),this._updateBreadcrumb(),this.editor.onDisplayChanged())},_moveCToStart:function(){this.editor.focus();this._menuTarget&&(this._selectContents(),a.withGlobal(this.editor.window,"collapse",
b._editor.selection,[!0]))},_moveCToEnd:function(){this.editor.focus();this._menuTarget&&(this._selectContents(),a.withGlobal(this.editor.window,"collapse",b._editor.selection,[!1]))},_updateBreadcrumb:function(){var d=this.editor;if(d.window){var e=b.range.getSelection(d.window);if(e&&e.rangeCount>0){var e=e.getRangeAt(0),c=a.withGlobal(d.window,"getSelectedElement",b._editor.selection)||e.startContainer,e=[];if(c&&c.ownerDocument===d.document){for(;c&&c!==d.editNode&&c!=d.document.body&&c!=d.document;)c.nodeType===
1&&e.push({type:c.tagName.toLowerCase(),node:c}),c=c.parentNode;for(e=e.reverse();this._buttons.length;)d=this._buttons.pop(),a.disconnect(d._ddConnect),this.breadcrumbBar.removeChild(d);this._buttons=[];for(var f=this,d=0;d<e.length;d++)c=e[d],c=new b.form.ComboButton({showLabel:!0,label:c.type,_selNode:c.node,dropDown:this._menu,onClick:function(){f._menuTarget=this._selNode;f._selectContents()}}),c._ddConnect=a.connect(c,"openDropDown",a.hitch(c,function(){f._menuTarget=this._selNode;var b=f._menuTarget.tagName.toLowerCase(),
c=a.string.substitute(f._titleTemplate,{nodeName:"&lt;"+b+"&gt;"});f._menuTitle.set("menuTitle",c);switch(b){case "br":case "hr":case "img":case "input":case "base":case "meta":case "area":case "basefont":f._selCMenu.set("disabled",!0);f._delCMenu.set("disabled",!0);f._moveSMenu.set("disabled",!0);f._moveEMenu.set("disabled",!0);f._selEMenu.set("disabled",!1);f._delEMenu.set("disabled",!1);break;default:f._selCMenu.set("disabled",!1),f._delCMenu.set("disabled",!1),f._selEMenu.set("disabled",!1),f._delEMenu.set("disabled",
!1),f._moveSMenu.set("disabled",!1),f._moveEMenu.set("disabled",!1)}})),this._buttons.push(c),this.breadcrumbBar.addChild(c);if(a.isIE)this.breadcrumbBar.domNode.className=this.breadcrumbBar.domNode.className}}}},updateState:function(){a.style(this.editor.iframe,"display")==="none"||this.get("disabled")?a.style(this.breadcrumbBar.domNode,"display","none"):(a.style(this.breadcrumbBar.domNode,"display")==="none"&&a.style(this.breadcrumbBar.domNode,"display","block"),this._updateBreadcrumb(),this.editor.resize({h:a.marginBox(this.editor.domNode).h}))},
destroy:function(){if(this.breadcrumbBar)this.breadcrumbBar.destroyRecursive(),this.breadcrumbBar=null;this._menu&&(this._menu.destroyRecursive(),delete this._menu);this._buttons=null;delete this.editor.breadcrumbBar;this.inherited(arguments)}});a.subscribe(b._scopeName+".Editor.getPlugin",null,function(a){if(!a.plugin&&a.args.name.toLowerCase()==="breadcrumb")a.plugin=new g.editor.plugins.Breadcrumb({})});return g.editor.plugins.Breadcrumb});