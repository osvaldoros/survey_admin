//>>built
define("dojox/editor/plugins/NormalizeStyle",["dojo","dijit","dojox","dijit/_editor/html","dijit/_editor/_Plugin","dojo/_base/connect","dojo/_base/declare"],function(c,j,n){c.declare("dojox.editor.plugins.NormalizeStyle",j._editor._Plugin,{mode:"semantic",condenseSpans:!0,setEditor:function(a){this.editor=a;a.customUndo=!0;this.mode==="semantic"?this.editor.contentDomPostFilters.push(c.hitch(this,this._convertToSemantic)):this.mode==="css"&&this.editor.contentDomPostFilters.push(c.hitch(this,this._convertToCss));
c.isIE?(this.editor.contentDomPreFilters.push(c.hitch(this,this._convertToSemantic)),this._browserFilter=this._convertToSemantic):c.isWebKit?(this.editor.contentDomPreFilters.push(c.hitch(this,this._convertToCss)),this._browserFilter=this._convertToCss):(this.editor.contentDomPreFilters.push(c.hitch(this,this._convertToSemantic)),this._browserFilter=this._convertToSemantic);if(this.editor._inserthtmlImpl)this.editor._oldInsertHtmlImpl=this.editor._inserthtmlImpl;this.editor._inserthtmlImpl=c.hitch(this,
this._inserthtmlImpl)},_convertToSemantic:function(a){if(a){var h=this.editor.window,k=this,r=function(b){if(b.nodeType==1){if(b.id!=="dijitEditorBody"){var e=b.style,a=b.tagName?b.tagName.toLowerCase():"",f;if(e&&a!="table"&&a!="ul"&&a!="ol"){var g=e.fontWeight?e.fontWeight.toLowerCase():"",s=e.fontStyle?e.fontStyle.toLowerCase():"",o=e.textDecoration?e.textDecoration.toLowerCase():"",d=e.fontSize?e.fontSize.toLowerCase():"",m=e.backgroundColor?e.backgroundColor.toLowerCase():"",e=e.color?e.color.toLowerCase():
"",l=function(b,d){if(b){for(;d.firstChild;)b.appendChild(d.firstChild);a=="span"&&!d.style.cssText?(c.place(b,d,"before"),d.parentNode.removeChild(d),d=b):d.appendChild(b)}return d};switch(g){case "bold":case "bolder":case "700":case "800":case "900":f=c.withGlobal(h,"create",c,["b",{}]),b.style.fontWeight=""}b=l(f,b);f=null;if(s=="italic")f=c.withGlobal(h,"create",c,["i",{}]),b.style.fontStyle="";b=l(f,b);f=null;if(o){var p=o.split(" "),q=0;c.forEach(p,function(d){switch(d){case "underline":f=c.withGlobal(h,
"create",c,["u",{}]);break;case "line-through":f=c.withGlobal(h,"create",c,["strike",{}])}q++;if(q==p.length)b.style.textDecoration="";b=l(f,b);f=null})}if(d)d.indexOf("pt")>0?(d=d.substring(0,d.indexOf("pt")),d=parseInt(d),d<5?d="xx-small":d<10?d="x-small":d<15?d="small":d<20?d="medium":d<25?d="large":d<30?d="x-large":d>30&&(d="xx-large")):d.indexOf("px")>0&&(d=d.substring(0,d.indexOf("px")),d=parseInt(d),d<5?d="xx-small":d<10?d="x-small":d<15?d="small":d<20?d="medium":d<25?d="large":d<30?d="x-large":
d>30&&(d="xx-large")),(g={"xx-small":1,"x-small":2,small:3,medium:4,large:5,"x-large":6,"xx-large":7,"-webkit-xxx-large":7}[d])||(g=3),f=c.withGlobal(h,"create",c,["font",{size:g}]),b.style.fontSize="";b=l(f,b);f=null;if(m&&a!=="font"&&k._isInline(a))m=(new c.Color(m)).toHex(),f=c.withGlobal(h,"create",c,["font",{style:{backgroundColor:m}}]),b.style.backgroundColor="";if(e&&a!=="font")e=(new c.Color(e)).toHex(),f=c.withGlobal(h,"create",c,["font",{color:e}]),b.style.color="";b=l(f,b);f=null}}if(b.childNodes){var j=
[];c.forEach(b.childNodes,function(b){j.push(b)});c.forEach(j,r)}}return b};return this._normalizeTags(r(a))}return a},_normalizeTags:function(a){var h=this.editor.window,k=c.withGlobal(h,function(){return c.query("em,s,strong",a)});k&&k.length&&c.forEach(k,function(a){if(a){var b;switch(a.tagName?a.tagName.toLowerCase():""){case "s":b="strike";break;case "em":b="i";break;case "strong":b="b"}if(b){for(b=c.withGlobal(h,"create",c,[b,null,a,"before"]);a.firstChild;)b.appendChild(a.firstChild);a.parentNode.removeChild(a)}}});
return a},_convertToCss:function(a){if(a){var h=this.editor.window,k=function(a){if(a.nodeType==1){if(a.id!=="dijitEditorBody"){var b=a.tagName?a.tagName.toLowerCase():"";if(b){var e;switch(b){case "b":case "strong":e=c.withGlobal(h,"create",c,["span",{style:{fontWeight:"bold"}}]);break;case "i":case "em":e=c.withGlobal(h,"create",c,["span",{style:{fontStyle:"italic"}}]);break;case "u":e=c.withGlobal(h,"create",c,["span",{style:{textDecoration:"underline"}}]);break;case "strike":case "s":e=c.withGlobal(h,
"create",c,["span",{style:{textDecoration:"line-through"}}]);break;case "font":b={};if(c.attr(a,"color"))b.color=c.attr(a,"color");if(c.attr(a,"face"))b.fontFace=c.attr(a,"face");if(a.style&&a.style.backgroundColor)b.backgroundColor=a.style.backgroundColor;if(a.style&&a.style.color)b.color=a.style.color;e={1:"xx-small",2:"x-small",3:"small",4:"medium",5:"large",6:"x-large",7:"xx-large"};if(c.attr(a,"size"))b.fontSize=e[c.attr(a,"size")];e=c.withGlobal(h,"create",c,["span",{style:b}])}if(e){for(;a.firstChild;)e.appendChild(a.firstChild);
c.place(e,a,"before");a.parentNode.removeChild(a);a=e}}}if(a.childNodes){var i=[];c.forEach(a.childNodes,function(a){i.push(a)});c.forEach(i,k)}}return a},a=k(a);this.condenseSpans&&this._condenseSpans(a)}return a},_condenseSpans:function(a){var h=function(a){var j=function(a){var b;a&&(b={},a=a.toLowerCase().split(";"),c.forEach(a,function(a){if(a){var e=a.split(":"),a=e[0]?c.trim(e[0]):"",e=e[1]?c.trim(e[1]):"";if(a&&e){var h,f="";for(h=0;h<a.length;h++){var g=a.charAt(h);g=="-"?(h++,g=a.charAt(h),
f+=g.toUpperCase()):f+=g}b[f]=e}}}));return b};if(a&&a.nodeType==1&&(a.tagName?a.tagName.toLowerCase():"")==="span"&&a.childNodes&&a.childNodes.length===1)for(var b=a.firstChild;b&&b.nodeType==1&&b.tagName&&b.tagName.toLowerCase()=="span";)if(!c.attr(b,"class")&&!c.attr(b,"id")&&b.style){var e=j(a.style.cssText),i=j(b.style.cssText);if(e&&i){var f={},g;for(g in e)if(!e[g]||!i[g]||e[g]==i[g])f[g]=e[g],delete i[g];else{e[g]!=i[g]?g=="textDecoration"?(f[g]=e[g]+" "+i[g],delete i[g]):f=null:f=null;break}if(f){for(g in i)f[g]=
i[g];for(c.style(a,f);b.firstChild;)a.appendChild(b.firstChild);e=b.nextSibling;b.parentNode.removeChild(b);b=e}else b=b.nextSibling}else b=b.nextSibling}else b=b.nextSibling;a.childNodes&&a.childNodes.length&&c.forEach(a.childNodes,h)};h(a)},_isInline:function(a){switch(a){case "a":case "b":case "strong":case "s":case "strike":case "i":case "u":case "em":case "sup":case "sub":case "span":case "font":case "big":case "cite":case "q":case "img":case "small":return!0;default:return!1}},_inserthtmlImpl:function(a){if(a){var c=
this.editor.document.createElement("div");c.innerHTML=a;c=this._browserFilter(c);a=j._editor.getChildrenHtml(c);c.innerHTML="";return this.editor._oldInsertHtmlImpl?this.editor._oldInsertHtmlImpl(a):this.editor.execCommand("inserthtml",a)}return!1}});c.subscribe(j._scopeName+".Editor.getPlugin",null,function(a){if(!a.plugin&&a.args.name.toLowerCase()==="normalizestyle")a.plugin=new n.editor.plugins.NormalizeStyle({mode:"mode"in a.args?a.args.mode:"semantic",condenseSpans:"condenseSpans"in a.args?
a.args.condenseSpans:!0})});return n.editor.plugins.NormalizeStyle});