//>>built
define("dojox/mdnd/adapter/DndFromDojo",["dojo/_base/kernel","dojo/_base/declare","dojo/_base/connect","dojo/_base/array","dojo/_base/html","dojo/_base/window","dojox/mdnd/AreaManager","dojo/dnd/Manager"],function(a){var g=a.declare("dojox.mdnd.adapter.DndFromDojo",null,{dropIndicatorSize:{w:0,h:50},dropIndicatorSize:{w:0,h:50},_areaManager:null,_dojoManager:null,_currentArea:null,_oldArea:null,_moveHandler:null,_subscribeHandler:null,constructor:function(){this._areaManager=dojox.mdnd.areaManager();
this._dojoManager=a.dnd.manager();this._moveHandler=this._currentArea=null;this.subscribeDnd()},subscribeDnd:function(){this._subscribeHandler=[a.subscribe("/dnd/start",this,"onDragStart"),a.subscribe("/dnd/drop/before",this,"onDrop"),a.subscribe("/dnd/cancel",this,"onDropCancel"),a.subscribe("/dnd/source/over",this,"onDndSource")]},unsubscribeDnd:function(){a.forEach(this._subscribeHandler,a.unsubscribe)},_getHoverArea:function(b){var a=b.x,b=b.y;this._oldArea=this._currentArea;this._currentArea=
null;for(var c=this._areaManager._areaList,f=0;f<c.length;f++){var e=c[f],h=e.coords.x,g=h+e.node.offsetWidth,i=e.coords.y,j=i+e.node.offsetHeight;if(h<=a&&a<=g&&i<=b&&b<=j){this._areaManager._oldIndexArea=this._areaManager._currentIndexArea;this._areaManager._currentIndexArea=f;this._currentArea=e.node;break}}if(this._currentArea!=this._oldArea)if(this._currentArea==null)this.onDragExit();else{if(this._oldArea!=null)this.onDragExit();this.onDragEnter()}},onDragStart:function(b,d,c){this._dragNode=
d[0];this._copy=c;this._source=b;this._outSourceHandler=a.connect(this._dojoManager,"outSource",this,function(){if(this._moveHandler==null)this._moveHandler=a.connect(a.doc,"mousemove",this,"onMouseMove")})},onMouseMove:function(b){b={x:b.pageX,y:b.pageY};this._getHoverArea(b);if(this._currentArea&&this._areaManager._accept){if(this._areaManager._dropIndicator.node.style.visibility=="hidden")this._areaManager._dropIndicator.node.style.visibility="",a.addClass(this._dojoManager.avatar.node,"dojoDndAvatarCanDrop");
this._areaManager.placeDropIndicator(b,this.dropIndicatorSize)}},onDragEnter:function(){var b=this._dragNode.getAttribute("dndType");this._areaManager._isAccepted(b?b.split(/\s*,\s*/):["text"],this._areaManager._areaList[this._areaManager._currentIndexArea].accept);this._dojoManager.avatar&&(this._areaManager._accept?a.addClass(this._dojoManager.avatar.node,"dojoDndAvatarCanDrop"):a.removeClass(this._dojoManager.avatar.node,"dojoDndAvatarCanDrop"))},onDragExit:function(){this._areaManager._accept=
!1;this._dojoManager.avatar&&a.removeClass(this._dojoManager.avatar.node,"dojoDndAvatarCanDrop");this._currentArea==null?(this._areaManager._dropMode.refreshItems(this._areaManager._areaList[this._areaManager._oldIndexArea],this._areaManager._oldDropIndex,this.dropIndicatorSize,!1),this._areaManager._resetAfterDrop()):this._areaManager._dropIndicator.remove()},isAccepted:function(a,d){var c=a.getAttribute("dndType")?a.getAttribute("dndType"):"text";return c&&c in d?!0:!1},onDndSource:function(b){if(this._currentArea!=
null)if(b){var d=!1;if(d=this._dojoManager.target==b?!0:this.isAccepted(this._dragNode,b.accept)){if(a.disconnect(this._moveHandler),this._currentArea=this._moveHandler=null,(b=this._areaManager._dropIndicator.node)&&b.parentNode!==null&&b.parentNode.nodeType==1)b.style.visibility="hidden"}else this._resetAvatar()}else{if(!this._moveHandler)this._moveHandler=a.connect(a.doc,"mousemove",this,"onMouseMove");this._resetAvatar()}},_resetAvatar:function(){this._dojoManager.avatar&&(this._areaManager._accept?
a.addClass(this._dojoManager.avatar.node,"dojoDndAvatarCanDrop"):a.removeClass(this._dojoManager.avatar.node,"dojoDndAvatarCanDrop"))},onDropCancel:function(){if(this._currentArea==null)this._areaManager._resetAfterDrop(),a.disconnect(this._moveHandler),a.disconnect(this._outSourceHandler),this._currentArea=this._moveHandler=this._outSourceHandler=null;else if(this._areaManager._accept)this.onDrop(this._source,[this._dragNode],this._copy,this._currentArea);else this._currentArea=null,a.disconnect(this._outSourceHandler),
a.disconnect(this._moveHandler),this._moveHandler=this._outSourceHandler=null},onDrop:function(b,d,c){a.disconnect(this._moveHandler);a.disconnect(this._outSourceHandler);this._moveHandler=this._outSourceHandler=null;if(this._currentArea)a.publish("/dnd/drop/after",[b,d,c,this._currentArea,this._areaManager._currentDropIndex]),this._currentArea=null;if(this._areaManager._dropIndicator.node.style.visibility=="hidden")this._areaManager._dropIndicator.node.style.visibility="";this._areaManager._resetAfterDrop()}});
dojox.mdnd.adapter._dndFromDojo=null;dojox.mdnd.adapter._dndFromDojo=new dojox.mdnd.adapter.DndFromDojo;return g});