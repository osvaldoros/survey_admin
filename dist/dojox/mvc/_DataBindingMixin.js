//>>built
define("dojox/mvc/_DataBindingMixin",["dojo/_base/lang","dojo/_base/array","dojo/_base/declare","dojo/Stateful","dijit/registry"],function(e,h,i,j,g){return i("dojox.mvc._DataBindingMixin",null,{ref:null,isValid:function(){return this.get("binding")?this.get("binding").get("valid"):!0},_dbstartup:function(){if(!this._databound)this._unwatchArray(this._viewWatchHandles),this._viewWatchHandles=[this.watch("ref",function(){this._databound&&this._setupBinding()}),this.watch("value",function(a,b,c){this._databound&&
(a=this.get("binding"))&&(c&&b&&b.valueOf()===c.valueOf()||a.set("value",c))})],this._beingBound=!0,this._setupBinding(),delete this._beingBound,this._databound=!0},_setupBinding:function(a){if(this.ref){var b=this.ref,c;if(b&&e.isFunction(b.toPlainObject))c=b;else if(/^\s*expr\s*:\s*/.test(b))b=b.replace(/^\s*expr\s*:\s*/,""),c=e.getObject(b);else if(/^\s*rel\s*:\s*/.test(b))b=b.replace(/^\s*rel\s*:\s*/,""),(a=a||this._getParentBindingFromDOM())&&(c=e.getObject(""+b,!1,a));else if(/^\s*widget\s*:\s*/.test(b))b=
b.replace(/^\s*widget\s*:\s*/,""),c=b.split("."),c.length==1?c=g.byId(b).get("binding"):(a=g.byId(c.shift()).get("binding"),c=e.getObject(c.join("."),!1,a));else if(a=a||this._getParentBindingFromDOM())c=e.getObject(""+b,!1,a);else try{e.getObject(b)instanceof j&&(c=e.getObject(b))}catch(f){if(b.indexOf("${")==-1)throw Error("dojox.mvc._DataBindingMixin: '"+this.domNode+"' widget with illegal ref expression: '"+b+"'");}if(c)if(e.isFunction(c.toPlainObject))this.binding=c,this._updateBinding("binding",
null,c);else throw Error("dojox.mvc._DataBindingMixin: '"+this.domNode+"' widget with illegal ref not evaluating to a dojo.Stateful node: '"+b+"'");}},_isEqual:function(a,b){return a===b||isNaN(a)&&typeof a==="number"&&isNaN(b)&&typeof b==="number"},_updateBinding:function(){this._unwatchArray(this._modelWatchHandles);var a=this.get("binding");if(a&&e.isFunction(a.watch)){var b=this;this._modelWatchHandles=[a.watch("value",function(a,f,d){b._isEqual(f,d)||b._isEqual(b.get("value"),d)||b.set("value",
d)}),a.watch("valid",function(a,f,d){b._updateProperty(a,f,d,!0);d!==b.get(a)&&b.validate&&e.isFunction(b.validate)&&b.validate()}),a.watch("required",function(a,f,d){b._updateProperty(a,f,d,!1,a,d)}),a.watch("readOnly",function(a,f,d){b._updateProperty(a,f,d,!1,a,d)}),a.watch("relevant",function(a,f,d){b._updateProperty(a,f,d,!1,"disabled",!d)})];a=a.get("value");a!=null&&this.set("value",a)}this._updateChildBindings()},_updateProperty:function(a,b,c,f,d,e){b!==c&&(c===null&&f!==void 0&&(c=f),c!==
this.get("binding").get(a)&&this.get("binding").set(a,c),d&&this.set(d,e))},_updateChildBindings:function(a){var b=this.get("binding")||a;b&&!this._beingBound&&h.forEach(g.findWidgets(this.domNode),function(a){a.ref&&a._setupBinding?a._setupBinding(b):a._updateChildBindings(b)})},_getParentBindingFromDOM:function(){for(var a=this.domNode.parentNode,b;a;){if(a=g.getEnclosingWidget(a))if((b=a.get("binding"))&&e.isFunction(b.toPlainObject))break;a=a?a.domNode.parentNode:null}return b},_unwatchArray:function(a){h.forEach(a,
function(a){a.unwatch()})}})});