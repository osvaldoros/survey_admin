//>>built
define(["dijit","dojo","dojox"],function(v,d){d.provide("dojox.robot.recorder");d.experimental("dojox.robot.recorder");(function(){var h=[],s=0,i=null,k=null,g=function(a,b){if(!(i==null||a=="doh.robot.keyPress"&&b[0]==d.keys.ENTER&&eval("("+b[2]+")").ctrl&&eval("("+b[2]+")").alt)){var c=Math.max(Math.min(Math.round((new Date).getTime()-k.getTime()),1E4),1);a=="doh.robot.mouseMove"?b[2]=c:b[1]=c;h.push({name:a,args:b});k=new Date}},t=function(){var a=h;a[0].name=="doh.robot.keyPress"&&(a[0].args[0]==
d.keys.ENTER||a[0].args[0]==77)&&a.splice(0,1);for(var b=a.length-1;b>=a.length-2&&b>=0;b--)(a[b].name=="doh.robot.keyPress"&&a[b].args[0]==d.keys.ALT||a[b].args[0]==d.keys.CTRL)&&a.splice(b,1);for(b=0;b<a.length;b++){var c,e;if(a[b+1]&&a[b].name=="doh.robot.mouseMove"&&a[b+1].name==a[b].name&&a[b+1].args[2]<500){c=a[b+1];for(e=0;c&&c.name==a[b].name&&c.args[2]<500;)a.splice(b+1,1),e+=c.args[2],a[b].args[0]=c.args[0],a[b].args[1]=c.args[1],c=a[b+1];a[b].args[3]=e}else if(a[b+1]&&a[b].name=="doh.robot.mouseWheel"&&
a[b+1].name==a[b].name&&a[b+1].args[1]<500){c=a[b+1];for(e=0;c&&c.name==a[b].name&&c.args[1]<500;)a.splice(b+1,1),e+=c.args[1],a[b].args[0]+=c.args[0],c=a[b+1];a[b].args[2]=e}else if(a[b+2]&&a[b].name=="doh.robot.mouseMoveAt"&&a[b+2].name=="doh.robot.scrollIntoView")c=a.splice(b+2,1)[0],a.splice(b,0,c);else if(a[b+1]&&a[b].name=="doh.robot.mousePress"&&a[b+1].name=="doh.robot.mouseRelease"&&a[b].args[0]==a[b+1].args[0])a[b].name="doh.robot.mouseClick",a.splice(b+1,1),a[b+1]&&a[b+1].name=="doh.robot.mouseClick"&&
a[b].args[0]==a[b+1].args[0]&&a.splice(b+1,1);else if(a[b+1]&&a[b-1]&&a[b-1].name=="doh.robot.mouseMoveAt"&&a[b].name=="doh.robot.mousePress"&&a[b+1].name=="doh.robot.mouseMove")a.splice(b+1,0,{name:"doh.robot.mouseMoveAt",args:[a[b-1].args[0],1,100,a[b-1].args[3]+1,a[b-1].args[4]]});else if(a[b+1]&&(a[b].name=="doh.robot.keyPress"&&typeof a[b].args[0]=="string"||a[b].name=="doh.robot.typeKeys")&&a[b+1].name=="doh.robot.keyPress"&&typeof a[b+1].args[0]=="string"&&a[b+1].args[1]<=1E3&&!eval("("+a[b].args[2]+
")").ctrl&&!eval("("+a[b].args[2]+")").alt&&!eval("("+a[b+1].args[2]+")").ctrl&&!eval("("+a[b+1].args[2]+")").alt){a[b].name="doh.robot.typeKeys";a[b].args.splice(3,1);c=a[b+1];for(e=0;c&&c.name=="doh.robot.keyPress"&&typeof c.args[0]=="string"&&c.args[1]<=1E3&&!eval("("+c.args[2]+")").ctrl&&!eval("("+c.args[2]+")").alt;)a.splice(b+1,1),a[b].args[0]+=c.args[0],e+=c.args[1],c=a[b+1];a[b].args[2]=e;a[b].args[0]="'"+a[b].args[0]+"'"}else if(a[b].name=="doh.robot.keyPress")if(typeof a[b].args[0]=="string")a[b].args[0]=
"'"+a[b].args[0]+"'";else if(a[b].args[0]==0)a.splice(b,1);else for(var f in d.keys)if(d.keys[f]==a[b].args[0]){a[b].args[0]="dojo.keys."+f;break}}},u=function(){var a=Math.round((new Date).getTime()-i.getTime());i=null;t();var b=h;console.log("Stop called. Commands: "+b.length);if(b.length){var c="doh.register('dojox.robot.AutoGeneratedTestGroup',{\n";c+="     name: 'autotest"+s++ +"',\n";c+="     timeout: "+(a+2E3)+",\n";c+="     runTest: function(){\n";c+="          var d = new doh.Deferred();\n";
for(a=0;a<b.length;a++){c+="          "+b[a].name+"(";for(var e=0;e<b[a].args.length;e++)c+=b[a].args[e],e!=b[a].args.length-1&&(c+=", ");c+=");\n"}c+="          doh.robot.sequence(function(){\n";c+="               if(/*Your condition here*/){\n";c+="                    d.callback(true);\n";c+="               }else{\n";c+="                    d.errback(new Error('We got a failure'));\n";c+="               }\n";c+="          }, 1000);\n";c+="          return d;\n";c+="     }\n";c+="});\n";var f=document.createElement("div");
f.id="dojox.robot.recorder";f.style.backgroundColor="white";f.style.position="absolute";b={y:window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,x:window.pageXOffset||(window.dojo?d._fixIeBiDiScrollLeft(document.documentElement.scrollLeft):void 0)||document.body.scrollLeft||0};f.style.left=b.x+"px";f.style.top=b.y+"px";b=document.createElement("h1");b.innerHTML="Your code:";f.appendChild(b);b=document.createElement("pre");b.innerText!==void 0?b.innerText=c:b.textContent=
c;f.appendChild(b);c=document.createElement("button");c.innerHTML="Close";var g=d.connect(c,"onmouseup",function(a){d.stopEvent(a);document.body.removeChild(f);d.disconnect(g)});f.appendChild(c);document.body.appendChild(f);h=[]}},j=function(a){if(typeof a=="string")return"'"+a+"'";else if(a.id)return"'"+a.id+"'";else{var b=document.getElementsByTagName(a.nodeName),c;for(c=0;c<b.length;c++)if(b[c]==a)break;return"function(){ return document.getElementsByTagName('"+a.nodeName+"')["+c+"]; }"}},l=function(a){return"{left:"+
(a==0)+", middle:"+(a==1)+", right:"+(a==2)+"}"};d.connect(document,"onkeydown",function(a){if((a.keyCode==d.keys.ENTER||a.keyCode==77)&&a.ctrlKey&&a.altKey)d.stopEvent(a),i?u():(alert("Started recording."),h=[],i=new Date,k=new Date)});var e={type:""},m=function(a){if(a&&!(e.type==a.type&&e.button==a.button)){e={type:a.type,button:a.button};var b=j(a.target),c=d.coords(a.target);g("doh.robot.mouseMoveAt",[b,0,100,a.clientX-c.x,a.clientY-c.y]);g("doh.robot.mousePress",[l(a.button-(d.isIE?1:0)),0])}},
n=function(a){a&&!(e.type==a.type&&e.button==a.button)&&(e={type:a.type,button:a.button},j(a.target),d.coords(a.target),g("doh.robot.mouseClick",[l(a.button-(d.isIE?1:0)),0]))},o=function(a){a&&!(e.type==a.type&&e.button==a.button)&&(e={type:a.type,button:a.button},j(a.target),d.coords(a.target),g("doh.robot.mouseRelease",[l(a.button-(d.isIE?1:0)),0]))},p=function(a){a&&!(e.type==a.type&&e.pageX==a.pageX&&e.pageY==a.pageY)&&(e={type:a.type,detail:a.detail?a.detail:-a.wheelDelta/120},g("doh.robot.mouseWheel",
[e.detail]))},q=function(a){a&&!(e.type==a.type&&e.charCode==a.charCode&&e.keyCode==a.keyCode)&&(e={type:a.type,charCode:a.charCode,keyCode:a.keyCode},g("doh.robot.keyPress",[a.charOrCode==d.keys.SPACE?" ":a.charOrCode,0,"{'shift':"+a.shiftKey+", 'ctrl':"+a.ctrlKey+", 'alt':"+a.altKey+"}"]))},r=function(a){a&&!(e.type==a.type&&e.charCode==a.charCode&&e.keyCode==a.keyCode)&&(e={type:a.type,charCode:a.charCode,keyCode:a.keyCode})};d.connect(document,"onmousedown",m);d.connect(document,"onmouseup",o);
d.connect(document,"onclick",n);d.connect(document,"onkeypress",q);d.connect(document,"onkeyup",r);d.connect(document,"onmousemove",function(a){a&&!(e.type==a.type&&e.pageX==a.pageX&&e.pageY==a.pageY)&&(e={type:a.type,pageX:a.pageX,pageY:a.pageY},g("doh.robot.mouseMove",[a.pageX,a.pageY,0,100,!0]))});d.connect(document,!d.isMozilla?"onmousewheel":"DOMMouseScroll",p);d.addOnLoad(function(){d.window&&d.connect(d.window,"scrollIntoView",function(a){g("doh.robot.scrollIntoView",[j(a)])})});d.connect(d,
"connect",function(a,b,c){if(a&&(!c||!c._mine))if(c=null,b.toLowerCase()=="onmousedown"?c=d.hitch(this,m):b.toLowerCase()==(!d.isMozilla?"onmousewheel":"dommousescroll")?c=d.hitch(this,p):b.toLowerCase()=="onclick"?c=d.hitch(this,n):b.toLowerCase()=="onmouseup"?c=d.hitch(this,o):b.toLowerCase()=="onkeypress"?c=d.hitch(this,q):b.toLowerCase()=="onkeyup"&&(c=d.hitch(this,r)),c!=null)c._mine=!0,d.connect(a,b,c)})})()});