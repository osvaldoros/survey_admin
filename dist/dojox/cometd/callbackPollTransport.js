//>>built
define(["dijit","dojo","dojox","dojo/require!dojox/cometd/_base,dojox/cometd/longPollTransport,dojo/io/script"],function(f,c,b){c.provide("dojox.cometd.callbackPollTransport");c.require("dojox.cometd._base");c.require("dojox.cometd.longPollTransport");c.require("dojo.io.script");b.cometd.callbackPollTransport=new function(){this._connectionType="callback-polling";this._cometd=null;this.check=function(a){return c.indexOf(a,"callback-polling")>=0};this.tunnelInit=function(){var a={channel:"/meta/connect",
clientId:this._cometd.clientId,connectionType:this._connectionType,id:""+this._cometd.messageId++},a=this._cometd._extendOut(a);this.openTunnelWith([a])};this.tunnelCollapse=b.cometd.longPollTransport.tunnelCollapse;this._connect=b.cometd.longPollTransport._connect;this.deliver=b.cometd.longPollTransport.deliver;this.openTunnelWith=function(a,e){this._cometd._polling=!0;var b={load:c.hitch(this,function(a){this._cometd._polling=!1;this._cometd.deliver(a);this._cometd._backon();this.tunnelCollapse()}),
error:c.hitch(this,function(){this._cometd._polling=!1;this._cometd._publishMeta("connect",!1);this._cometd._backoff();this.tunnelCollapse()}),url:e||this._cometd.url,content:{message:c.toJson(a)},callbackParamName:"jsonp"},d=this._cometd._connectTimeout();if(d>0)b.timeout=d;c.io.script.get(b)};this.sendMessages=function(a){for(var b=0;b<a.length;b++)a[b].clientId=this._cometd.clientId,a[b].id=""+this._cometd.messageId++,a[b]=this._cometd._extendOut(a[b]);b={url:this._cometd.url||c.config.cometdRoot,
load:c.hitch(this._cometd,"deliver"),callbackParamName:"jsonp",content:{message:c.toJson(a)},error:c.hitch(this,function(){this._cometd._publishMeta("publish",!1,{messages:a})}),timeout:this._cometd.expectedNetworkDelay};return c.io.script.get(b)};this.startup=function(){this._cometd._connected||this.tunnelInit()};this.disconnect=b.cometd.longPollTransport.disconnect;this.disconnect=function(){var a={channel:"/meta/disconnect",clientId:this._cometd.clientId,id:""+this._cometd.messageId++},a=this._cometd._extendOut(a);
c.io.script.get({url:this._cometd.url||c.config.cometdRoot,callbackParamName:"jsonp",content:{message:c.toJson([a])}})};this.cancelConnect=function(){}};b.cometd.connectionTypes.register("callback-polling",b.cometd.callbackPollTransport.check,b.cometd.callbackPollTransport)});