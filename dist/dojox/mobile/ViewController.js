//>>built
define("dojox/mobile/ViewController",["dojo/_base/kernel","dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/_base/lang","dojo/_base/window","dojo/dom","dojo/dom-class","dojo/dom-construct","dojo/on","dojo/ready","dijit/registry","./ProgressIndicator","./TransitionEvent"],function(n,q,r,j,l,o,s,t,p,u,v,g,w,x){var f=l.getObject("dojox.mobile",!0),j=j("dojox.mobile.ViewController",null,{constructor:function(){this.viewMap={};this.defaultView=this.currentView=null;v(l.hitch(this,function(){u(o.body(),
"startTransition",l.hitch(this,"onStartTransition"))}))},findCurrentView:function(a,h){if(a){var b=g.byId(a);if(b&&b.getShowingView)return b.getShowingView()}if(f.currentView)return f.currentView;for(b=h;;){b=b.getParent();if(!b)return null;if(t.contains(b.domNode,"mblView"))break}return b},onStartTransition:function(a){a.preventDefault();if(a.detail&&(!a.detail||a.detail.moveTo||a.detail.href||a.detail.url||a.detail.scene)){var h=this.findCurrentView(a.detail.moveTo,a.target&&a.target.id?g.byId(a.target.id):
g.byId(a.target));if(h&&(!a.detail||!(a.detail.moveTo&&h===g.byId(a.detail.moveTo))))if(a.detail.href){var b=g.byId(a.target.id).hrefTarget;b?f.openWindow(a.detail.href,b):h.performTransition(null,a.detail.transitionDir,a.detail.transition,a.target,function(){location.href=a.detail.href})}else if(a.detail.scene)r.publish("/dojox/mobile/app/pushScene",[a.detail.scene]);else{var d=a.detail.moveTo;if(a.detail.url){if(f._viewMap&&f._viewMap[a.detail.url])b=f._viewMap[a.detail.url];else{var c=this._text;
if(!c)if(g.byId(a.target.id).sync)n.xhrGet({url:a.detail.url,sync:!0,load:function(a){c=l.trim(a)}});else{require(["dojo/_base/xhr"],l.hitch(this,function(b){var c=w.getInstance();o.body().appendChild(c.domNode);c.start();b=b.get({url:a.detail.url,handleAs:"text"});b.addCallback(l.hitch(this,function(b){c.stop();if(b)this._text=b,(new x(a.target,{transition:a.detail.transition,transitionDir:a.detail.transitionDir,moveTo:d,href:a.detail.href,url:a.detail.url,scene:a.detail.scene},a.detail)).dispatch()}));
b.addErrback(function(b){c.stop();console.log("Failed to load "+a.detail.url+"\n"+(b.description||b))})}));return}this._text=null;b=this._parse(c,g.byId(a.target.id).urlTarget);if(!f._viewMap)f._viewMap=[];f._viewMap[a.detail.url]=b}d=b;h=this.findCurrentView(d,g.byId(a.target.id))||h}h.performTransition(d,a.detail.transitionDir,a.detail.transition,null,null)}}},_parse:function(a,h){var b,d,c,f,e=this.findCurrentView(),e=g.byId(h)&&g.byId(h).containerNode||s.byId(h)||e&&e.domNode.parentNode||o.body(),
k=null;for(b=e.childNodes.length-1;b>=0;b--)if(c=e.childNodes[b],c.nodeType===1){c.getAttribute("fixed")==="bottom"&&(k=c);break}if(a.charAt(0)==="<"){b=p.create("DIV",{innerHTML:a});for(c=0;c<b.childNodes.length;c++)if(f=b.childNodes[c],f.nodeType===1){d=f;break}if(!d){console.log("dojox.mobile.ViewController#_parse: invalid view content");return}d.style.visibility="hidden";e.insertBefore(b,k);c=n.parser.parse(b);q.forEach(c,function(a){a&&!a._started&&a.startup&&a.startup()});c=0;for(f=b.childNodes.length;c<
f;c++)e.insertBefore(b.firstChild,k);e.removeChild(b);g.byNode(d)._visible=!0}else if(a.charAt(0)==="{"){b=p.create("DIV");e.insertBefore(b,k);this._ws=[];d=this._instantiate(eval("("+a+")"),b);for(c=0;c<this._ws.length;c++)e=this._ws[c],e.startup&&!e._started&&(!e.getParent||!e.getParent())&&e.startup();this._ws=null}d.style.display="none";d.style.visibility="visible";return n.hash?"#"+d.id:d.id},_instantiate:function(a,f,b){var d,c;for(c in a)if(c.charAt(0)!="@"){var g=l.getObject(c);if(g)for(var e=
{},k=g.prototype,j=l.isArray(a[c])?a[c]:[a[c]],m=0;m<j.length;m++){for(var i in j[m])i.charAt(0)=="@"&&(d=j[m][i],i=i.substring(1),typeof k[i]=="string"?e[i]=d:typeof k[i]=="number"?e[i]=d-0:typeof k[i]=="boolean"?e[i]=d!="false":typeof k[i]=="object"&&(e[i]=eval("("+d+")")));d=new g(e,f);if(f)d._visible=!0,this._ws.push(d);b&&b.addChild&&b.addChild(d);this._instantiate(j[m],null,d)}}return d&&d.domNode}});new j;return j});