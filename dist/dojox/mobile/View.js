//>>built
define("dojox/mobile/View",["dojo/_base/kernel","dojo/_base/array","dojo/_base/config","dojo/_base/connect","dojo/_base/declare","dojo/_base/lang","dojo/_base/sniff","dojo/_base/window","dojo/_base/Deferred","dojo/dom","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dijit/registry","dijit/_Contained","dijit/_Container","dijit/_WidgetBase","./ViewController","./transition"],function(q,u,o,m,v,l,p,h,r,s,j,t,k,n,w,x,y,A,z){var i=l.getObject("dojox.mobile",!0);return v("dojox.mobile.View",[y,x,
w],{selected:!1,keepScrollPos:!0,constructor:function(a,b){if(b)s.byId(b).style.visibility="hidden";this._aw=p("android")>=2.2&&p("android")<3},buildRendering:function(){this.domNode=this.containerNode=this.srcNodeRef||h.doc.createElement("DIV");this.domNode.className="mblView";this.connect(this.domNode,"webkitAnimationEnd","onAnimationEnd");this.connect(this.domNode,"webkitAnimationStart","onAnimationStart");o.mblCSS3Transition||this.connect(this.domNode,"webkitTransitionEnd","onAnimationEnd");var a=
location.href.match(/#(\w+)([^\w=]|$)/)?RegExp.$1:null;this._visible=this.selected&&!a||this.id==a;if(this.selected)i._defaultView=this},startup:function(){if(!this._started){for(var a=[],b=this.domNode.parentNode.childNodes,d=!1,e=0;e<b.length;e++){var c=b[e];c.nodeType===1&&j.contains(c,"mblView")&&(a.push(c),d=d||n.byNode(c)._visible)}var f=this._visible;if(a.length===1||!d&&a[0]===this.domNode)f=!0;var g=this;setTimeout(function(){f?(i.currentView=g,g.onStartView(),m.publish("/dojox/mobile/startView",
[g])):g.domNode.style.display="none";if(g.domNode.style.visibility!="visible")g.domNode.style.visibility="visible";var a=g.getParent&&g.getParent();(!a||!a.resize)&&g.resize()},p("ie")?100:0);this.inherited(arguments)}},resize:function(){u.forEach(this.getChildren(),function(a){a.resize&&a.resize()})},onStartView:function(){},onBeforeTransitionIn:function(){},onAfterTransitionIn:function(){},onBeforeTransitionOut:function(){},onAfterTransitionOut:function(){},_saveState:function(a,b,d,e,c){this._context=
e;this._method=c;d=="none"&&(d=null);this._moveTo=a;this._dir=b;this._transition=d;this._arguments=l._toArray(arguments);this._args=[];if(e||c)for(var f=5;f<arguments.length;f++)this._args.push(arguments[f])},_fixViewState:function(a){for(var b=this.domNode.parentNode.childNodes,d=0;d<b.length;d++){var e=b[d];if(e.nodeType===1&&j.contains(e,"mblView"))e.className="mblView"}a.className="mblView"},convertToId:function(a){if(typeof a=="string")return a.match(/^#?([^&?]+)/),RegExp.$1;return a},performTransition:function(a,
b,d){if(a!=="#")if(q.hash&&typeof a=="string"&&a.charAt(0)=="#"&&!i._params){i._params=[];for(var e=0;e<arguments.length;e++)i._params.push(arguments[e]);q.hash(a)}else{this._saveState.apply(this,arguments);var c;if(a)c=this.convertToId(a);else{if(!this._dummyNode)this._dummyNode=h.doc.createElement("DIV"),h.body().appendChild(this._dummyNode);c=this._dummyNode}var f=this.domNode,g=f.offsetTop;if(c=this.toNode=s.byId(c)){c.style.visibility=this._aw?"visible":"hidden";c.style.display="";this._fixViewState(c);
if(e=n.byNode(c)){if(o.mblAlwaysResizeOnTransition||!e._resized)i.resizeAll(null,e),e._resized=!0;if(d&&d!="none")e.containerNode.style.paddingTop=g+"px";e.movedFrom=f.id}this.onBeforeTransitionOut.apply(this,arguments);m.publish("/dojox/mobile/beforeTransitionOut",[this].concat(l._toArray(arguments)));if(e){if(this.keepScrollPos&&!this.getParent()){g=h.body().scrollTop||h.doc.documentElement.scrollTop||h.global.pageYOffset||0;f._scrollTop=g;var j=b==1?0:c._scrollTop||0;c.style.top="0px";if(g>1||
j!==0)f.style.top=j-g+"px",o.mblHideAddressBar!==!1&&setTimeout(function(){h.global.scrollTo(0,j||1)},0)}else c.style.top="0px";e.onBeforeTransitionIn.apply(e,arguments);m.publish("/dojox/mobile/beforeTransitionIn",[e].concat(l._toArray(arguments)))}if(!this._aw)c.style.display="none",c.style.visibility="visible";i._iw&&i.scrollable?(e=i.getScreenSize(),h.body().appendChild(i._iwBgCover),k.set(i._iwBgCover,{position:"absolute",top:"0px",left:"0px",height:e.h+1+"px",width:e.w+"px",backgroundColor:k.get(h.body(),
"background-color"),zIndex:-1E4,display:""}),k.set(c,{position:"absolute",zIndex:-10001,visibility:"visible",display:""}),setTimeout(l.hitch(this,function(){this._doTransition(f,c,d,b)}),80)):this._doTransition(f,c,d,b)}else console.log("dojox.mobile.View#performTransition: destination view not found: "+a)}},_toCls:function(a){return"mbl"+a.charAt(0).toUpperCase()+a.substring(1)},_doTransition:function(a,b,d,e){var c=e==-1?" mblReverse":"";if(i._iw&&i.scrollable)k.set(b,{position:"",zIndex:""}),h.body().removeChild(i._iwBgCover);
else if(!this._aw)b.style.display="";if(!d||d=="none")this.domNode.style.display="none",this.invokeCallback();else if(o.mblCSS3Transition)r.when(z,l.hitch(this,function(c){var f=k.get(b,"position");k.set(b,"position","absolute");r.when(c(a,b,{transition:d,reverse:e===-1?!0:!1}),l.hitch(this,function(){k.set(b,"position",f);this.invokeCallback()}))}));else{var f=this._toCls(d);j.add(a,f+" mblOut"+c);j.add(b,f+" mblIn"+c);setTimeout(function(){j.add(a,"mblTransition");j.add(b,"mblTransition")},100);
var c=f="50% 50%",g;d.indexOf("swirl")!=-1||d.indexOf("zoom")!=-1?(f=this.keepScrollPos&&!this.getParent()?h.body().scrollTop||h.doc.documentElement.scrollTop||h.global.pageYOffset||0:-t.position(a,!0).y,g=h.global.innerHeight/2+f,f="50% "+g+"px",c="50% "+g+"px"):d.indexOf("scale")!=-1&&(f=t.position(a,!0),c=(this.clickedPosX!==void 0?this.clickedPosX:h.global.innerWidth/2)-f.x,f=this.keepScrollPos&&!this.getParent()?h.body().scrollTop||h.doc.documentElement.scrollTop||h.global.pageYOffset||0:-f.y,
g=(this.clickedPosY!==void 0?this.clickedPosY:h.global.innerHeight/2)+f,f=c+"px "+g+"px",c=c+"px "+g+"px");k.set(a,{webkitTransformOrigin:f});k.set(b,{webkitTransformOrigin:c})}i.currentView=n.byNode(b)},onAnimationStart:function(){},onAnimationEnd:function(a){var b=a.animationName||a.target.className;if(!(b.indexOf("Out")===-1&&b.indexOf("In")===-1&&b.indexOf("Shrink")===-1)){var d=!1;j.contains(this.domNode,"mblOut")?(d=!0,this.domNode.style.display="none",j.remove(this.domNode,[this._toCls(this._transition),
"mblIn","mblOut","mblReverse"])):this.containerNode.style.paddingTop="";k.set(this.domNode,{webkitTransformOrigin:""});if(b.indexOf("Shrink")!==-1)a=a.target,a.style.display="none",j.remove(a,"mblCloseContent");d&&this.invokeCallback();this.domNode&&(this.domNode.className="mblView");this.clickedPosX=this.clickedPosY=void 0}},invokeCallback:function(){this.onAfterTransitionOut.apply(this,this._arguments);m.publish("/dojox/mobile/afterTransitionOut",[this].concat(this._arguments));var a=n.byNode(this.toNode);
if(a)a.onAfterTransitionIn.apply(a,this._arguments),m.publish("/dojox/mobile/afterTransitionIn",[a].concat(this._arguments)),a.movedFrom=void 0;var a=this._context,b=this._method;if(a||b)b||(b=a,a=null),a=a||h.global,typeof b=="string"?a[b].apply(a,this._args):b.apply(a,this._args)},getShowingView:function(){for(var a=this.domNode.parentNode.childNodes,b=0;b<a.length;b++){var d=a[b];if(d.nodeType===1&&j.contains(d,"mblView")&&k.get(d,"display")!=="none")return n.byNode(d)}return null},show:function(){var a=
this.getShowingView();if(a)a.domNode.style.display="none";this.domNode.style.display="";i.currentView=this}})});