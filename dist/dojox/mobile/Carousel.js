//>>built
define("dojox/mobile/Carousel",["dojo/_base/kernel","dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/_base/event","dojo/_base/lang","dojo/_base/sniff","dojo/dom-class","dojo/dom-construct","dojo/dom-style","dijit/_Contained","dijit/_Container","dijit/_WidgetBase","./PageIndicator","./SwapView","require"],function(p,l,j,q,r,m,s,n,b,g,t,u,v,w,o,x){p.experimental("dojox.mobile.Carousel");return q("dojox.mobile.Carousel",[v,u,t],{numVisible:3,title:"",pageIndicator:!0,navButton:!1,height:"300px",
store:null,query:null,queryOptions:null,buildRendering:function(){this.inherited(arguments);this.domNode.className="mblCarousel";var a;if(this.height==="inherit")this.domNode.offsetParent&&(a=this.domNode.offsetParent.offsetHeight+"px");else if(this.height)a=this.height;this.domNode.style.height=a;this.headerNode=b.create("DIV",{className:"mblCarouselHeaderBar"},this.domNode);if(this.navButton)this.btnContainerNode=b.create("DIV",{className:"mblCarouselBtnContainer"},this.headerNode),g.set(this.btnContainerNode,
"float","right"),this.prevBtnNode=b.create("BUTTON",{className:"mblCarouselBtn",title:"Previous",innerHTML:"&lt;"},this.btnContainerNode),this.nextBtnNode=b.create("BUTTON",{className:"mblCarouselBtn",title:"Next",innerHTML:"&gt;"},this.btnContainerNode),this.connect(this.prevBtnNode,"onclick","onPrevBtnClick"),this.connect(this.nextBtnNode,"onclick","onNextBtnClick");if(this.pageIndicator){if(!this.title)this.title="&nbsp;";this.piw=new w;g.set(this.piw,"float","right");this.headerNode.appendChild(this.piw.domNode)}this.titleNode=
b.create("DIV",{className:"mblCarouselTitle"},this.headerNode);this.containerNode=b.create("DIV",{className:"mblCarouselPages"},this.domNode);j.subscribe("/dojox/mobile/viewChanged",this,"handleViewChanged")},startup:function(){if(!this._started){if(this.store){var a=this.store;this.store=null;this.setStore(a,this.query,this.queryOptions)}this.inherited(arguments)}},setStore:function(a,c,d){if(a!==this.store)this.store=a,this.query=c,this.queryOptions=d,this.refresh()},refresh:function(){this.store&&
this.store.fetch({query:this.query,queryOptions:this.queryOptions,onComplete:m.hitch(this,"generate"),onError:m.hitch(this,"onError")})},generate:function(a){l.forEach(this.getChildren(),function(a){a instanceof o&&a.destroyRecursive()});this.items=a;this.swapViews=[];this.images=[];for(var c=Math.ceil(a.length/this.numVisible),d=this.domNode.offsetHeight-this.headerNode.offsetHeight,b=0;b<c;b++){var e=new o({height:d+"px"});this.addChild(e);this.swapViews.push(e);e._carouselImages=[];if(b===0&&this.piw)this.piw.refId=
e.id;for(var h=0;h<this.numVisible;h++){var f=b*this.numVisible+h,i=f<a.length?a[f]:{src:x.toUrl("dojo/resources/blank.gif"),height:"1px"},g=e.domNode.style.display;e.domNode.style.display="";var k=this.createBox(i,d);e.containerNode.appendChild(k);k.appendChild(this.createHeaderText(i));f=this.createContent(i,f);k.appendChild(f);k.appendChild(this.createFooterText(i));this.resizeContent(i,k,f);e.domNode.style.display=g;i.height!=="1px"&&(this.images.push(f),e._carouselImages.push(f))}}this.swapViews[0]&&
this.loadImages(this.swapViews[0]);this.swapViews[1]&&this.loadImages(this.swapViews[1]);this.currentView=this.swapViews[0];this.piw&&this.piw.reset()},createBox:function(a,c){var d=a.width||90/this.numVisible+"%",j=a.height||c+"px",e=s("ie")?5/this.numVisible-1:5/this.numVisible,e=a.margin||e+"%",h=b.create("DIV",{className:"mblCarouselBox"});g.set(h,{margin:"0px "+e,width:d,height:j});return h},createHeaderText:function(a){return this.headerTextNode=b.create("DIV",{className:"mblCarouselImgHeaderText",
innerHTML:a.headerText?a.headerText:"&nbsp;"})},createContent:function(a,c){var d=b.create("IMG",{alt:a.alt||"",tabIndex:"0",className:"mblCarouselImg"});d._idx=c;a.height!=="1px"?(this.connect(d,"onclick","onClick"),this.connect(d,"onkeydown","onClick"),j.connect(d,"ondragstart",r.stop)):d.style.visibility="hidden";return d},createFooterText:function(a){return this.footerTextNode=b.create("DIV",{className:"mblCarouselImgFooterText",innerHTML:a.footerText?a.footerText:"&nbsp;"})},resizeContent:function(a,
c,b){if(a.height!=="1px")b.style.height=c.offsetHeight-this.headerTextNode.offsetHeight-this.footerTextNode.offsetHeight+"px"},onError:function(){},onPrevBtnClick:function(){this.currentView&&this.currentView.goTo(-1)},onNextBtnClick:function(){this.currentView&&this.currentView.goTo(1)},onClick:function(a){if(!a||!(a.type==="keydown"&&a.keyCode!==13)){for(var c=a.currentTarget,a=0;a<this.images.length;a++)this.images[a]===c?n.add(c,"mblCarouselImgSelected"):n.remove(this.images[a],"mblCarouselImgSelected");
g.set(c,"opacity",0.4);setTimeout(function(){g.set(c,"opacity",1)},1E3);j.publish("/dojox/mobile/carouselSelect",[this,c,this.items[c._idx],c._idx])}},loadImages:function(a){a&&l.forEach(a._carouselImages,function(a){if(!a.src)a.src=this.items[a._idx].src},this)},handleViewChanged:function(a){if(a.getParent()===this)this.currentView=a,this.loadImages(a.nextView(a.domNode))},_setTitleAttr:function(a){this.title=a;this.titleNode.innerHTML=this._cv?this._cv(a):a}})});