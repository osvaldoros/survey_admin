//>>built
define("dojox/socket",["dojo","dojo/Evented","dojo/cookie","dojo/_base/url"],function(c,m){function h(a){typeof a=="string"&&(a={url:a});return j?dojox.socket.WebSocket(a,!0):dojox.socket.LongPoll(a)}var j=window.WebSocket;dojox.socket=h;h.WebSocket=function(a,d){var b=new j(new c._Url(document.baseURI.replace(/^http/i,"ws"),a.url));b.on=function(a,c){b.addEventListener(a,c,!0)};var i;c.connect(b,"onopen",function(){i=!0});c.connect(b,"onclose",function(){i||d&&h.replace(b,dojox.socket.LongPoll(a),
!0)});return b};h.replace=function(a,d,b){function i(b){(d.addEventListener||d.on).call(d,b,function(b){var c=document.createEvent("MessageEvent");c.initMessageEvent(b.type,!1,!1,b.data,b.origin,b.lastEventId,b.source);a.dispatchEvent(c)},!0)}a.send=c.hitch(d,"send");a.close=c.hitch(d,"close");b&&i("open");c.forEach(["message","close","error"],i)};h.LongPoll=function(a){function d(){e.readyState==0&&b("open",{});g.length||e.send()}function b(b,a,f){if(e["on"+b]){var d=document.createEvent("HTMLEvents");
d.initEvent(b,!1,!1);c.mixin(d,a);d.ioArgs=f&&f.ioArgs;e["on"+b](d)}}var i=!1,h=!0,j,g=[],e={send:function(k){var l=c.delegate(a);l.rawBody=k;clearTimeout(j);var f=h?(h=!1)||e.firstRequest(l):e.transport(l);g.push(f);f.then(function(k){e.readyState=1;g.splice(c.indexOf(g,f),1);g.length||(j=setTimeout(d,a.interval));k&&b("message",{data:k},f)},function(a){g.splice(c.indexOf(g,f),1);if(!i&&(b("error",{error:a},f),!g.length))e.readyState=3,b("close",{wasClean:!1},f)});return f},close:function(){e.readyState=
2;i=!0;for(var a=0;a<g.length;a++)g[a].cancel();e.readyState=3;b("close",{wasClean:!0})},transport:a.transport||c.xhrPost,args:a,url:a.url,readyState:0,CONNECTING:0,OPEN:1,CLOSING:2,CLOSED:3,dispatchEvent:function(a){b(a.type,a)},on:m.prototype.on,firstRequest:function(a){var b=a.headers||(a.headers={});b.Pragma="start-long-poll";try{return this.transport(a)}finally{delete b.Pragma}}};e.connect=e.on;setTimeout(d);return e};return h});