//>>built
define("dojox/charting/action2d/_IndicatorElement",["dojo/_base/lang","dojo/_base/declare","../Element","../plot2d/common","../axis2d/common","dojox/gfx"],function(s,v,w,q,x,t){var y=function(b){var a=b.declaredClass;if(a.indexOf("svg")!=-1)try{return s.mixin({},b.rawNode.getBBox())}catch(f){return null}else if(a.indexOf("vml")!=-1){var a=b.rawNode,d=a.style.display;a.style.display="inline";var c=t.pt2px(parseFloat(a.currentStyle.width)),g=t.pt2px(parseFloat(a.currentStyle.height)),c={x:0,y:0,width:c,
height:g};u(b,c);a.style.display=d;return c}else if(a.indexOf("silverlight")!=-1)return u(b,{width:b.rawNode.actualWidth,height:b.rawNode.actualHeight},0.75);else if(b.getTextWidth)return c=b.getTextWidth(),a=b.getFont(),g=t.normalizedLength(a?a.size:t.defaultFont.size),c={width:c,height:g},u(b,c,0.75),c},u=function(b,a,f){var d=a.width,c=a.height,b=b.getShape();switch(b.align){case "end":a.x=b.x-d;break;case "middle":a.x=b.x-d/2;break;default:a.x=b.x}a.y=b.y-c*(f||1);return a};return v("dojox.charting.action2d._IndicatorElement",
[w],{constructor:function(b,a){a||(a={});this.inter=a.inter},_updateVisibility:function(b,a,f){var d=f=="x"?this.inter.plot._hAxis:this.inter.plot._vAxis,c=d.getWindowScale();this.chart.setAxisWindow(d.name,c,d.getWindowOffset()+(b[f]-a[f])/c);this._noDirty=!0;this.chart.render();this._noDirty=!1;this._tracker||this.initTrack()},_trackMove:function(){this._updateIndicator(this.pageCoord);if(this._initTrackPhase)this._initTrackPhase=!1,this._tracker=setInterval(s.hitch(this,this._trackMove),100)},
initTrack:function(){this._initTrackPhase=!0;this._tracker=setTimeout(s.hitch(this,this._trackMove),500)},stopTrack:function(){if(this._tracker)this._initTrackPhase?clearTimeout(this._tracker):clearInterval(this._tracker),this._tracker=null},render:function(){this.isDirty()&&(this.cleanGroup(),this.pageCoord&&this._updateIndicator(this.pageCoord,this.secondCoord))},_updateIndicator:function(b,a){var f=this.inter,d=f.plot,c=f.opt.vertical,g=this.chart.getAxis(d.hAxis),h=this.chart.getAxis(d.vAxis),
i=g.name,e=h.name,k=g.getScaler().bounds,m=h.getScaler().bounds,h=c?"x":"y",g=c?i:e,n=c?k:m;if(a){var j;c?b.x>a.x&&(j=a,a=b,b=j):b.y>a.y&&(j=a,a=b,b=j)}var l=d.toData(b),o;a&&(o=d.toData(a));var p={};p[i]=k.from;p[e]=m.from;j=d.toPage(p);p[i]=k.to;p[e]=m.to;m=d.toPage(p);if(l[g]<n.from){if(!o&&f.opt.autoScroll){this._updateVisibility(b,j,h);return}else b[h]=j[h];l=d.toData(b)}else if(l[g]>n.to){if(!o&&f.opt.autoScroll){this._updateVisibility(b,m,h);return}else b[h]=m[h];l=d.toData(b)}var k=this._getData(l,
h,c),r;k.y!=null&&(a&&(o[g]<n.from?(a[h]=j[h],o=d.toData(a)):o[g]>n.to&&(a[h]=m[h],o=d.toData(a)),r=this._getData(o,h,c),r.y==null&&(a=null)),d=this._renderIndicator(k,a?1:0,i,e,j,m),a&&(i=this._renderIndicator(r,2,i,e,j,m),e=c?r.y-k.y:r.x-k.y,this._renderText(f.opt.labelFunc?f.opt.labelFunc(k,r,f.opt.fixed,f.opt.precision):q.getLabel(e,f.opt.fixed,f.opt.precision)+" ("+q.getLabel(100*e/(c?k.y:k.x),!0,2)+"%)",f,this.chart.theme,c?(d.x+i.x)/2:d.x,c?d.y:(d.y+i.y)/2,k,r)))},_renderIndicator:function(b,
a,f,d,c,g){var h=this.chart.theme,i=this.chart.getCoords(),e=this.inter,k=e.plot,m=e.opt.vertical,n={};n[f]=b.x;n[d]=b.y;var n=k.toPage(n),f=n.x-i.x,k=n.y-i.y,n=m?f:c.x-i.x,c=m?c.y-i.y:k,d=m?n:g.x-i.x,g=m?g.y-i.y:c,j=e.opt.lineShadow?e.opt.lineShadow:h.indicator.lineShadow,i=e.opt.lineStroke?e.opt.lineStroke:h.indicator.lineStroke,l=e.opt.lineOutline?e.opt.lineOutline:h.indicator.lineOutline;j&&this.group.createLine({x1:n+j.dx,y1:c+j.dy,x2:d+j.dx,y2:g+j.dy}).setStroke(j);if(l)l=q.makeStroke(l),l.width=
2*l.width+i.width,this.group.createLine({x1:n,y1:c,x2:d,y2:g}).setStroke(l);this.group.createLine({x1:n,y1:c,x2:d,y2:g}).setStroke(i);var o=e.opt.markerSymbol?e.opt.markerSymbol:h.indicator.markerSymbol,p="M"+f+" "+k+" "+o,j=e.opt.markerShadow?e.opt.markerShadow:h.indicator.markerShadow,i=e.opt.markerStroke?e.opt.markerStroke:h.indicator.markerStroke,l=e.opt.markerOutline?e.opt.markerOutline:h.indicator.markerOutline;j&&this.group.createPath("M"+(f+j.dx)+" "+(k+j.dy)+" "+o).setFill(j.color).setStroke(j);
if(l)l=q.makeStroke(l),l.width=2*l.width+i.width,this.group.createPath(p).setStroke(l);f=this.group.createPath(p);k=this._shapeFill(e.opt.markerFill?e.opt.markerFill:h.indicator.markerFill,f.getBoundingBox());f.setFill(k).setStroke(i);if(a==0)this._renderText(e.opt.labelFunc?e.opt.labelFunc(b,null,e.opt.fixed,e.opt.precision):q.getLabel(m?b.y:b.x,e.opt.fixed,e.opt.precision),e,h,m?n:d+5,m?g+5:c,b);else return m?{x:n,y:g+5}:{x:d+5,y:c}},_renderText:function(b,a,f,d,c,g,h){b=x.createText.gfx(this.chart,
this.group,d,c,"middle",b,a.opt.font?a.opt.font:f.indicator.font,a.opt.fontColor?a.opt.fontColor:f.indicator.fontColor);d=y(b,b.getShape().text);d.x-=2;d.y-=1;d.width+=4;d.height+=2;d.r=a.opt.radius?a.opt.radius:f.indicator.radius;sh=a.opt.shadow?a.opt.shadow:f.indicator.shadow;ls=a.opt.stroke?a.opt.stroke:f.indicator.stroke;ol=a.opt.outline?a.opt.outline:f.indicator.outline;sh&&this.group.createRect(d).setFill(sh.color).setStroke(sh);if(ol)ol=q.makeStroke(ol),ol.width=2*ol.width+ls.width,this.group.createRect(d).setStroke(ol);
a=a.opt.fillFunc?a.opt.fillFunc(g,h):a.opt.fill?a.opt.fill:f.indicator.fill;this.group.createRect(d).setFill(this._shapeFill(a,d)).setStroke(ls);b.moveToFront()},_getData:function(b,a,f){var d=this.chart.getSeries(this.inter.opt.series).data,c,g,h=d.length;for(c=0;c<h;++c)if(g=d[c],g!=null)if(typeof g=="number"){if(c+1>b[a])break}else if(g[a]>b[a])break;var i,e;if(typeof g=="number")h=c+1,c>0&&(i=c,e=d[c-1]);else if(h=g.x,g=g.y,c>0)i=d[c-1].x,e=d[c-1].y;if(c>0&&b[a]<=(f?(h+i)/2:(g+e)/2))h=i,g=e;return{x:h,
y:g}},cleanGroup:function(){this.inherited(arguments);this.group.moveToFront();return this},clear:function(){this.dirty=!0;return this},getSeriesStats:function(){return s.delegate(q.defaultStats)},initializeScalers:function(){return this},isDirty:function(){return!this._noDirty&&(this.dirty||this.inter.plot.isDirty())}})});