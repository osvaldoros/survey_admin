//>>built
define("dojox/charting/widget/SelectableLegend",["dojo/_base/lang","dojo/_base/array","dojo/_base/declare","dojo/query","dojo/_base/html","dojo/_base/connect","dojo/_base/Color","./Legend","dijit/form/CheckBox","../action2d/Highlight","dojox/lang/functional","dojox/gfx/fx","dojo/keys","dojo/_base/event","dojo/dom-construct","dojo/dom-prop"],function(y,i,l,d,z,k,o,p,q,r,m,s,g,A,t,u){function v(a){if(a=="mouseenter")return"onmouseover";if(a=="mouseleave")return"onmouseout";return"on"+a}var w=l(null,
{constructor:function(a){this.legend=a;this.index=0;this.horizontalLength=this._getHrizontalLength();i.forEach(a.legends,function(a,b){b>0&&d("input",a).attr("tabindex",-1)});this.firstLabel=d("input",a.legends[0])[0];k.connect(this.firstLabel,"focus",this,function(){this.legend.active=!0});k.connect(this.legend.domNode,"keydown",this,"_onKeyEvent")},_getHrizontalLength:function(){var a=this.legend.horizontal;return typeof a=="number"?Math.min(a,this.legend.legends.length):a?this.legend.legends.length:
1},_onKeyEvent:function(a){if(this.legend.active)if(a.keyCode==g.TAB)this.legend.active=!1;else{var c=this.legend.legends.length;switch(a.keyCode){case g.LEFT_ARROW:this.index--;this.index<0&&(this.index+=c);break;case g.RIGHT_ARROW:this.index++;this.index>=c&&(this.index-=c);break;case g.UP_ARROW:this.index-this.horizontalLength>=0&&(this.index-=this.horizontalLength);break;case g.DOWN_ARROW:this.index+this.horizontalLength<c&&(this.index+=this.horizontalLength);break;default:return}this._moveToFocus();
Event.stop(a)}},_moveToFocus:function(){d("input",this.legend.legends[this.index])[0].focus()}});l("dojox.charting.widget.SelectableLegend",p,{outline:!1,transitionFill:null,transitionStroke:null,postCreate:function(){this.legends=[];this.legendAnim={};this.inherited(arguments)},refresh:function(){this.legends=[];this.inherited(arguments);this._applyEvents();new w(this)},_addLabel:function(a,c){this.inherited(arguments);var b=d("td",this.legendBody),b=b[b.length-1];this.legends.push(b);var e=new q({checked:!0});
t.place(e.domNode,b,"first");c=d("label",b)[0];u.set(c,"for",e.id)},_applyEvents:function(){this.chart.dirty||i.forEach(this.legends,function(a,c){var b,e=[],j,h;this._isPie()?(b=this.chart.stack[0],e.push(b.group.children[c]),j=b.name,h=this.chart.series[0].name):(b=this.chart.series[c],e=b.group.children,j=b.plot,h=b.name);var n={fills:m.map(e,"x.getFill()"),strokes:m.map(e,"x.getStroke()")};b=d(".dijitCheckBox",a)[0];k.connect(b,"onclick",this,function(b){this._toggle(e,c,a.vanished,n,h,j);a.vanished=
!a.vanished;b.stopPropagation()});var x=d(".dojoxLegendIcon",a)[0],f=this._getFilledShape(this._surfaces[c].children);i.forEach(["onmouseenter","onmouseleave"],function(b){k.connect(x,b,this,function(b){this._highlight(b,f,e,c,a.vanished,n,h,j)})},this)},this)},_toggle:function(a,c,b,e,d,h){i.forEach(a,function(a,c){var f=e.fills[c],d=this._getTransitionFill(h),j=e.strokes[c],i=this.transitionStroke;f&&(d&&(typeof f=="string"||f instanceof o)?s.animateFill({shape:a,color:{start:b?d:f,end:b?f:d}}).play():
a.setFill(b?f:d));j&&!this.outline&&a.setStroke(b?j:i)},this)},_highlight:function(a,c,b,e,d,h,g,k){if(!d){var f=this._getAnim(k),l=this._isPie(),m=v(a.type);f.process({shape:c,index:l?"legend"+e:"legend",run:{name:g},type:m});i.forEach(b,function(a,b){a.setFill(h.fills[b]);var c={shape:a,index:l?e:b,run:{name:g},type:m};f.duration=100;f.process(c)})}},_getAnim:function(a){this.legendAnim[a]||(this.legendAnim[a]=new r(this.chart,a));return this.legendAnim[a]},_getTransitionFill:function(a){if(this.chart.stack[this.chart.plots[a]].declaredClass.indexOf("dojox.charting.plot2d.Stacked")!=
-1)return this.chart.theme.plotarea.fill;return null},_getFilledShape:function(a){for(var c=0;a[c];){if(a[c].getFill())return a[c];c++}},_isPie:function(){return this.chart.stack[0].declaredClass=="dojox.charting.plot2d.Pie"}});return dojox.charting.widget.SelectableLegend});