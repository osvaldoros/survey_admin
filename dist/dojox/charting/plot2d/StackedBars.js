//>>built
define("dojox/charting/plot2d/StackedBars",["dojo/_base/lang","dojo/_base/array","dojo/_base/declare","./Bars","./common","dojox/lang/functional","dojox/lang/functional/reversed","dojox/lang/functional/sequence"],function(y,w,j,k,q,r,l){var x=l.lambda("item.purgeGroup()");return j("dojox.charting.plot2d.StackedBars",k,{getSeriesStats:function(){var c=q.collectStackedStats(this.series),f;this._maxRunLength=c.hmax;c.hmin-=0.5;c.hmax+=0.5;f=c.hmin;c.hmin=c.vmin;c.vmin=f;f=c.hmax;c.hmax=c.vmax;c.vmax=
f;return c},render:function(c,f){if(this._maxRunLength<=0)return this;for(var h=r.repeat(this._maxRunLength,"-> 0",0),g=0;g<this.series.length;++g)for(var d=this.series[g],b=0;b<d.data.length;++b){var a=d.data[b];if(a!==null){var e=typeof a=="number"?a:a.y;isNaN(e)&&(e=0);h[b]+=e}}if(this.zoom&&!this.isDataDirty())return this.performZoom(c,f);this.resetEvents();if(this.dirty=this.isDirty()){w.forEach(this.series,x);this._eventSeries={};this.cleanGroup();var m=this.group;r.forEachRev(this.series,function(a){a.cleanGroup(m)})}var i=
this.chart.theme,s,n,j=this._hScaler.scaler.getTransformerFromModel(this._hScaler),k=this._vScaler.scaler.getTransformerFromModel(this._vScaler),l=this.events(),g=q.calculateBarSize(this._vScaler.bounds.scale,this.opt);s=g.gap;n=g.size;for(g=this.series.length-1;g>=0;--g)if(d=this.series[g],!this.dirty&&!d.dirty)i.skip(),this._reconnectEvents(d.name);else{d.cleanGroup();for(var t=i.next("bar",[this.opt,d]),m=d.group,u=Array(h.length),b=0;b<h.length;++b)if(a=d.data[b],a!==null){var e=h[b],o=j(e),a=
typeof a!="number"?i.addMixin(t,"bar",a,!0):i.post(t,"bar");if(o>=0&&n>=1){var v={x:f.l,y:c.height-f.b-k(b+1.5)+s,width:o,height:n},p=this._plotFill(a.series.fill,c,f),p=this._shapeFill(p,v),a=m.createRect(v).setFill(p).setStroke(a.series.stroke);d.dyn.fill=a.getFill();d.dyn.stroke=a.getStroke();l&&(e={element:"bar",index:b,run:d,shape:a,x:e,y:b+1.5},this._connectEvents(e),u[b]=e);this.animate&&this._animateBar(a,f.l,-o)}}this._eventSeries[d.name]=u;d.dirty=!1;for(b=0;b<d.data.length;++b)a=d.data[b],
a!==null&&(e=typeof a=="number"?a:a.y,isNaN(e)&&(e=0),h[b]-=e)}this.dirty=!1;return this}})});