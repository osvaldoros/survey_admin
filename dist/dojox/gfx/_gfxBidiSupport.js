//>>built
define("dojox/gfx/_gfxBidiSupport",["./_base","dojo/_base/lang","dojo/_base/sniff","dojo/dom","dojo/_base/html","dojo/_base/array","./utils","./shape","dojox/string/BidiEngine"],function(b,j,k,o,m,p,h,f,q){function n(a,i){var g=l(i);g&&b.utils.forEach(a,function(a){if(a instanceof b.Surface||a instanceof b.Group)a.textDir=g;a instanceof b.Text&&a.setShape({textDir:g});a instanceof b.TextPath&&a.setText({textDir:g})},a);return a}function l(a){var b=["ltr","rtl","auto"];if(a&&(a=a.toLowerCase(),p.indexOf(b,
a)<0))return null;return a}j.getObject("dojox.gfx._gfxBidiSupport",!0);switch(b.renderer){case "vml":b.isVml=!0;break;case "svg":b.isSvg=!0;if(b.svg.useSvgWeb)b.isSvgWeb=!0;break;case "silverlight":b.isSilverlight=!0;break;case "canvas":b.isCanvas=!0}var c={LRM:"\u200e",LRE:"\u202a",PDF:"\u202c",RLM:"\u200f",RLE:"\u202b"},e=new q;j.extend(b.shape.Surface,{textDir:"",setTextDir:function(a){n(this,a)},getTextDir:function(){return this.textDir}});j.extend(b.Group,{textDir:"",setTextDir:function(a){n(this,
a)},getTextDir:function(){return this.textDir}});j.extend(b.Text,{textDir:"",formatText:function(a,i){if(i&&a&&a.length>1){var g="ltr",d=i;if(d=="auto"){if(b.isVml)return a;d=e.checkContextual(a)}if(b.isVml){g=e.checkContextual(a);if(d!=g)return d=="rtl"?!e.hasBidiChar(a)?e.bidiTransform(a,"IRNNN","ILNNN"):c.RLM+c.RLM+a:c.LRM+a;return a}if(b.isSvgWeb){if(d=="rtl")return e.bidiTransform(a,"IRNNN","ILNNN");return a}if(b.isSilverlight)return d=="rtl"?e.bidiTransform(a,"IRNNN","VLYNN"):e.bidiTransform(a,
"ILNNN","VLYNN");if(b.isCanvas)return d=="rtl"?c.RLE+a+c.PDF:c.LRE+a+c.PDF;if(b.isSvg){if(k("ff"))return d=="rtl"?e.bidiTransform(a,"IRYNN","VLNNN"):e.bidiTransform(a,"ILYNN","VLNNN");if(k("chrome")||k("safari")||k("opera"))return c.LRM+(d=="rtl"?c.RLE:c.LRE)+a+c.PDF}}return a},bidiPreprocess:function(a){return a}});j.extend(b.TextPath,{textDir:"",formatText:function(a,i){if(i&&a&&a.length>1){var g="ltr",d=i;if(d=="auto"){if(b.isVml)return a;d=e.checkContextual(a)}if(b.isVml){g=e.checkContextual(a);
if(d!=g)return d=="rtl"?!e.hasBidiChar(a)?e.bidiTransform(a,"IRNNN","ILNNN"):c.RLM+c.RLM+a:c.LRM+a;return a}if(b.isSvgWeb){if(d=="rtl")return e.bidiTransform(a,"IRNNN","ILNNN");return a}b.isSvg&&(a=k("opera")?c.LRM+(d=="rtl"?c.RLE:c.LRE)+a+c.PDF:d=="rtl"?e.bidiTransform(a,"IRYNN","VLNNN"):e.bidiTransform(a,"ILYNN","VLNNN"))}return a},bidiPreprocess:function(a){if(a&&typeof a=="string")this.origText=a,a=this.formatText(a,this.textDir);return a}});h=function(a,b,g,d){var c=a.prototype[b];a.prototype[b]=
function(){var a;g&&(a=g.apply(this,arguments));a=c.call(this,a);d&&(a=d.call(this,a,arguments));return a}};f=function(a){if(a){if(a.textDir)a.textDir=l(a.textDir);if(a.text&&a.text instanceof Array)a.text=a.text.join(",")}if(a&&(a.text!=void 0||a.textDir)&&(this.textDir!=a.textDir||a.text!=this.origText)){this.origText=a.text!=void 0?a.text:this.origText;if(a.textDir)this.textDir=a.textDir;a.text=this.formatText(this.origText,this.textDir)}return this.bidiPreprocess(a)};h(b.Text,"setShape",f,null);
h(b.TextPath,"setText",f,null);f=function(a){if((a=j.clone(a))&&this.origText)a.text=this.origText;return a};h(b.Text,"getShape",null,f);h(b.TextPath,"getText",null,f);f=function(a,b){var c;b&&b[0]&&(c=l(b[0]));a.setTextDir(c?c:this.textDir);return a};h(b.Surface,"createGroup",null,f);h(b.Group,"createGroup",null,f);f=function(a){if(a){var b=a.textDir?l(a.textDir):this.textDir;if(b)a.textDir=b}return a};h(b.Surface,"createText",f,null);h(b.Surface,"createTextPath",f,null);h(b.Group,"createText",f,
null);h(b.Group,"createTextPath",f,null);b.createSurface=function(a,c,e,d){c=b[b.renderer].createSurface(a,c,e);d=l(d);if(b.isSvgWeb)return c.textDir=d?d:m.style(o.byId(a),"direction"),c;if(b.isVml||b.isSvg||b.isCanvas)c.textDir=d?d:m.style(c.rawNode,"direction");if(b.isSilverlight)c.textDir=d?d:m.style(c._nodes[1],"direction");return c};return b});