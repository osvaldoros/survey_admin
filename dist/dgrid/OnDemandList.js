//>>built
define("dgrid/OnDemandList",["./List","./_StoreMixin","dojo/_base/declare","dojo/_base/lang","dojo/_base/Deferred","dojo/on","./util/misc","put-selector/put"],function(w,x,y,z,r,A,s,l){return y([w,x],{minRowsPerPage:25,maxRowsPerPage:100,maxEmptySpace:1E4,farOffRemoval:1E4,rowHeight:22,queryRowsOverlap:1,pagingDelay:s.defaultDelay,postCreate:function(){this.inherited(arguments);var d=this;A(this.bodyNode,"scroll",s.throttleDelayed(function(i){d._processScroll(i)},null,this.pagingDelay))},renderQuery:function(d,
i){var b={query:d,count:0,node:i};if(!i){var g={node:l(this.contentNode,"div.dgrid-preload",{rowIndex:0}),query:d,count:0,next:b};b.node=i=l(this.contentNode,"div.dgrid-preload");b.previous=g}i.rowIndex=this.minRowsPerPage;(g=this.preload)?((b.next=g.next)&&this.bodyNode.scrollTop>=g.node.offsetTop?b.previous=g:(b.next=g,b.previous=g.previous),b.previous.next=b,b.next.previous=b):this.preload=b;var e=l(i,"-div.dgrid-loading");l(e,"div.dgrid-below",this.loadingMessage);var g=z.mixin(this.get("queryOptions"),
{start:0,count:this.minRowsPerPage,query:d}),j=d(g),k=this;r.when(this.renderArray(j,i,g),function(h){return r.when(j.total||j.length,function(a){l(e,"!");var d=h.length,a=a||d;if(!a)l(k.contentNode,"div.dgrid-no-data").innerHTML=k.noDataMessage;for(var c=0,f=0;f<d;f++)c+=h[f].offsetHeight;if(d&&c)k.rowHeight=c/d;a-=d;b.count=a;i.rowIndex=d;a?i.style.height=Math.min(a*k.rowHeight,k.maxEmptySpace)+"px":i.style.display="none";k._processScroll();return h})});return j},refresh:function(){this.inherited(arguments);
if(this.store){var d=this;this._trackError(function(){return d.renderQuery(function(i){return d.store.query(d.query,i)})})}},_calcRowHeight:function(d){return d.offsetHeight},lastScrollTop:0,_processScroll:function(){function d(a,c,d,f){var h=b.farOffRemoval,g=a.node;if(c>2*h){for(var e,j=g[d],k=0,n=0,o=[];e=j;){var p=b._calcRowHeight(e);if(k+p+h>c||j.className.indexOf("dgrid-row")<0)break;var j=e[d],m,q=e.observerIndex;if(q!=m&&m>-1){var r=b.observers,s=r[m];s&&s.cancel();r[m]=0}k+=p;n++;m=q;b.removeRow(e,
!0);delete b._rowIdToObject[e.id];o.push(e)}a.count+=n;f?(g.rowIndex-=n,i(a)):g.style.height=g.offsetHeight+k+"px";for(var t=l("div"),a=0;a<o.length;a++)l(t,o[a]);setTimeout(function(){l(t,"!")},1)}}function i(a){var c=a.count*b.rowHeight;a.node.style.height=(a.node.rowIndex>0?Math.min(c,b.maxEmptySpace):c)+"px"}var b=this,g=b.bodyNode,e=b.contentNode.style.webkitTransform,e=g.scrollTop+(e?-e.match(/translate[\w]*\(.*?,(.*?)px/)[1]:0),j=g.offsetHeight+e,k,h,a=b.preload,s=b.lastScrollTop;for(b.lastScrollTop=
e;a&&a!=k;){k=b.preload;b.preload=a;h=a.node;var c=h.offsetTop;if(j+1<c){do a=a.previous;while(a&&!a.node.offsetWidth)}else if(e-1>c+h.offsetHeight){do a=a.next;while(a&&!a.node.offsetWidth)}else{var c=((h.rowIndex?e:j)-c)/b.rowHeight,f=(j-e)/b.rowHeight;f+=Math.min(Math.abs(Math.max(Math.min((e-s)*b.rowHeight,b.maxRowsPerPage/2),b.maxRowsPerPage/-2)),10);h.rowIndex==0&&(c-=f);c=Math.max(c,0);c<10&&c>0&&f+c<b.maxRowsPerPage&&(f+=c,c=0);f=Math.min(Math.max(f,b.minRowsPerPage),b.maxRowsPerPage,a.count);
if(f==0)break;var c=Math.round(c),f=Math.round(f),n=b.get("queryOptions");a.count-=f;var o=h,m,t=b.queryRowsOverlap,p=h.rowIndex>0&&a;if(p){var q=a.previous;q&&(d(q,e-(q.node.offsetTop+q.node.offsetHeight),"nextSibling"),c>0&&q.node==h.previousSibling&&(c=Math.min(a.count,c),a.previous.count+=c,i(a.previous),a.count-=c,h.rowIndex+=c,t=0));n.start=h.rowIndex-t;h.rowIndex+=f}else{if(a.next)d(a.next,a.next.node.offsetTop-j,"previousSibling",!0),o=h.nextSibling,o==a.next.node?(a.next.count+=a.count-c,
a.next.node.rowIndex=c+f,a.count=c,t=0):m=!0;n.start=a.count}n.count=f+t;if(m)m=o.offsetTop;i(a);var u=l(o,"-div.dgrid-loading[style=height:"+f*b.rowHeight+"px]");l(u,"div.dgrid-"+(p?"below":"above"),b.loadingMessage);n.query=a.query;var v=a.query(n);if(b._trackError(function(){return v})===void 0)break;r.when(b.renderArray(v,u,n),function(){o=u.nextSibling;l(u,"!");m&&(g.scrollTop+=o.offsetTop-m);p&&r.when(v.total||v.length,function(a){p.count=a-p.node.rowIndex;i(p)})});a=a.previous}}}})});