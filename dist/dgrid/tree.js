//>>built
define("dgrid/tree",["dojo/_base/declare","dojo/_base/Deferred","dojo/query","dojo/on","dojo/aspect","dojo/has!touch?./util/touch","put-selector/put"],function(v,q,o,r,s,k,g){return function(d){var u=d.renderCell||function(e,d,j){d!=null&&g(j,"span.dgrid-expando-text",d)};d.renderCell=function(e,t,j,m){var h=Number(m.query.level)+1,h=isNaN(h)?0:h,b=this.grid,n,p=!b.store.mayHaveChildren||b.store.mayHaveChildren(e),i=b.isRTL?"right":"left",i=g(j,"div.dgrid-expando-icon"+(p?".ui-icon.ui-icon-triangle-1-e":
"")+"[style=margin-"+i+": "+h*19+"px; float: "+i+"]");i.innerHTML="&nbsp;";u.call(this,e,t,j,m);i.level=h;i.mayHaveChildren=p;if(!b.expand){e=".dgrid-content .dgrid-column-"+d.id;b.on(d.expandOn||".dgrid-expando-icon:click,"+e+":dblclick,"+e+":keydown",function(a){(a.type!="keydown"||a.keyCode==32)&&b.expand(this)});if(k)b.on(k.selector(e,k.dbltap),function(){b.expand(this)});s.before(b,"removeRow",function(a,d){var f=a.connected;f&&(o(">.dgrid-row",f).forEach(function(a){b.removeRow(a)}),d||g(f,
"!"))});b._calcRowHeight=function(a){var b=a.connected;return a.offsetHeight+(b?b.offsetHeight:0)};b.expand=function(a,d){a=a.element||a;a=a.className.indexOf("dgrid-expando-icon")>-1?a:o(".dgrid-expando-icon",a)[0];if(a.mayHaveChildren){var f=a.expanded=d===void 0?!a.expanded:d;a.className="dgrid-expando-icon ui-icon ui-icon-triangle-1-"+(f?"se":"e");var e=a.preloadNode,i=b.row(a),h=i.element,c;if(!e){c=h.connected=g("div.dgrid-tree-container");var e=a.preloadNode=g(h,"+",c,"div.dgrid-preload"),
j=function(a){return b.store.getChildren(i.data,a)};j.level=a.level;q.when(b.renderQuery?b._trackError(function(){return b.renderQuery(j,e)}):b.renderArray(j({}),e),function(){c.style.height=c.scrollHeight+"px"});var k=function(a){var b=this.style.height;if(b)this.style.display=b=="0px"?"none":"block";a?(g(this,".dgrid-tree-resetting"),setTimeout(function(){g(c,"!dgrid-tree-resetting")}),n=!0):n||(n=!1);this.style.height=""};r(c,"transitionend,webkitTransitionEnd,oTransitionEnd,MSTransitionEnd",k);
n||setTimeout(function(){k.call(c)},600)}c=h.connected;var l=c.style;c.hidden=!f;if(n===!1)l.display=f?"block":"none",l.height="";else{if(f){l.display="block";var m=c.scrollHeight;l.height="0px"}else g(c,".dgrid-tree-resetting"),l.height=c.scrollHeight+"px";(!f||m)&&setTimeout(function(){g(c,"!dgrid-tree-resetting");l.height=(f?m:0)+"px"})}}}}};return d}});