//>>built
define("dgrid/extensions/DnD",["dojo/_base/declare","dojo/_base/lang","dojo/_base/Deferred","dojo/dnd/Source","dojo/dnd/Manager","put-selector/put","xstyle/css!dojo/resources/dnd.css"],function(d,g,k,l,n,o){function m(a){if(!a.dndSource)a.dndSource=new (a.dndConstructor||h)(a.bodyNode,g.mixin(a.dndParams,{grid:a,dropParent:a.contentNode}))}var h=d(l,{grid:null,getObject:function(a){var c=this.grid;return c.store.get(c.row(a).id)},_legalMouseDown:function(a){return this.inherited("_legalMouseDown",
arguments)&&a.target!=this.grid.bodyNode},onDrop:function(a,c,i){var f=this,b=this._targetAnchor=this.targetAnchor,e=this.grid,j=e.store;if(!this.before&&b)b=b.nextSibling;b=b&&e.row(b);k.when(b&&j.get(b.id),function(b){if(f!=a)f.onDropExternal(a,c,i,b);else f.onDropInternal(c,i,b)})},onDropInternal:function(a,c,i){var f=this.grid.store,b=this,e=this.grid,j=b._targetAnchor,d;j&&(d=this.before?j.previousSibling:j.nextSibling);(c||!(d===a[0]||!i&&e.down(e.row(a[0])).element==a[0]))&&a.forEach(function(a){k.when(b.getObject(a),
function(a){f[c&&f.copy?"copy":"put"](a,{before:i})})})},onDropExternal:function(a,c,d,f){var b=this.grid.store,e=a.grid;c.forEach(function(c,h){k.when(a.getObject(c),function(g){d||(e?k.when(e.store.getIdentity(g),function(b){!h&&a.selectNone();a.delItem(c.id);e.store.remove(b)}):a.deleteSelectedNodes());b[b.copy?"copy":"put"](g,{before:f})})})},onDndStart:function(a){this.inherited(arguments);if(a==this)n.manager().avatar.node.style.width=this.grid.domNode.offsetWidth/2+"px"},checkAcceptance:function(a){return a.getObject&&
l.prototype.checkAcceptance.apply(this,arguments)}}),d=d([],{dndSourceType:"dgrid-row",dndParams:null,dndConstructor:h,postMixInProperties:function(){this.inherited(arguments);this.dndParams=g.mixin({accept:[this.dndSourceType]},this.dndParams)},postCreate:function(){this.inherited(arguments);m(this)},insertRow:function(a){var c=this.inherited(arguments);o(c,".dojoDndItem");m(this);this.dndSource.setItem(c.id,{data:a,type:[this.dndSourceType]});return c}});d.GridSource=h;return d});