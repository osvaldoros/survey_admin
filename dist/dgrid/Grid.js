//>>built
define("dgrid/Grid",["dojo/_base/kernel","dojo/_base/declare","dojo/on","dojo/has","put-selector/put","./List","dojo/_base/sniff"],function(r,i,t,j,g,u){function m(a,c){c&&c.nodeType&&a.appendChild(c)}var s=j("ie")<8&&!j("quirks"),v=/[^\._a-zA-Z0-9-]/g,i=i([u],{columns:null,cellNavigation:!0,tabableHeader:!0,showHeader:!0,column:function(a){return typeof a=="string"?this.columns[a]:this.cell(a).column},listType:"grid",cell:function(a,c){if(a.row&&a.row instanceof this._Row)return a;if(a.target&&a.target.nodeType)a=
a.target;var b;if(a.nodeType){do{if(this._rowIdToObject[a.id])break;var f=a.columnId;if(f){c=f;b=a;break}a=a.parentNode}while(a&&a!=this.domNode)}if(!b&&c){var d=this.row(a);if(f=d.element)for(var f=f.getElementsByTagName("td"),e=0;e<f.length;e++)if(f[e].columnId==c){b=f[e];break}}if(a!=null)return{row:d||this.row(a),column:c&&this.column(c),element:b}},_columnsCss:function(a){a.fullSelector=function(){return this.parent.fullSelector()+" .dgrid-cell"};for(var c=0;c<a.children.length;c++){var b=a.children[c];
b.field=b.className=b.selector.substring(1)}return a.children},createRowCells:function(a,c,b){var f=g("table.dgrid-row-table[role=presentation]"),d=j("ie")<9||j("quirks")?g(f,"tbody"):f,e,n,i,o,m,q,k,l,h,p,b=b||this.subRows;n=0;for(i=b.length;n<i;n++){q=b[n];e=i==1&&!j("ie")?d:g(d,"tr");o=0;for(m=q.length;o<m;o++){k=q[o];l=k.id;h=k.className||k.field&&"field-"+k.field;h=g(a+(".dgrid-cell.dgrid-cell-padding.dgrid-column-"+l+(h?"."+h:"")).replace(v,"-"));h.columnId=l;s?(l=g(h,"!dgrid-cell-padding div.dgrid-cell-padding"),
h.contents=l):l=h;if(p=k.colSpan)h.colSpan=p;if(p=k.rowSpan)h.rowSpan=p;c(l,k);e.appendChild(h)}}return f},left:function(a,c){return this.cell(this._move(a,-(c||1),"dgrid-cell"))},right:function(a,c){return this.cell(this._move(a,c||1,"dgrid-cell"))},renderRow:function(a,c){var b=this.createRowCells("td",function(f,d){var b=a;d.get?b=d.get(a):"field"in d&&d.field!="_item"&&(b=b[d.field]);d.formatter?f.innerHTML=d.formatter(b):d.renderCell?m(f,d.renderCell(a,b,f,c)):b!=null&&f.appendChild(document.createTextNode(b))},
c&&c.subRows);return g("div[role=gridcell]>",b)},renderHeader:function(){for(var a=this,c=this.headerNode,b=c.childNodes.length;b--;)g(c.childNodes[b],"!");b=this.createRowCells("th[role=columnheader]",function(a,c){var b=c.headerNode=a;if(s)a=a.parentNode;var g=c.field;if(g)a.field=g;if(c.renderHeaderCell)m(b,c.renderHeaderCell(b));else if(c.label||c.field)b.appendChild(document.createTextNode(c.label||c.field));if(c.sortable!==!1)a.sortable=!0,a.className+=" dgrid-sortable"});this._rowIdToObject[b.id=
this.id+"-header"]=this.columns;c.appendChild(b);t(b,"click,keydown",function(b){if(b.type=="click"||b.keyCode==32){var b=b.target,d,e;do if(b.sortable)return a._sortNode=b,b=b.field||b.columnId,d=(e=a._sort[0])&&e.attribute==b&&!e.descending,a.set("sort",b,d);while((b=b.parentNode)&&b!=c)}})},resize:function(){var a=this.headerNode.firstChild,c=this.contentNode,b;this.inherited(arguments);if(!j("ie")||j("ie")>7&&!j("quirks"))if(c.style.width="",c&&a&&(b=a.offsetWidth)!=c.offsetWidth)c.style.width=
b+"px"},_setSort:function(){this.inherited(arguments);this._lastSortedArrow&&(g(this._lastSortedArrow,"<!dgrid-sort-up!dgrid-sort-down"),g(this._lastSortedArrow,"!"),delete this._lastSortedArrow);if(this._sort[0]){var a=this._sort[0].attribute,c=this._sort[0].descending,b=this._sortNode,f,d,e;delete this._sortNode;if(!b)for(e in f=this.columns,f)if(d=f[e],d.field==a){b=d.headerNode;break}if(b)b=b.contents||b,this._lastSortedArrow=g(b.firstChild,"-div.dgrid-sort-arrow.ui-icon[role=presentation]"),
this._lastSortedArrow.innerHTML="&nbsp;",g(b,c?".dgrid-sort-down":".dgrid-sort-up"),this.resize()}},styleColumn:function(a,c){return this.addCssRule("#"+this.domNode.id+" .dgrid-column-"+a,c)},_configColumns:function(a,c){var b=[],f=c instanceof Array,d,e;for(d in c){e=c[d];typeof e=="string"&&(c[d]=e={label:e});if(!f&&!e.field)e.field=d;d=e.id=e.id||(isNaN(d)?d:a+d);a&&(this.columns[d]=e);this._configColumn&&this._configColumn(e,d,c,a);e.grid=this;b.push(e)}return f?c:b},configStructure:function(){var a=
this.subRows;if(a){this.columns={};for(var c=0;c<a.length;c++)a[c]=this._configColumns(c+"-",a[c])}else this.subRows=[this._configColumns("",this.columns)]},_setColumns:function(a){this.subRows=null;this.columns=a;this._updateColumns()},_setSubRows:function(a){this.subRows=a;this._updateColumns()},setColumns:function(a){r.deprecated("setColumns(...)",'use set("columns", ...) instead',"dgrid 1.0");this.set("columns",a)},setSubRows:function(a){r.deprecated("setSubRows(...)",'use set("subRows", ...) instead',
"dgrid 1.0");this.set("subRows",a)},_updateColumns:function(){this.configStructure();this.renderHeader();this.refresh();this._lastCollection&&this.renderArray(this._lastCollection);this.resize()}});i.appendIfNode=m;i.defaultRenderCell=function(a,c,b){c!=null&&b.appendChild(document.createTextNode(c))};return i});