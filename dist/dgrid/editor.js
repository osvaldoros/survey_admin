//>>built
define("dgrid/editor",["dojo/_base/kernel","dojo/_base/lang","dojo/on","dojo/aspect","dojo/has","./Grid","put-selector/put","dojo/_base/sniff"],function(v,w,i,o,m,p,q){function r(a,c){a.value=c;if(a.type=="radio"||a.type=="checkbox")a.checked=!!c}function s(a,c){if(typeof c=="number")a=isNaN(a)?a:parseFloat(a);else if(typeof c=="boolean")a=a=="true"?!0:a=="false"?!1:a;else if(c instanceof Date)var b=new Date(a),a=isNaN(b.getTime())?a:b;return a}function x(a,c,b,d){var e,g,f;if(!(b>=d&&b<=d)&&(e=a.cell(c),
g=e.row,f=e.column,f.field&&g))if(i.emit(c,"dgrid-datachange",{grid:this,cell:e,rowId:g.id,oldValue:b,value:d,bubbles:!0,cancelable:!0}))a.updateDirty&&(a.updateDirty(g.id,f.field,d),f.autoSave&&setTimeout(function(){a._trackError("save")},0));else return b;return d}function n(a,c,b){if(!b.isValid||b.isValid())a=x(a,(b.domNode||b).parentNode,j?h:b._dgridLastValue,typeof b.get=="function"?s(b.get("value")):s(b[b.type=="checkbox"||b.type=="radio"?"checked":"value"])),j?h=a:b._dgridLastValue=a}function t(a){var c=
a.editor,b=a.editOn,d=a.grid,e=typeof c!="string",g,f,l;g=a.editorArgs||{};typeof g=="function"&&(g=g.call(d,a));if(e)f=new c(g),e=f.focusNode||f.domNode,e.className+=" dgrid-input",f.connect(f,b?"onBlur":"onChange",function(){f._dgridIgnoreChange||n(d,a,this)});else{l=function(b){b=b.target;"_dgridLastValue"in b&&b.className.indexOf("dgrid-input")>-1&&n(d,a,b)};if(!a.grid._hasInputListener)d._hasInputListener=!0,d.on("change",function(a){l(a)});f=e=q((c=="textarea"?"textarea":"input[type="+c+"]")+
".dgrid-input",w.mixin({name:a.field,tabIndex:isNaN(a.tabIndex)?-1:a.tabIndex},g));if(m("ie")<9||m("ie")&&m("quirks"))c=="radio"||c=="checkbox"?i(f,"click",function(a){l(a)}):i(f,"change",function(a){l(a)})}i(e,"mousedown",function(a){a.stopPropagation()});return f}function y(a,c){var b=t(a),d=b.domNode||b,e=b.focusNode||d,g=b.domNode?function(){b.set("value",b._dgridLastValue)}:function(){r(b,b._dgridLastValue);n(a.grid,a,b)};i(e,"keydown",function(f){f=f.keyCode||f.which;f==27?(g(),h=b._dgridLastValue,
e.blur()):f==13&&a.dismissOnEnter!==!1&&e.blur()});(a._editorBlurHandle=i.pausable(b,"blur",function(){var b=d.parentNode;b.removeChild(d);p.appendIfNode(b,c(a.grid.row(b).data,h,b));j=h=null;a._editorBlurHandle.pause()})).pause();return b}function u(a,c,b,d){(c=a.domNode)||r(a,d);b.innerHTML="";q(b,a.domNode||a);if(c)a._started||a.startup(),a._dgridIgnoreChange=!0,a.set("value",d),setTimeout(function(){a._dgridIgnoreChange=!1},0);a._dgridLastValue=d;j&&(h=d)}var j,h;return function(a,c,b){var d=
a.renderCell||p.defaultRenderCell,e,g;a.editor=c=c||a.editor;a.editOn=b=b||a.editOn;e=typeof c!="string";if(a.widgetArgs)v.deprecated("column.widgetArgs","use column.editorArgs instead","dgrid 1.0"),a.editorArgs=a.widgetArgs;a.renderCell=b?function(f,c,k,h){if(!a.editorInstance)a.editorInstance=y(a,d);!g&&e&&(g=!0,o.before(a.grid,"destroy",function(){a.editorInstance.destroyRecursive()}));i(k.tagName=="TD"?k:k.parentNode,b,function(){var l;var b=a.editorInstance,c=a.grid,d=a.field,e;if(j!=this&&(!a.canEdit||
a.canEdit(f,e)))j=this,e=c.row(k),l=(c=c.dirty&&c.dirty[e.id])&&d in c?c[d]:a.get?a.get(e.data):e.data[d],e=l,u(b,a,k,e),setTimeout(function(){b.focus&&b.focus();a._editorBlurHandle&&a._editorBlurHandle.resume()},0)});return d(f,c,k,h)}:function(b,c,d){var h=a.grid,b=t(a);u(b,a,d,c);if(e)d.widget=b,g||(g=!0,o.before(h,"removeRow",function(b){b=h.cell(b,a.id).element;(b=(b.contents||b).widget)&&b.destroyRecursive()}))};return a}});