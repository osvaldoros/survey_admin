//>>built
define("dojo/_base/fx",["./kernel","./lang","../Evented","./Color","./connect","./sniff","../dom","../dom-style"],function(b,e,q,j,g,r,n,l){var k=e.mixin;b._Line=function(a,c){this.start=a;this.end=c};b._Line.prototype.getValue=function(a){return(this.end-this.start)*a+this.start};b.Animation=function(a){k(this,a);if(e.isArray(this.curve))this.curve=new b._Line(this.curve[0],this.curve[1])};b.Animation.prototype=new q;b._Animation=b.Animation;e.extend(b.Animation,{duration:350,repeat:0,rate:20,_percent:0,
_startRepeatCount:0,_getStep:function(){var a=this._percent,c=this.easing;return c?c(a):a},_fire:function(a,c){var h=c||[];if(this[a])if(b.config.debugAtAllCosts)this[a].apply(this,h);else try{this[a].apply(this,h)}catch(f){console.error("exception in animation handler for:",a),console.error(f)}return this},play:function(a,c){this._delayTimer&&this._clearTimer();if(c)this._stopTimer(),this._active=this._paused=!1,this._percent=0;else if(this._active&&!this._paused)return this;this._fire("beforeBegin",
[this.node]);var b=a||this.delay,f=e.hitch(this,"_play",c);if(b>0)return this._delayTimer=setTimeout(f,b),this;f();return this},_play:function(){this._delayTimer&&this._clearTimer();this._startTime=(new Date).valueOf();this._paused&&(this._startTime-=this.duration*this._percent);this._active=!0;this._paused=!1;var a=this.curve.getValue(this._getStep());if(!this._percent){if(!this._startRepeatCount)this._startRepeatCount=this.repeat;this._fire("onBegin",[a])}this._fire("onPlay",[a]);this._cycle();
return this},pause:function(){this._delayTimer&&this._clearTimer();this._stopTimer();if(!this._active)return this;this._paused=!0;this._fire("onPause",[this.curve.getValue(this._getStep())]);return this},gotoPercent:function(a,c){this._stopTimer();this._active=this._paused=!0;this._percent=a;c&&this.play();return this},stop:function(a){this._delayTimer&&this._clearTimer();if(!this._timer)return this;this._stopTimer();if(a)this._percent=1;this._fire("onStop",[this.curve.getValue(this._getStep())]);
this._active=this._paused=!1;return this},status:function(){if(this._active)return this._paused?"paused":"playing";return"stopped"},_cycle:function(){if(this._active){var a=((new Date).valueOf()-this._startTime)/this.duration;a>=1&&(a=1);this._percent=a;this.easing&&(a=this.easing(a));this._fire("onAnimate",[this.curve.getValue(a)]);if(this._percent<1)this._startTimer();else{this._active=!1;if(this.repeat>0)this.repeat--,this.play(null,!0);else if(this.repeat==-1)this.play(null,!0);else if(this._startRepeatCount)this.repeat=
this._startRepeatCount,this._startRepeatCount=0;this._percent=0;this._fire("onEnd",[this.node]);!this.repeat&&this._stopTimer()}}return this},_clearTimer:function(){clearTimeout(this._delayTimer);delete this._delayTimer}});var i=0,m=null,o={run:function(){}};e.extend(b.Animation,{_startTimer:function(){if(!this._timer)this._timer=g.connect(o,"run",this,"_cycle"),i++;m||(m=setInterval(e.hitch(o,"run"),this.rate))},_stopTimer:function(){if(this._timer)g.disconnect(this._timer),this._timer=null,i--;
i<=0&&(clearInterval(m),m=null,i=0)}});var s=r("ie")?function(a){var c=a.style;if(!c.width.length&&l.get(a,"width")=="auto")c.width="auto"}:function(){};b._fade=function(a){a.node=n.byId(a.node);var c=k({properties:{}},a),a=c.properties.opacity={};a.start=!("start"in c)?function(){return+l.get(c.node,"opacity")||0}:c.start;a.end=c.end;a=b.animateProperty(c);g.connect(a,"beforeBegin",e.partial(s,c.node));return a};b.fadeIn=function(a){return b._fade(k({end:1},a))};b.fadeOut=function(a){return b._fade(k({end:0},
a))};b._defaultEasing=function(a){return 0.5+Math.sin((a+1.5)*Math.PI)/2};var p=function(a){this._properties=a;for(var c in a){var b=a[c];if(b.start instanceof j)b.tempColor=new j}};p.prototype.getValue=function(a){var b={},h;for(h in this._properties){var f=this._properties[h],d=f.start;d instanceof j?b[h]=j.blendColors(d,f.end,a,f.tempColor).toCss():e.isArray(d)||(b[h]=(f.end-d)*a+d+(h!="opacity"?f.units||"px":0))}return b};b.animateProperty=function(a){var c=a.node=n.byId(a.node);if(!a.easing)a.easing=
b._defaultEasing;a=new b.Animation(a);g.connect(a,"beforeBegin",a,function(){var a={},b;for(b in this.properties){if(b=="width"||b=="height")this.node.display="block";var d=this.properties[b];e.isFunction(d)&&(d=d(c));d=a[b]=k({},e.isObject(d)?d:{end:d});if(e.isFunction(d.start))d.start=d.start(c);if(e.isFunction(d.end))d.end=d.end(c);var g=b.toLowerCase().indexOf("color")>=0,i=function(a,b){var c={height:a.offsetHeight,width:a.offsetWidth}[b];if(c!==void 0)return c;c=l.get(a,b);return b=="opacity"?
+c:g?c:parseFloat(c)};if("end"in d){if(!("start"in d))d.start=i(c,b)}else d.end=i(c,b);g?(d.start=new j(d.start),d.end=new j(d.end)):d.start=b=="opacity"?+d.start:parseFloat(d.start)}this.curve=new p(a)});g.connect(a,"onAnimate",e.hitch(l,"set",a.node));return a};b.anim=function(a,c,e,f,d,g){return b.animateProperty({node:a,duration:e||b.Animation.prototype.duration,properties:c,easing:f,onEnd:d}).play(g||0)};return{_Line:b._Line,Animation:b.Animation,_fade:b._fade,fadeIn:b.fadeIn,fadeOut:b.fadeOut,
_defaultEasing:b._defaultEasing,animateProperty:b.animateProperty,anim:b.anim}});