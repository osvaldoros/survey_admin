//>>built
require({cache:{"url:app/uicomponents/templates/Map.html":'<div class="moduleContainer">\n\t<div data-dojo-attach-point="focusNode" style="border: 1px solid #333;"></div>\n</div>\n\t\t\n'}});
define("app/uicomponents/Map",["dojo/_base/declare","dojo/on","dojo/topic","dojo/parser","dijit/form/_FormWidget","app/mixins/WidgetMap","dojo/text!./templates/Map.html","dojo/_base/lang","dojo/dom-style"],function(h,n,g,i,j,k,l,d,m){return h("app.uicomponents.Map",[j,k],{recordPrefix:"",_centerMarker:null,_markers:[],_location:null,_locationEntities:[],_clickListeners:[],_latitude:null,_longitude:null,_apiKey:"AIzaSyDtziGVqxnOcoT8R9tLfmP1YS0KOlEWGRQ",templateString:l,mapWidth:"280px",mapHeight:"180px",
buildRendering:function(){this.inherited(arguments);m.set(this.focusNode,{width:this.mapWidth,height:this.mapHeight})},startup:function(){this.eventHandlers=[];this.inherited(arguments);this.initializeMapApi()},initializeMapApi:function(){if(typeof __.maps=="undefined"){__.maps={apiReady:!1,loadCallBack:function(){__.maps.apiReady=!0;g.publish("__-maps-ready")}};var a=document.createElement("script");a.type="text/javascript";a.src="http://maps.googleapis.com/maps/api/js?key="+this._apiKey+"&sensor=false&callback=__.maps.loadCallBack";
document.body.appendChild(a)}__.maps.apiReady?this.apiReady():this.apiLoadHandler=g.subscribe("__-maps-ready",d.hitch(this,"apiReady"))},apiReady:function(){typeof this.apiLoadHandler!="undefined"&&this.apiLoadHandler!=null&&this.apiLoadHandler.remove();this.mapNode=this.getWidget("focusNode");this.map=new google.maps.Map(this.mapNode,{mapTypeId:google.maps.MapTypeId.ROADMAP,center:new google.maps.LatLng(43.2875878,-80.45265319999999),zoom:15});this.geocoder=new google.maps.Geocoder;this.infowindow=
new google.maps.InfoWindow;typeof this._location!="undefined"&&this._location!=null?this.markCenter(new google.maps.LatLng(this._location.latitude,this._location.longitude)):d.isArray(this._locationEntities)&&this._locationEntities.length>0?this.createMarkers(this._locationEntities):typeof this.address!="undefined"&&this.address!=null&&this.geocode(this.address);google.maps.event.addListener(this.infowindow,"domready",d.hitch(this,function(){i.parse(this.mapNode.id);this.getWidget("selectButton")}));
this.resize()},_onClick:function(){},resize:function(){typeof google!="undefined"&&typeof google.maps!="undefined"&&typeof google.maps.event!="undefined"&&google.maps.event.trigger(this.map,"resize")},_setValueAttr:function(a){this.inherited(arguments);typeof a=="string"?this.geocode(a,!0):d.isArray(a)&&(a={latitude:a[1],longitude:a[0]});if(typeof a=="object"&&a.hasOwnProperty("latitude")&&a.hasOwnProperty("longitude"))this.clearCenterMarker(),typeof google!="undefined"&&typeof google.maps!="undefined"&&
typeof google.maps.LatLng!="undefined"?this.markCenter(new google.maps.LatLng(a.latitude,a.longitude)):this._location=a},_getValueAttr:function(){this.inherited(arguments);var a={};a[this.name]=[this._longitude,this._latitude];return a},getLocationArray:function(){return[this._longitude,this._latitude]},geocode:function(a,b){typeof b!="undefined"&&b==!0&&this.clearCenterMarker();typeof this.geocoder!="undefined"?this.geocoder.geocode({address:a},d.hitch(this,"geocodeResponse")):this.address=a},geocodeResponse:function(a,
b){if(b==google.maps.GeocoderStatus.OK)this._geocoded=!0,this.markCenter(a[0].geometry.location),this._geocoded=!1},markCenter:function(a){this.map.setCenter(a);this._centerMarker=new google.maps.Marker({map:this.map,position:a,draggable:!0});this.updateLatLngFields();typeof this._centerMarkerListener!="undefined"&&google.maps.event.removeListener(this._centerMarkerListener);this._centerMarkerListener=google.maps.event.addListener(this._centerMarker,"dragend",d.hitch(this,"updateLatLngFields"));this.resize()},
updateLatLngFields:function(){var a=this._centerMarker.getPosition(),b=this._latitude,f=this._longitude;this._latitude=a.lat();this._longitude=a.lng();if(this._geocoded)this.onChange(!0);else if(this._latitude!=b&&b!=null||this._longitude!=f&&f!=null)this.onChange(!0)},clearCenterMarker:function(){this._centerMarker!=null&&this._centerMarker.setMap(null)},mapEntities:function(a){this.clearMarkers();for(var b=[],f=0;f<a.length;f++){var c=d.clone(a[f]),e=!1;if(typeof c=="object"&&c.hasOwnProperty("latitude")&&
c.hasOwnProperty("longitude"))e=!0;else if(typeof c=="object"&&c.hasOwnProperty("loc")&&d.isArray(c.loc))c.latitude=c.loc[1],c.longitude=c.loc[0],e=!0;e&&b.push(c)}typeof google!="undefined"?this.createMarkers(b):this._locationEntities=b},createMarkers:function(a){for(var b=new google.maps.LatLngBounds,f=0;f<a.length;f++){var c=a[f],e={map:this.map,position:new google.maps.LatLng(c.latitude,c.longitude),title:c.name};if(c.hasOwnProperty("icon")&&typeof c.icon=="string")e.icon=c.icon;var e=new google.maps.Marker(e),
d=this;c.hasOwnProperty("content")&&typeof c.content=="string"&&this._clickListeners.push(google.maps.event.addListener(e,"click",function(a,b){return function(){d.infowindow.setContent(b.content);d.infowindow.open(d.map,a)}}(e,c)));b.extend(e.getPosition());this._markers.push(e)}this.resize();this.map.fitBounds(b)},clearMarkers:function(){for(var a=0;a<this._clickListeners.length;a++){var b=this._clickListeners[a];typeof b!="undefined"&&b!=null&&google.maps.event.removeListener(b)}this._clickListeners=
[];for(a=0;a<this._markers.length;a++)b=this._markers[a],b!=null&&b.setMap(null);this._markers=[]}})});