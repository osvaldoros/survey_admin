//>>built
require({cache:{"url:app/uicomponents/blocks/templates/WizardManagerBlock.html":'<div class="moduleContainer">\n\t<span class="floatRight modifiedLabel" style="margin-top: -10px;" data-dojo-attach-point="_modified_label">modified</span>\n\t<span class="floatRight activeUsersLabel" style="margin-top: -10px; display:none;" data-dojo-attach-point="_users_active_label">active users</span>\n\t<div data-dojo-attach-point="title_div" class="floatLeft" style="padding-bottom: 10px;"><h2><span data-dojo-attach-point="title_node">{title}</span></h2></div>\n\t\n\t<div style="clear: both;" class="centerPanel" data-dojo-attach-point="_tabs" data-dojo-type="dijit.layout.TabContainer" data-dojo-props="region: \'center\'" nested="true" doLayout="false"></div>\n\t\n    <div class="edgePanel" style="padding-top: 5px; padding-bottom: 5px;">\n\n\t\t<div class="floatLeft" data-dojo-type="dijit.form.Button" iconClass="dijitArrowButtonInner leftArrowOffset" data-dojo-attach-point="_prevBtn">\n\t\t    Previous\n\t\t</div>\n\t\t<div class="floatLeft" data-dojo-type="dijit.form.Button" data-dojo-attach-point="_cancelBtn">\n\t\t    Cancel\n\t\t</div>\n\t\t<div class="floatRight" data-dojo-type="app.form.ArrowButton" data-dojo-attach-point="_nextBtn">\n\t\t    Save\n\t\t</div>\n\t\t<div class="floatRight" data-dojo-type="dijit.form.Button" data-dojo-attach-point="_saveBtn">\n\t\t    Save\n\t\t</div>\n\t\t<div class="floatRight" data-dojo-type="dijit.form.Button" iconClass="dijitIconEditTask" data-dojo-attach-point="_instructionsBtn" title="Instructions" ></div>\n\t\t<div class="floatRight" data-dojo-type="dijit.form.Button" iconClass="dijitIconTask" data-dojo-attach-point="_notesBtn" title="Notes" ></div>\n\n\t\t<table data-dojo-attach-point="objectNavigation" cellpadding="0" cellspacing="0" style="width:190px; margin-left:auto; margin-right:auto;">\n\t\t<tr>\n\t\t\t<td>\n\t\t\t\t<div class="floatLeft" data-dojo-type="dijit.form.Button" style="margin-top:0px;" data-dojo-attach-point="_firstEntityBtn">\n\t\t    \t    |&lt;\n\t\t\t</td>\t\t\t\t\n\t\t\t<td>\n\t\t\t\t<div class="floatLeft" data-dojo-type="dijit.form.Button" style="margin-top:0px;" data-dojo-attach-point="_previousEntityBtn">\n\t\t    \t    &lt;\n\t\t    \t</div>\n\t\t\t</td>\n\t\t    \t</div>\n\t\t\t<td style="vertical-align:middle; text-align:center;">\n\t\t\t\t<span data-dojo-attach-point="documentsLabel"></span>\n\t\t\t</td>\n\t\t\t<td>\n\t\t\t\t<div class="floatRight" data-dojo-type="dijit.form.Button" style="margin-top:0px;" data-dojo-attach-point="_nextEntityBtn">\n\t\t    \t    &gt;\n\t\t    \t</div>\n\t\t\t</td>\n\t\t\t<td>\n\t\t\t\t<div class="floatRight" data-dojo-type="dijit.form.Button" style="margin-top:0px;" data-dojo-attach-point="_lastEntityBtn">\n\t\t    \t    &gt;|\n\t\t    \t</div>\n\t\t\t</td>\n\t\t</tr>\n\t</table>\n\n\t</div>\n\t\n\t<div dojoType="app.layout.FloatingPane" title="Instructions" resizable="true" dockable="true" closable="false" data-dojo-attach-point="_instructions" style="padding:0px; overflow: hidden; position:absolute; overflow:auto" duration="300">\n\t\t<div data-dojo-attach-point="instructionsWidget" style="border: none; padding: 10px;"></div>\n\t</div>\n\t<div dojoType="app.layout.FloatingPane" title="Notes" resizable="true" dockable="true" closable="false" dockable="false" data-dojo-attach-point="_notes" style="padding:0px; overflow: hidden; position:absolute;" duration="300">\n\t\t<\!--<div data-dojo-attach-point="notes_node" style="border: none; padding: 10px;">--\>\n\t\t\t<div data-dojo-attach-point="notesWidget" data-dojo-type="app.uicomponents.Notes" style="width:100%; height:85%;"/>\n\t\t<\!--</div>--\>\n\t</div>\n\t\n\t\n</div>\n\t\t\n'}});
define("app/uicomponents/blocks/WizardManagerBlock",["dojo/_base/declare","dojo/on","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","app/mixins/StatefulModule","app/mixins/EntityLoader","dojo/text!./templates/WizardManagerBlock.html","dojo/_base/lang","dojo/topic","dojo/dom-construct","dijit/form/Button","app/form/ArrowButton","dijit/layout/TabContainer","dijit/layout/ContentPane","app/utils/HashManager","app/mixins/WizardManager","app/layout/FloatingPane","dojo/dom-style",
"app/uicomponents/Notes"],function(f,d,i,j,k,l,m,n,e,s,t,o,u,v,w,p,q,x,r){return f("app.uicomponents.blocks.WizardManagerBlock",[i,j,k,m,l,q],{widgetsInTemplate:!0,templateString:n,hashManager:p.getInstance(),_autoClose:!1,_inheritOnActivate:!0,_hashManagement:null,_entityLabel:void 0,_showTabs:!0,_showInstructions:!1,_showNotes:!1,_showCancelBtn:!1,_notesStoreURL:null,_showTitle:!0,_autoGenerateStepsFromMeta:!1,_preloadedEntity:null,_showPreviousButton:!1,_enableNavigateButtons:!1,_preflightNavOnLoad:!0,
constructor:function(a){f.safeMixin(this,a||{});this._hashManagement=this._defaultHashManagement;this._steps=[];this._preloadedEntity={}},startup:function(){this.inherited(arguments);this._tabs=this.getWidget("_tabs");this._prevBtn=this.getWidget("_prevBtn");this._nextBtn=this.getWidget("_nextBtn");this._saveBtn=this.getWidget("_saveBtn");this._cancelBtn=this.getWidget("_cancelBtn");this._modified_label=this.getWidget("_modified_label");this._users_active_label=this.getWidget("_users_active_label");
this._firstEntityBtn=this.getWidget("_firstEntityBtn");this._previousEntityBtn=this.getWidget("_previousEntityBtn");this._nextEntityBtn=this.getWidget("_nextEntityBtn");this._lastEntityBtn=this.getWidget("_lastEntityBtn");this._instructionsBtn=this.getWidget("_instructionsBtn");this._instructions=this.getWidget("_instructions");this.instructionsWidget=this.getWidget("instructionsWidget");this._notesBtn=this.getWidget("_notesBtn");this._notes=this.getWidget("_notes");this.notesWidget=this.getWidget("notesWidget");
this.title_div=this.getWidget("title_div");if(typeof this.title_div.id=="undefined"||this.title_div.id=="")this.title_div.id=this.id+"_title_div";typeof this._entityLabel=="string"&&this._cancelBtn.set("label",this._cancelBtn.label+" "+this._entityLabel);this._instructions.resize({w:400,h:500});this._instructions.hide();this._notes.resize({w:400,h:500});this._notes.hide();if(e.isArray(this._extraButtons)&&this._extraButtons.length>0)for(var a=this._extraButtons.length-1;a>=0;a--){var b=this._extraButtons[a],
c=new o({label:b.label});typeof b.instanceName=="string"&&b.instanceName&&(this.hasOwnProperty(b.instanceName)?console.warn("Could not create property "+b.instanceName+", because it already exist on WizardManagerBlock "+this.id):this[b.instanceName]=c);c.placeAt(this._saveBtn.domNode,"after");b.button=c;r.set(c.domNode,{"float":"right"})}a={tabs:this._tabs,steps:this._steps,autoGenerateStepsFromMeta:this._autoGenerateStepsFromMeta,statusLabel:this._modified_label,activeUsersLabel:this._users_active_label,
storeURL:this._store,previousButton:this._prevBtn,nextButton:this._nextBtn,saveButton:this._saveBtn};if(typeof this._hashManagement!="undefined"&&this._hashManagement!=null)a.hashManagement=this._hashManagement;this.configureWizard(a)},entityCreated:function(a){this.reconfigureWizard(a);this.title_node.innerHTML=a.name},onActivate:function(){if(typeof this.eventHandlers=="undefined")this.eventHandlers=[];typeof this._instructionsBtn!="undefined"&&this._instructionsBtn!=null&&this.eventHandlers.push(d(this._instructionsBtn,
"click",e.hitch(this,"onInstructionsBtnClicked")));typeof this._notesBtn!="undefined"&&this._notesBtn!=null&&this.eventHandlers.push(d(this._notesBtn,"click",e.hitch(this,"onNotesBtnClicked")));typeof this._cancelBtn!="undefined"&&this._cancelBtn!=null&&this.eventHandlers.push(d(this._cancelBtn,"click",e.hitch(this,"onCancelBtnClicked")));typeof this._firstEntityBtn!="undefined"&&this._firstEntityBtn!=null&&this.eventHandlers.push(d(this._firstEntityBtn,"click",e.hitch(this,"onFirstEntityBtnClicked")));
typeof this._previousEntityBtn!="undefined"&&this._previousEntityBtn!=null&&this.eventHandlers.push(d(this._previousEntityBtn,"click",e.hitch(this,"onPreviousEntityBtnClicked")));typeof this._nextEntityBtn!="undefined"&&this._nextEntityBtn!=null&&this.eventHandlers.push(d(this._nextEntityBtn,"click",e.hitch(this,"onNextEntityBtnClicked")));typeof this._lastEntityBtn!="undefined"&&this._lastEntityBtn!=null&&this.eventHandlers.push(d(this._lastEntityBtn,"click",e.hitch(this,"onLastEntityBtnClicked")));
if(e.isArray(this._extraButtons)&&this._extraButtons.length>0)for(var a=this._extraButtons.length-1;a>=0;a--){var b=this._extraButtons[a];this.eventHandlers.push(d(b.button,"click",b.handler))}this._inheritOnActivate==!0&&this.loadEntityviaLoader();this.inherited(arguments)},loadEntityviaLoader:function(a){var b=this,c=this.loadEntity(function(c){b._firstEntityBtn.domNode.style.display="";b._previousEntityBtn.domNode.style.display="";b._nextEntityBtn.domNode.style.display="";b._lastEntityBtn.domNode.style.display=
"";b.updateTitle(c);b.reconfigureWizard(c);b.isUpdating=!0;if(typeof c=="object"&&c!=null)b._currentEntity=c,b._preflightNavOnLoad&&b.preFlightNav();typeof a=="function"&&a()},function(){b._firstEntityBtn.domNode.style.display="none";b._previousEntityBtn.domNode.style.display="none";b._nextEntityBtn.domNode.style.display="none";b._lastEntityBtn.domNode.style.display="none";b.reconfigureWizard(null);b.updateTitle(null);b.isUpdating=null});this.isUpdating=c.isUpdating;c.usedHash==!0?(this.isUpdating&&
this.reconfigureWizard(void 0),this.configureHashManagement({hashManagement:this._defaultHashManagement})):this.configureHashManagement({hashManagement:null})},reloadEntity:function(a){var b=this._preflightNavOnLoad;this._preflightNavOnLoad=!1;this._inheritOnActivate==!0&&(typeof a=="undefined"?this.loadEntityviaLoader(e.hitch(this,"_onReloadEntity")):(this.setUpdatingEntity(a,!0),this._onReloadEntity(a)));this._preflightNavOnLoad=b},_onReloadEntity:function(a){this.callOnChildren("onReloadEntity");
this.onReloadEntity(a)},onReloadEntity:function(){},preloadEntityCreated:function(){var a=this;this.loadEntity(function(b){if(typeof b=="object"&&b!=null)a._currentEntity=b,a.preFlightNav()})},refreshButtons:function(){this.inherited(arguments);this.title_node.style.display=this._showTitle==!0?"":"none";this._instructionsBtn.domNode.style.display=this._showInstructions==!0?"":"none";this._notesBtn.domNode.style.display=this._showNotes==!0?"":"none";this._cancelBtn.domNode.style.display=this._showCancelBtn==
!0?"":"none";this._prevBtn.domNode.style.display=this._showPreviousButton==!0?"":"none"},getBookingInstructions:function(){},onCancelBtnClicked:function(){typeof this._cancelConfirmMessage!="undefined"?__.confirmDialog.set("confirmMessage",this._cancelConfirmMessage):__.confirmDialog.set("confirmMessage","Are you sure you want to cancel this "+this._entityLabel+" ?");__.confirmDialog.show(e.hitch(this,"cancelConfirmed"))},cancelConfirmed:function(){},onFirstEntityBtnClicked:function(){this.navigateEntityList("first")},
onPreviousEntityBtnClicked:function(){this.navigateEntityList("prev")},onNextEntityBtnClicked:function(){this.navigateEntityList("next")},onLastEntityBtnClicked:function(){this.navigateEntityList("last")},navigateEntityList:function(a){var b=this;this.changeTracker.isModified(this._store)?(__.confirmDialog.set("confirmMessage","You are about to leave this, are you sure you want to discard your changes ?"),__.confirmDialog.set("title","Unsaved changes"),__.confirmDialog.show(function(){b.confirmNavigateAway(a)})):
this.confirmNavigateAway(a)},confirmNavigateAway:function(a){if(this._preloadedEntity.hasOwnProperty(a))this._currentEntity=this._preloadedEntity[a],this.preFlightNav(),this.__useHash==!0&&this.hashManager.setEntity(this._currentEntity.id,!1),this.reconfigureWizard(this._currentEntity),this.updateTitle(this._currentEntity),typeof this.currentForm=="object"&&this.currentForm!=null&&this.currentForm.viewInForm(this._currentEntity,this.currentForm.__form,null,!0),typeof this.executeAfterNavigate=="function"&&
this.executeAfterNavigate(),this.changeTracker.clearChangesObject(this._store)},preFlightNav:function(){if(this._enableNavigateButtons){this._preloadedEntity={};this._firstEntityBtn.set("disabled",!0);this._previousEntityBtn.set("disabled",!0);this._nextEntityBtn.set("disabled",!0);this._lastEntityBtn.set("disabled",!0);var a=this;this.getEntity("next",function(b){if(b!=null)a._preloadedEntity.next=b,a._nextEntityBtn.set("disabled",!1);a.getEntity("prev",function(b){if(b!=null)a._preloadedEntity.prev=
b,a._previousEntityBtn.set("disabled",!1);a.getEntity("last",function(b){if(b!=null)a._preloadedEntity.last=b,a._lastEntityBtn.set("disabled",!1);a.getEntity("first",function(b){if(b!=null)a._preloadedEntity.first=b,a._firstEntityBtn.set("disabled",!1)})})})})}else this._lastEntityBtn.domNode.style.display="none",this._firstEntityBtn.domNode.style.display="none",this._previousEntityBtn.domNode.style.display="none",this._nextEntityBtn.domNode.style.display="none"},getEntity:function(a,b){this._preloadedEntity.hasOwnProperty(a)&&
typeof b=="function"&&b(this._preloadedEntity[a]);var c=__.entities.getContext(this._store);if(c.entityArrayStore){var d=this.navigateArray(c.entityArrayStore,this._currentEntity.id,a);d?b(d):b(null)}else{var d=[],g;for(g in c.options)if(g!="entity_id"&&g!="sort"){var f=c.options[g];typeof f!="undefined"&&d.push(g+"="+f)}e.isArray(c.options.sort)&&(c=c.options.sort[0],d.push("sort("+(c.descending===!0?"-":"+")+c.attribute+")"));c="";d.length>0&&(c="&"+d.join("&"));var h=this;__.api.get(this._store+
"?_nav="+a+"&_nav_id="+this._currentEntity.id+c,null,!1).then(function(a){typeof a=="object"&&a!=null&&(a.hasOwnProperty("error")?(console.log("ENTITY NAVIGATION ERROR > "+a.error.message),b(null)):h._currentEntity==null||typeof h._currentEntity=="undefined"||h._currentEntity.id!=a.id?b(a):b(null))})}},navigateArray:function(a,b,c){b=this.returnIndex(a,b);switch(c){case "next":if(b+1<=a.length-1)return a[b+1];break;case "prev":if(b-1>=0)return a[b-1];break;case "last":if(b<a.length-1)return a[a.length-
1];break;case "first":if(b>0)return a[0]}return null},returnIndex:function(a,b){for(var c=0;c<a.length;c++)if(a[c].id==b)return c},onInstructionsBtnClicked:function(){this.getBookingInstructions();this._instructions.__isShowing?this._instructions.hide():(this._instructions.show(),this._instructions.bringToTop())},onNotesBtnClicked:function(){this._notes.__isShowing?this._notes.hide():(this._notes.show(),this._notes.bringToTop())},__entitySaved:function(a){this.inherited(arguments);this.updateTitle(a);
this.parentDialog&&this._autoClose&&this.parentDialog.confirmHide()},updateTitle:function(a){this.title_node.innerHTML=a!=null?typeof a.name!="undefined"?a.name:"Edit "+this._entityLabel:"New "+this._entityLabel},onDeactivate:function(){if(typeof this.eventHandlers=="undefined")this.eventHandlers=[];for(var a=0;a<this.eventHandlers.length;a++){var b=this.eventHandlers[a];typeof b!="undefined"&&b.remove()}this.inherited(arguments);this.eventHandlers=[]}})});