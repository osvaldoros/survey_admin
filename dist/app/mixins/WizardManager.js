//>>built
define("app/mixins/WizardManager",["dojo/_base/declare","dojo/on","dojo/_base/lang","dojo/topic","dojo/dom-class","app/utils/ChangeTracker","app/utils/HashManager","app/mixins/Saver","app/mixins/TabManager","app/meta/Schema"],function(j,g,d,h,o,k,l,m,n,i){return j([m,n],{changeTracker:k.getInstance(),hashManager:l.getInstance(),_pendingGoNextStep:!1,sequential:!0,mustCompleteFirstTab:!0,_defaultHashManagement:{setHashFunction:"setEntityState",getHashFunction:"getEntityState"},configureWizard:function(a){this.configureSaver(a);
this.configureTabs(a);this.__previousButton=a.previousButton;this.__nextButton=a.nextButton;this._autoGenerateStepsFromMeta=a.autoGenerateStepsFromMeta;this._originalSteps=a.steps.slice(0);if(typeof a.sequential!="undefined")this.sequential=a.sequential;if(typeof a.mustCompleteFirstTab!="undefined")this.mustCompleteFirstTab=a.mustCompleteFirstTab},setCurrentState:function(){this.inherited(arguments);this.refreshButtons()},reconfigureWizard:function(a,b){this.setUpdatingEntity(a);this.mustCompleteFirstTab=
this.updatingEntity?this.sequential=!1:this.sequential=!0;if(typeof b=="object"){if(typeof b.sequential!="undefined")this.sequential=b.sequential;if(typeof b.mustCompleteFirstTab!="undefined")this.mustCompleteFirstTab=b.mustCompleteFirstTab}this.refreshTabs();this.refreshButtons()},onActivate:function(){if(typeof this.eventHandlers=="undefined")this.eventHandlers=[];this._autoStepsReady=!1;typeof this.__previousButton!="undefined"&&this.__previousButton!=null&&this.eventHandlers.push(g(this.__previousButton,
"click",d.hitch(this,"onPreviousClicked")));typeof this.__nextButton!="undefined"&&this.__nextButton!=null&&this.eventHandlers.push(g(this.__nextButton,"click",d.hitch(this,"onNextClicked")));this.inherited(arguments)},createTabs:function(){if(!this._autoGenerateStepsFromMeta||this._autoStepsReady)this.inherited(arguments);else{var a;if(typeof this.modelName!="undefined")a=this.modelName;else{var b=this.getUpdatingEntity();if(b==null&&this.isUpdating==!0){this.updatingEntityListener=h.subscribe(this.id+
"-entity-ready",d.hitch(this,"updatingEntityReady"));return}b!=null?a=b.$ref:typeof this.__storeURL=="string"&&this.__storeURL!=""&&(a=i.getModelNameFromStoreURL(this.__storeURL))}var c=this;i.getModelAsDynamicForm(a,function(a){c.__stepArray=[];for(var b=a.length-1;b>=0;b--){for(var e=a[b],d=null,f=c._originalSteps.length-1;f>=0;f--){var g=c._originalSteps[f];if(e.title==g.title){d=g;break}}f=[e];d!=null?(e=d,e.storeURL=c.__storeURL,e.formMeta=f):e={title:e.title,moduleURL:"app/mixins/DynamicFormModule",
storeURL:c.__storeURL,formMeta:f};c.__stepArray.push(e)}c._autoStepsReady=!0;c.createTabs()})}},reCreateTabs:function(){this.destroyTabs();this._autoStepsReady=!1;this.createTabs()},updatingEntityReady:function(){this.updatingEntityListener.remove();this.createTabs()},__entitySaved:function(){this.inherited(arguments);this.refreshTabs();if(this._pendingGoNextStep)this.moveToNextStep(),this._pendingGoNextStep=!1;if(this._firstEntityBtn)this._firstEntityBtn.domNode.style.display="";if(this._previousEntityBtn)this._previousEntityBtn.domNode.style.display=
"";if(this._nextEntityBtn)this._nextEntityBtn.domNode.style.display="";if(this._lastEntityBtn)this._lastEntityBtn.domNode.style.display=""},prepareForSave:function(){for(var a=this.callOnChildren("prepareForSave"),b=!0,c=0;c<a.length;c++)b=b&&a[c];return b},save:function(){this.shouldCommitOnSave()?this.inherited(arguments):this.runCallBack("entitySaved",this.getEntityFromForms())},getEntityFromForms:function(){for(var a=this.callOnChildren("gatherFormValues"),b=this.getUpdatingEntity()||{},c=0;c<
a.length;c++)d.mixin(b,a[c]);return b},__entityCreated:function(a){this.inherited(arguments);this.__useHash&&(typeof a=="object"&&a!=null&&a.hasOwnProperty("id")?this.hashManager.setEntity(a.id):typeof a=="string"&&this.hashManager.setEntity(a));this.preloadEntityCreated()},refreshTabs:function(a){for(var b in this.__tabContainer.tablist.pane2button){var c=this.__tabContainer.tablist.pane2button[b];if(this._showTabs)if(this.mustCompleteFirstTab){if(typeof a!="undefined"&&a!=null&&a.id!=b)c.domNode.style.display=
"none"}else c.domNode.style.display="";else c.domNode.style.display="none"}},refreshButtons:function(){this.inherited(arguments);if(this.sequential){if(typeof this.__saveButton!="undefined"&&this.__saveButton!=null)this.__saveButton.domNode.style.display="none";var a=this.getCurrentState(),b=this.getFirstStepName(),c=this.getLastStepName();if(typeof this.__previousButton!="undefined"&&this.__previousButton!=null)this.__previousButton.domNode.style.display="",b==null||b!=null&&a.toLowerCase()==b.toLowerCase()?
this.__previousButton.set("disabled",!0):this.__previousButton.set("disabled",!1);if(typeof this.__nextButton!="undefined"&&this.__nextButton!=null)if(this.__nextButton.domNode.style.display="",a==null||c==null||a!=null&&c!=null&&a.toLowerCase()==c.toLowerCase()){if(typeof this.__saveButton!="undefined"&&this.__saveButton!=null)this.__saveButton.domNode.style.display="";this.__nextButton.domNode.style.display="none"}else a.toLowerCase()==b.toLowerCase()&&this.mustCompleteFirstTab&&!this.changeTracker.isModified(this.__storeURL)?
this.__nextButton.set("disabled",!0):this.__nextButton.set("disabled",!1)}else{if(typeof this.__saveButton!="undefined"&&this.__saveButton!=null)this.__saveButton.domNode.style.display="";if(typeof this.__previousButton!="undefined"&&this.__previousButton!=null)this.__previousButton.domNode.style.display="none";if(typeof this.__nextButton!="undefined"&&this.__nextButton!=null)this.__nextButton.domNode.style.display="none"}},onNextClicked:function(){if(this.changeTracker.isModified(this.__storeURL)){if(this.prepareForSave())if(this.shouldCommitOnSave())this._pendingGoNextStep=
!0,h.publish("company-tree-getParentId",this.__storeURL),this.changeTracker.commitChanges(this.__storeURL,this.updatingEntity);else{var a=this.getEntityFromForms();a.__stay_open=!0;this.__entityCreated(a);this.moveToNextStep();delete a.__stay_open}}else this.moveToNextStep()},moveToNextStep:function(){var a=this.getStepIndex(this.getCurrentState());a!=-1&&(a=this.getStepName(a+1),a!=null?this.__useHash?this.__setHashFunction(a):this.setCurrentState(a):console.warn("WizardManager > Can't moveToNextStep, stepName is null"))},
onPreviousClicked:function(){var a=this.getStepIndex(this.getCurrentState());a!=-1&&a>0&&(a=this.getStepName(a-1),a!=null?this.__useHash?this.__setHashFunction(a):this.setCurrentState(a):console.warn("WizardManager > Can't go to previous step, stepName is null"))},onDeactivate:function(){this.changeTracker.clearChangesObject(this.__storeURL);this.inherited(arguments)}})});