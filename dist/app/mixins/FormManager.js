//>>built
define("app/mixins/FormManager",["dojo/_base/declare","dojox/form/Manager","dojo/topic","dojo/_base/lang","app/store/StoreManager","app/utils/HashManager","app/form/Manager"],function(j,n,k,h,l,m,i){return j([],{storeManager:l.getInstance(),hashManager:m.getInstance(),_entity:null,__form:null,startup:function(){this.inherited(arguments);for(var a=this.getChildren(),c=a.length-1;c>=0;c--){var d=a[c];if(typeof d.isInstanceOf=="function"&&d.isInstanceOf(i))this.__form=d,this.setStoreFromParentWizard(this.__form)}if(this.__form==
null)for(a=this._attachPoints.length-1;a>=0;a--)if(d=this[this._attachPoints[a]],typeof d.isInstanceOf=="function"&&d.isInstanceOf(i))this.__form=d,this.setStoreFromParentWizard(this.__form)},setStoreFromParentWizard:function(){if(typeof this.__form.storeURL=="undefined"&&typeof this.parentWizard=="object"&&this.parentWizard!=null&&typeof this.parentWizard.getStoreURL=="function"){var a=this.parentWizard.getStoreURL();a!=null&&typeof a!="undefined"?this.__form.storeURL=a:console.warn("Form Manager "+
this.id+" without storeURL!")}},gatherFormValues:function(a){if(typeof this.__form!="undefined"&&this.__form!=null&&typeof this.__form.gatherFormValues=="function")return this.__form.gatherFormValues(a)},prepareForSave:function(){return!0},onReloadEntity:function(a){typeof this.__form!="undefined"&&this.__form!=null&&(a||this.getUpdatingEntity(),this.viewInForm(this.getUpdatingEntity(),this.__form))},getFromParent:function(a){if(typeof this.parentWizard=="object"&&this.parentWizard!=null)return this.parentWizard[a]},
setOnParent:function(a,c){typeof this.parentWizard=="object"&&this.parentWizard!=null&&(this.parentWizard[a]=c)},configureForm:function(a){this.__form=a},loadHashEntityInForm:function(){var a=this.hashManager.getEntity(),c=this;return __.entities.withEntity(a,this.__form.storeURL,function(a){c.viewInForm(a,c.__form)})},getUpdatingEntity:function(){if(typeof this.parentWizard=="object"&&this.parentWizard!=null&&typeof this.parentWizard.getUpdatingEntity=="function")return this.parentWizard.getUpdatingEntity();
return this.inherited(arguments)},onActivate:function(){this.inherited(arguments);if(this.__form&&(this.creationHandler=k.subscribe(this.__form.storeURL+"-created",h.hitch(this,"_formManagerEntityCreated")),this.parentWizard))this.parentWizard.currentForm=this},onDeactivate:function(){this.inherited(arguments);this.creationHandler&&this.creationHandler.remove()},viewInForm:function(a,c,d,e){typeof e=="undefined"&&(e=!1);e&&c.reset();if(!(typeof a!="object"||a==null)){e={};this.flattenNames(a,e,d);
var b=a.loc;if(typeof b!="undefined"&&b!=null)e.loc=b;else if(b=this.getAddress(e),b!=null&&b!=""&&b!=" ")e.loc=b;c._entity=a;c._flattenedEntity=e;c._arrayPropIndexes=d;c.setFormValues(e);return e}},flattenNames:function(a,c,d,e){typeof e=="undefined"&&(e="");for(var b in a){var f=a[b],g="";e==""?g=e+b:g=e+"."+b;if(h.isArray(f))d!=null&&typeof d!="undefined"&&d.hasOwnProperty(b)&&typeof f[d[b]]!="undefined"?(e==""?g=e+b+"[x]":g=e+"."+b+"[x]",this.flattenNames(f[d[b]],c,d,g)):c[g]=f;else if(typeof f==
"object"&&f!=null){if(typeof f.$ref!="undefined"||typeof f.ref!="undefined")c[g]=f.id;this.flattenNames(f,c,d,g)}else c[g]=f}},_formManagerEntityCreated:function(a){this.entityCreated(a);var c=this;__.entities.withEntity(a,this.__form.storeURL,function(a){c.updatingEntity=a;c.viewInForm(a,c.__form)})},entityCreated:function(){},getAddress:function(a){for(var c=["street","city","province","state","country"],d=[],e=0;e<c.length;e++){var b=c[e],f;for(f in a)if(f.indexOf(b)!=-1){f.indexOf("mail_")!=-1&&
(b=f.split("mail_").join(""),a.hasOwnProperty(b)&&(f=b));b=this.getNumberFromProperty(f);b<2?d.push(a[f]):b==2&&(b=f.split("2").join(""),a.hasOwnProperty(b+"1")?d.push(a[b+"1"]+" "+a[f]):d.push(a[f]));break}}return d.length>0?d.join(" "):null},getNumberFromProperty:function(a){return(a=a.match(/[0-9]+/))&&a.length>0?parseInt(a[0]):0},executeAfterNavigate:function(){}})});