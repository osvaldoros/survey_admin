//>>built
define("app/utils/HashManager",["dojo/_base/declare","dojo/hash","dojo/_base/array","dojo/_base/lang","dojo/topic"],function(g,h,j,f,i){var k=g("app.utils.HashManager",[],{lastModuleURL:{},update:!0,constructor:function(a){g.safeMixin(this,a||{});this.hashChangeHandle=i.subscribe("/dojo/hashchange",f.hitch(this,"onHashChange"))},onHashChange:function(a){var b=this.clean(a);b!=a?this.setHash(b):(this.update==!0&&i.publish("/__/hashchange",a),this.update=!0)},addIdToURL:function(a,b){return a.indexOf("{id}")!=
-1?a.split("{id}").join(b):a+b},clean:function(a){return a=this.removeAuthToken(a)},parseHash:function(a){var b={},a=a.toLowerCase(),a=a.split("/");a[0]==""&&a.length>1&&a.splice(0,1);b.moduleName=a[0];if(a.length>=2)b.stateName=a[1];if(a.length>=3)b.entityName=a[2];b.hashPieces=a;return b},addAuthToken:function(a){return a+"_-_"+__.user.auth_token},getAuthToken:function(){var a=this.getHash().split("_-_");if(f.isArray(a)&&a.length>1)return a[1];return null},removeAuthToken:function(a){return a.split("_-_")[0]},
dropAuthToken:function(){this.setHash(this.removeAuthToken(this.getHash()))},dropHashItemsAfterNumber:function(a){this.setHash(this.getHash().split("/").slice(0,a+1).join("/"))},getNextHashState:function(a){a=this.getNextHashItem(a);a!=null&&a==this.getEntity()&&(a=this.getNextHashItem(a));return a},getNextHashItem:function(a){if(typeof a=="undefined"||a==null)return null;var a=a.toLowerCase(),b=this.getHash().split("/"),a=j.indexOf(b,a);if(a==-1)return null;if(a<b.length-1)return b[a+1].toLowerCase();
return null},getHash:function(){return h()},setHash:function(a,b){typeof b=="undefined"&&(b=!0);this.update=b;for(var e=a.split("/"),c=[],d=0;d<e.length;d++)e[d]!=""&&c.push(e[d]);c.push("");e=c[0];c=c.join("/");this.lastModuleURL[e]=c;h(c)},getLastModuleURL:function(a){if(this.lastModuleURL.hasOwnProperty(a))return this.lastModuleURL[a];return null},getModule:function(){return this.getFragment(0)},setModule:function(a,b){this.setFragment(0,a,b)},getState:function(){return this.getFragment(1)},setState:function(a,
b){this.setFragment(1,a,b)},getEntity:function(){var a=this.getFragment(2);return typeof a!="undefined"&&a!=null&&a!=""&&a!="new"?a:"none"},setEntity:function(a,b){this.setFragment(2,a,b)},getModuleStateAndEntity:function(){var a=this.__getPieces();return this.__getFragment(a,0)+"/"+this.__getFragment(a,1)+"/"+this.__getFragment(a,2)},getEntityState:function(){return this.getFragment(3)},setEntityState:function(a,b){this.setFragment(3,a,b)},setFragment:function(a,b,e){var c=this.parseHash(this.getHash()).hashPieces,
d=c.length-1;if(a>d)for(;d<a;d++)c[d]="undefined";c[a]=b;this.setHash(c.join("/"),e)},getFragment:function(a){return this.__getFragment(this.__getPieces(),a)},__getPieces:function(){return this.parseHash(this.getHash()).hashPieces},__getFragment:function(a,b){return a.length>b?a[b]:null}});f.mixin(app.utils.HashManager,{getInstance:function(a){if(!app.utils.HashManager._instance)app.utils.HashManager._instance=new app.utils.HashManager(a);return app.utils.HashManager._instance}});return k});