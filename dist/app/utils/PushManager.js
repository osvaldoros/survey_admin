//>>built
define("app/utils/PushManager",["dojo/_base/declare","dojox/socket","dojo/_base/lang","dojo/topic","dojo/_base/json"],function(b,f,d,e,c){b=b("app.utils.PushManager",[],{socket:null,_connected:!1,_messageHandler:null,_connectHandler:null,connect:function(){var a=this;if(dojo.config.appSpecific.websocket_enabled==!0)this.socket=dojox.socket(__.urls.WEBSOCKET+"?token="+__.user.auth_token),this._connectHandler=this.socket.on("open",function(){a._connected=!0}),this._messageHandler=this.socket.on("message",
function(a){a=c.fromJson(a.data);e.publish("push-notification-"+a.type,a)})},send:function(a){this._connected&&typeof this.socket!="undefined"&&this.socket!=null&&this.socket.send(c.toJson(a))},disconnect:function(){typeof this._connectHandler!="undefined"&&this._connectHandler!=null&&this._connectHandler.remove();typeof this._messageHandler!="undefined"&&this._messageHandler!=null&&this._messageHandler.remove();typeof this.socket!="undefined"&&this.socket!=null&&this.socket.close();this._connected=
!1}});d.mixin(app.utils.PushManager,{getInstance:function(a){if(!app.utils.PushManager._instance)app.utils.PushManager._instance=new app.utils.PushManager(a);return app.utils.PushManager._instance}});return b});