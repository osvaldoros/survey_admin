//>>built
require({cache:{"url:app/templates/Auth.html":'<div>\n\t<div style="width: 280px; color: #ffffff; margin-left: auto; margin-right: auto; margin-top: 200px;">\n\t\t<h1>iCAS MH</h1>\n\t\t<div style="margin-left: 10px; margin-top: 20px;">\n\t\t\t<h2>Please login to continue</h2>\n\t\t\t<br />\n\t\t\t<form class="pad10" dojoType="app.form.AjaxForm" data-dojo-attach-point="loginForm">\n\t\t\t\t<table cellpadding="0" cellspacing="2">\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td  vertical-align="middle"><strong>Username: </strong></td>\n\t\t\t\t\t\t<td><input type="text" required="true" name="usernameFld" data-dojo-attach-point="usernameFld" \n\t\t\t\t\t\t\tdojoType="dijit.form.ValidationTextBox" missingMessage="Please enter a username" /></td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td  vertical-align="middle"><strong>Password: </strong></td>\n\t\t\t\t\t\t<td><input type="password" required="true" name="passwordFld" data-dojo-attach-point="passwordFld"  \n\t\t\t\t\t\t\tdojoType="dijit.form.ValidationTextBox" missingMessage="Please enter a password" /></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</table>\n\t\t\t\n\t\t\t\t<button class="floatRight pad10" dojoType="dijit.form.Button" data-dojo-attach-point="loginButton">Login</button>\n\t\t\t</form>\n\t\t</div>\n\t</div>\n</div>\t\n'}});
define("app/Auth",["dojo/_base/declare","dojo/on","dijit/layout/ContentPane","app/mixins/StatefulModule","dojo/text!./templates/Auth.html","dojo/_base/lang","dojo/_base/xhr","app/utils/StringUtils","dijit/Tooltip","dojox/validate","dojox/validate/web","app/form/AjaxForm","dijit/form/Button","dijit/form/ValidationTextBox","app/store/UIStores","app/utils/HashManager"],function(h,f,i,j,k,e,g,l,m,p,q,r,s,t,n,o){return h("app.Auth",[i,j],{uiStores:n.getInstance(),hashManager:o.getInstance(),content:k,
startup:function(){this.inherited(arguments);this.loginForm=this.getWidget("loginForm");this.loginButton=this.getWidget("loginButton");this.usernameFld=this.getWidget("usernameFld");this.passwordFld=this.getWidget("passwordFld");__.authManager=this;var a=this.hashManager.getAuthToken();typeof a!="undefined"&&a!=null&&(this.attemptTokenLogin(a),this.hashManager.dropAuthToken())},onPasswordKeyUp:function(a){if(a.keyIdentifier=="Enter"||a.key=="Enter"||a.keyCode==13)this.onLoginClicked()},onActivate:function(){if(typeof this.eventHandlers==
"undefined")this.eventHandlers=[];this.eventHandlers.push(f(this.loginButton,"click",e.hitch(this,"onLoginClicked")));this.eventHandlers.push(f(this.passwordFld,"keypress",e.hitch(this,"onPasswordKeyUp")));this.eventHandlers.push(f(this.usernameFld,"focus",e.hitch(this,"hideInvalidCredentialsToolTip")));this.eventHandlers.push(f(this.passwordFld,"focus",e.hitch(this,"hideInvalidCredentialsToolTip")));this.loginForm.reset();dojo.config.isDebug&&(this.usernameFld.set("value","osvaldo.ros@gmail.com"),
this.passwordFld.set("value","asdasd"))},onDeactivate:function(){this.inherited(arguments);this.hideInvalidCredentialsToolTip();for(var a=0;a<this.eventHandlers.length;a++)this.eventHandlers[a].remove();this.eventHandlers=[]},hideInvalidCredentialsToolTip:function(){typeof this.invalidCredentials!="undefined"&&this.invalidCredentials.close()},showInvalidCredentialsTootip:function(a){if(!a||a=="")a="Invalid username and password";if(typeof this.invalidCredentials=="undefined")this.invalidCredentials=
new m({label:a});this.invalidCredentials.open(this.loginForm.domNode)},enableForm:function(a){this.usernameFld.set("disabled",!a);this.passwordFld.set("disabled",!a);this.loginButton.set("disabled",!a)},attemptTokenLogin:function(a){var c=this,a=g.get({url:__.urls.LOGIN,handleAs:"json",ioPublish:!1,headers:{"X-Auth-Token":a}});a.then(function(a){return function(b){c.handleLogin(a,b)}}(a))},onLoginClicked:function(){if(this.loginForm.validate()){__.spinner.show();this.enableForm(!1);var a={username:this.usernameFld.value,
password:this.passwordFld.displayedValue},c=this,a=g.get({url:__.urls.LOGIN,handleAs:"json",ioPublish:!1,headers:{Authorization:"Plain "+a.username+":"+a.password},error:e.hitch(this,"xhrError")});a.then(function(a){return function(b){c.handleLogin(a,b)}}(a))}},xhrError:function(a){__.spinner.hide();this.enableForm(!0);__.alert.set("title","Communication error");__.alert.set("message",a.status+" : "+a.xhr.statusText);__.alert.show()},handleLogin:function(a,c){__.spinner.hide();this.enableForm(!0);
var d=a.ioArgs.xhr.getResponseHeader("X-Auth-Token");document.cookie="X-Auth-Token="+d+";path=/;";if(typeof c.error!="undefined")this.isActive()&&this.showInvalidCredentialsTootip(c.error.message);else{__.user=c;__.user.auth_token=d;var b;typeof __.user.role=="object"&&__.user.role!=null&&e.isArray(__.user.role.tabs)&&e.isArray(__.user.role.modules)?(d=__.user.role.tabs,b=__.user.role.modules):(d=dojo.config.appSpecific.tabs,b=dojo.config.appSpecific.modules);if(!e.isArray(d)||d.length==0)d=b.slice(0);
dojo.config.appSpecific.tabs=this.processModules(d);dojo.config.appSpecific.modules=this.processModules(b);this.initApp()}},hasPermission:function(a){if(typeof __.user=="object"&&__.user!=null&&typeof __.user.role=="object"&&__.user.role!=null&&e.isArray(__.user.role.perms)&&__.user.role.perms.length>0)for(var c=__.user.role.perms.length-1;c>=0;c--)if(__.user.role.perms[c].name==a)return!0;return!1},initApp:function(){this.uiStores.preloadCatalogs(e.hitch(this,"gotoWorkspace"))},gotoWorkspace:function(){__.setCurrentState("app/Workspace")},
logout:function(){},processModules:function(a){for(var c=[],d=0;d<a.length;d++){var b=a[d];if(typeof b.module_url!="undefined")b.moduleURL=b.module_url;if(typeof b.path!="undefined")b.moduleURL=b.path;if(typeof b.moduleURL=="undefined")b.moduleURL="app/modules/"+b.name.split(" ").join("");if(typeof b.name!="undefined")b.title=b.name;if(typeof b.label!="undefined")b.title=b.label;b.hash=l.slugify(b.title);c.push(b)}return c}})});