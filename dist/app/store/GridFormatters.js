//>>built
define("app/store/GridFormatters",["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-class","app/store/UIStores","app/uicomponents/MoreInfoRenderer","app/uicomponents/moreInfoRenderers/TestMoreInfoRenderer","dijit/ProgressBar","dijit/form/CheckBox","dijit/form/RadioButton","dijit/Tooltip","app/utils/HashManager","dojo/topic","dojo/on","app/store/GridCheckboxes"],function(k,g,q,i,r,l,s,t,o,u,w,p,m,n,v){k=k("app.store.GridFormatters",[],{});g.mixin(app.store.GridFormatters,{hourFormatter:function(a){var b=
a.split(":"),a=Number(b[0]),d;b.length>1&&(d=Number(b[1]));b=!1;a>=12&&(b=!0);a>12&&(a-=12);a==0&&(a=12);var c="";c+=a;typeof d!="undefined"&&(d<10&&(d="0"+d),c+=":"+d);b&&(c+=" pm");return c},weekDayFormatter:function(a){return r.getInstance().dayValues[parseInt(a)-1]},nestedOrBlankObjectRenderer:function(a,b,d,c,e){b=(e||this.field).split(".");for(d=0;d<b.length;d++)c=b[d],typeof a=="object"&&a!=null&&(a=a[c]);typeof a!="string"&&(a="");b=document.createElement("div");b.className="renderedCell";
b.innerHTML=a;return b},nestedObjectRenderer:function(a,b,d,c,e){b=this.hasOwnProperty("notFoundLabel")&&this.notFoundLabel!=null?this.notFoundLabel:"";a=app.store.GridFormatters.getNestedObject(a,e||this.field);typeof a!="string"&&(a=b);e=document.createElement("div");e.className="renderedCell";e.innerHTML=a;return e},getNestedObject:function(a,b){if(b===".")return a;for(var d=b.split("."),c=a,e=0;e<d.length;e++){var f=d[e];if(typeof c=="object"&&c!=null)c=c[f];else{c=null;break}}return c},feeScheduleRenderer:function(a,
b,d,c,e){c=e||this.field;b=a;d="name";if(this.hasOwnProperty("nameProperty"))d=this.nameProperty;if(c!="."){c=c.split(".");for(e=0;e<c.length;e++){var f=c[e];typeof b=="object"&&b!=null&&(b=b[f])}}c=d.split(".");for(e=0;e<c.length;e++)f=c[e],typeof a=="object"&&a!=null&&(a=a[f]);b={_data:b,_computedName:a,_nameProperty:d};if(typeof this.useLink!="undefined")b.useLink=this.useLink;b=new l(b);a=document.createElement("div");a.className="renderedCell";b.placeAt(a);b.startup();return a},checkMarkRenderer:function(a){var b=
document.createElement("div");if(a[this.field]==!0)b.className="checkmark_red";return b},checkBoxRenderer:function(a,b,d){b="_"+a.id;b=v.getInstance().getCheckBox(this.field,b);b.startup();typeof this.defaultChecked!="undefined"&&(this.defaultChecked===!0||this.defaultChecked===!1)?a=this.defaultChecked:(a=app.store.GridFormatters.getNestedObject(a,this.field),a=a==!0||a=="true");b.set("checked",a);b.placeAt(d)},nestedObjectCount:function(a){for(var b=this.field.split("."),d=0;d<b.length;d++){var c=
b[d];typeof a=="object"&&a!=null&&(a=a[c]);g.isArray(a)&&d<b.length-1&&(a=a[0])}a=g.isArray(a)?a.length:"0";b=document.createElement("div");b.className="renderedCell";b.innerHTML=a;return b},siteServicesRenderer:function(a){for(var b=[],d={},c=0;c<a._services.length;c++){for(var e=a._services[c],f=[],g={},i=e.subtest_fee_entries.length-1;i>=0;i--){var h=e.subtest_fee_entries[i];if(typeof h.subtest_type=="object"&&h.subtest_type!=null){f.push(h.subtest_type.name);var j={};if(typeof h.fee!="undefined")j.fee=
h.fee;if(typeof h.fee_to_client!="undefined")j.fee_to_client=h.fee_to_client;if(typeof h.premium!="undefined")j.premium=h.premium;g[h.subtest_type.name]=j}}e=typeof e.service=="object"&&e.service!=null?e.service.name:"service?";subtestString=f.length>0?f.join(", "):"subtests?";b.push(e+"("+subtestString+")");d[e]=g}a={_data:d,_tooltipTitle:"Services",clipLongProperties:!1,_computedName:b.join("<br/>"),_nameProperty:"name",useLink:!1};a=new l(a);b=document.createElement("div");b.className="renderedCell";
a.placeAt(b);a.startup();return b},arrayNames:function(a){for(var b=this.field.split("."),d=0;d<b.length;d++){var c=b[d];typeof a=="object"&&a!=null&&(a=a[c]);g.isArray(a)&&d<b.length-1&&(a=a[0])}a=g.isArray(a)?a.join(", "):"";b=document.createElement("div");b.className="renderedCell";b.innerHTML=a;return b},languageNameArray:function(a){for(var b=this.field.split("."),d=0;d<b.length;d++){var c=b[d];typeof a=="object"&&a!=null&&(a=a[c]);g.isArray(a)&&d<b.length-1&&(a=a[0])}if(g.isArray(a)){b=[];for(d=
0;d<a.length;d++)c=a[d],typeof c=="object"&&c!=null&&typeof c.language=="object"&&c.language!=null&&b.push(c.language.name);a=b.join(", ")}else a="";d=document.createElement("div");d.className="renderedCell";d.innerHTML=a;return d},moreInfoRenderer:function(a,b,d,c,e){c=e||this.field;b=a;d="name";if(this.hasOwnProperty("nameProperty"))d=this.nameProperty;if(c!="."){c=c.split(".");for(e=0;e<c.length;e++){var f=c[e];typeof b=="object"&&b!=null&&(b=b[f])}}c=d.split(".");for(e=0;e<c.length;e++)f=c[e],
typeof a=="object"&&a!=null&&(a=a[f]);b={_data:b,_computedName:a,_nameProperty:d};if(typeof this.useLink!="undefined")b.useLink=this.useLink;b=new l(b);a=document.createElement("div");a.className="renderedCell";b.placeAt(a);b.startup();return a},testMoreInfoRenderer:function(a){var b={};b._data=a.newLink?a.newLink.test:app.store.GridFormatters.getNestedObject(a,this.field);if(typeof this.useLink!="undefined")b.useLink=this.useLink;a=new s(b);b=document.createElement("div");b.className="renderedCell";
a.placeAt(b);a.startup();return b},randomSelectionProgressRenderer:function(a,b,d,c){return typeof a.progress=="object"&&a.progress!=null&&a.progress.$ref=="rnd_sel_progress"&&a.progress.id=="COMPLETE"?app.store.GridFormatters.nestedObjectRenderer(a,b,d,c,"progress.name"):app.store.GridFormatters.progressBarRenderer(a,b,d,c)},progressBarRenderer:function(a,b,d){if(typeof __.renderers!="object"||__.renderers==null)__.renderers={};__.renderers.hasOwnProperty(a.id)?(b=__.renderers[a.id],b.update({maximum:a.steps,
progress:a.progress})):(b=new t({maximum:a.steps,progress:a.progress}),b.startup(),__.renderers[a.id]=b);b.placeAt(d);return null},updateProgressBar:function(a){__.renderers!=null&&__.renderers!=void 0&&__.renderers[a.target].update({maximum:a.steps,progress:a.progress})},runExpressionRenderer:function(a,b,d){var c,e="_"+a.id;if(__.runExpressionCheckBoxes==void 0||__.runExpressionCheckBoxes==null)__.runExpressionCheckBoxes={};__.runExpressionCheckBoxes[e]==null||__.runExpressionCheckBoxes[e]==void 0?
(c=new o,c.set("id",e),__.runExpressionCheckBoxes[e]=c):c=__.runExpressionCheckBoxes[e];c.startup();if(!(a.status==void 0||a.status==null))b==1?(a="Add",b="green"):(a="Remove",b="red"),d.innerHTML='<label style="margin-right: 10px;" for="'+c.id+'"><font color="'+b+'">'+a+"</font></label>",c.set("checked",!0),c.placeAt(d)},billingRunRenderer:function(a,b,d){var c,b="_"+a.eid;if(__.billingRunCheckBoxes==void 0||__.billingRunCheckBoxes==null)__.billingRunCheckBoxes={},__.billingRunCheckBoxesLength=0;
c=new u;c.set("name",b);if(d.columnId.indexOf("Approve")!=-1)if(c.set("id",b),c.companyName=a.account.name,c.companyId=a.account.id,__.billingRunCheckBoxes[b]=c,__.billingRunCheckBoxesLength++,a.exceptions&&a.exceptions.length>0)for(b=0;b<a.exceptions.length;b++){if(!a.exceptions[b].warning){c.set("checked",!1);break}b==a.exceptions.length-1&&(c.set("checked",!0),n(c,"change",function(){m.publish("approve-reject-invoice-checked",a,c.get("checked"))}))}else c.set("checked",!0),n(c,"change",function(){m.publish("approve-reject-invoice-checked",
a,c.get("checked"))});else c.set("id","_"+b);if(a.exceptions&&a.exceptions.length>0)for(b=0;b<a.exceptions.length;b++)if(!a.exceptions[b].warning){c.set("disabled",!0);d.columnId.indexOf("Reject")!=-1&&c.set("checked",!0);break}c.startup();c.placeAt(d)},billingRunInternalExceptionRenderer:function(a,b,d){if(a.exceptions&&a.exceptions.length>0){var b="",c;for(c in a.exceptions)b+=a.exceptions[c].warning?"\n\nWarning:\n"+a.exceptions[c].message:"\n\nCritical Error:\n"+a.exceptions[c].message;d.innerHTML=
'<span class="XwBorder" title="There are internal exceptions.'+b+'" style="background:white;margin-left:35px;"><font color="red" size="3" >!</span>'}},billingRunNotesRenderer:function(a,b,d){if(a.dependencies&&a.dependencies.length>0){var b="",c;for(c in a.dependencies)b+="\n"+a.dependencies[c].name;a.noteId="run_notes_"+a.eid;d.innerHTML="<span id="+a.noteId+' class="XwBorder" title="Dependent accounts must be approve/rejected together.\n\nDepends on:'+b+'" style="background:white;margin-left:35px;display:none"><font color="blue" size="2" >Conflict</span>'}},
billingRunTotalRenderer:function(a,b,d){b=0;if(a.invoices&&a.invoices.length)for(var c in a.invoices)b+=a.invoices[c].total;d.innerHTML=b.toString()},creditInvoiceRenderer:function(a,b,d){var b=a.id,c;if(__.creditInvoiceCheckBoxes==void 0||__.creditInvoiceCheckBoxes==null)__.creditInvoiceCheckBoxes={};__.creditInvoiceCheckBoxes[b]==null||__.creditInvoiceCheckBoxes[b]==void 0?(c=new o,c.set("id",b),c.invoice=a,__.creditInvoiceCheckBoxes[b]=c):c=__.creditInvoiceCheckBoxes[b];c.startup();c.set("checked",
!0);c.placeAt(d)},documentMoreInfoRenderer:function(a,b,d,c){b=app.store.GridFormatters.nestedObjectRenderer(a,b,d,c,"doc_type.name");a=p.getInstance().addAuthToken(p.getInstance().addIdToURL(__.urls.model.links.editor.doc,a.id));b.innerHTML='<a href="'+a+'" target="_blank">'+b.innerHTML+"</a>";return b},makeLinkRenderer:function(a){var b=document.createElement("div");if(a.has_children)b.className="XwBorder",a.isLink=!0;b.innerHTML="Expand";n(b,"click",function(){m.publish("company-tree-click",a)});
return b},addRowRenderer:function(a,b){q.around(a,"insertRow",g.hitch(app.store.GridFormatters,b))},defaultRenderer:function(a){return function(b){var d=a.apply(this,arguments);b.disabled==!0&&i.add(d,"disabledRow");return d}},entryRenderer:function(a){return function(b){var d=a.apply(this,arguments);b.inherited==!0&&i.add(d,"fadedRow");return d}},testRowRenderer:function(a){return function(b){var d=a.apply(this,arguments);(b.pay_site==!1||b.pay_lab==!1)&&i.add(d,"fadedRow");return d}},documentAssignedRenderer:function(a){return function(b){var d=
a.apply(this,arguments);b.isAssignedDoc&&i.add(d,"fadedRow");return d}}});return k});