//>>built
define("app/store/Entities",["dojo/_base/declare","app/store/StoreManager","app/utils/HashManager","dojo/_base/lang"],function(g,h,i,e){return g("app.store.Entities",[],{storeManager:h.getInstance(),hashManager:i.getInstance(),_requestMap:{},_entityRequestedInHash:null,_locationParams:null,getCurrentLocationParams:function(){return this._locationParams},setCurrentLocationParams:function(a){this._locationParams=a},constructor:function(a){g.safeMixin(this,a||{});this._contextMap={"default":{options:{}}}},
setContext:function(a,c){if(typeof c=="undefined"||c=="")c="default";if(typeof a!="object"||a==null)a={};this._contextMap[c]={entityId:a.entityId,entityType:a.entityType,entity:a.entity,entityArrayStore:a.arrayStore,options:a.options||{}}},getContext:function(a){if(typeof a=="undefined"||a=="")a="default";this._contextMap.hasOwnProperty(a)||(this._contextMap[a]={options:{}});return this._contextMap[a]},addOptionsToContext:function(a,c){if(typeof c=="undefined"||c=="")c="default";if(typeof a!="object"||
a==null)a={};e.mixin(this.getContext(c).options,a)},simplifyArrayItemPropToReference:function(a,c){var d,b;if(e.isArray(a)){d=a.slice(0);for(var f=d.length-1;f>=0;f--)b=d[f],typeof b=="object"&&b!=null&&(b=this.simplifyArrayItemPropToReference(b,c),d[f]=b)}else if(typeof a=="object"&&a!=null)if(d=e.clone(a),d.hasOwnProperty(c))d[c]=this.simplifyToReference(d[c]);else for(f in d)b=d[f],typeof b=="object"&&b!=null&&(b=this.simplifyArrayItemPropToReference(b,c),d[f]=b);return d},simplifyArrayItemsToReference:function(a){if(!e.isArray(a))return a;
for(var a=a.slice(0),c=a.length-1;c>=0;c--)a[c]=this.simplifyToReference(a[c]);return a},simplifyToReference:function(a){if(typeof a=="object"&&a!=null&&a.hasOwnProperty("$ref")&&a.hasOwnProperty("id"))return{$ref:a.$ref,id:a.id};return a},getEntityFromHash:function(a,c,d,b){return this.withEntity(this.hashManager.getEntity(),a,c,d,b)},withEntity:function(a,c,d,b,f){if(parseInt(a,16)>=0)if(this._requestMap.hasOwnProperty(c+"_"+a))b=this._requestMap[c+"_"+a],b.push(d),this._requestMap[c+"_"+a]=b;else{if(this._entityRequestedInHash!=
this.hashManager.getModuleStateAndEntity()||typeof b!="undefined"||f==!0)this._entityRequestedInHash=this.hashManager.getModuleStateAndEntity();b=this.storeManager.getBaseQueryObject(b);typeof b=="object"&&b!=null&&b!=!1?(b.id=a,b=this.storeManager.getStore(c).get(b)):b=this.storeManager.getStore(c).get(a);var e=this;b&&b.then?(this._requestMap[c+"_"+a]=[d],b.then(function(b){e._entity=b;for(var d=0;d<e._requestMap[c+"_"+a].length;d++)(0,e._requestMap[c+"_"+a][d])(b);delete e._requestMap[c+"_"+a]})):
(this._entity=b,d(b));return!0}else return this._entity=null,!1}})});