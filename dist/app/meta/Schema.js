//>>built
define("app/meta/Schema",["dojo/_base/declare","dojo/_base/lang","app/store/UIStores"],function(e,h,k){e=e("app.meta.Schema",[],{});h.mixin(app.meta.Schema,{typeToWidget:{string:"dijit.form.ValidationTextBox",object_id:"dijit.form.ValidationTextBox",timestamp:"dijit.form.ValidationTextBox",time:"dijit.form.ValidationTextBox","long":"dijit.form.ValidationTextBox","double":"dijit.form.ValidationTextBox",link:"dijit.form.ValidationTextBox","boolean":"dijit.form.CheckBox",date:"dijit.form.DateTextBox",
list:"app.form.FilteringSelect",ref:"app.form.FilteringSelect","enum":"app.form.FilteringSelect"},excludeFields:{org_path:!0},modelCache:{},getModel:function(a,b){if(typeof a!="string")console.warn("modelName must be a string in call Schema.getModel");else if(typeof b!="function")console.warn("callBack must be a function in call Schema.getModel");else{if(app.meta.Schema.modelCache.hasOwnProperty(a))return b(app.meta.Schema.modelCache[a]);__.api.get("/__/_meta/"+a).then(function(c){app.meta.Schema.modelCache[a]=
c;b(c)})}},getModelNameFromStoreURL:function(a){if(typeof a!="string"||a=="")return console.warn("Invalid storeURL used in call to Schema.getModelNameFromStoreURL"),null;a=a.split("/");return a[a.length-1].split("?")[0]},getModelAsDynamicFormByStoreURL:function(a,b){var c=app.meta.Schema.getModelNameFromStoreURL(a);app.meta.Schema.getModelAsDynamicForm(c,b)},getModelAsDynamicForm:function(a,b){app.meta.Schema.getModel(a,function(a){for(var e=[],f={},i=a.properties.length-1;i>=0;i--){var d=a.properties[i];
if(!app.meta.Schema.excludeFields.hasOwnProperty(d.name)){var g;g=d.hasOwnProperty("ui_group")?d.ui_group:"basic_info";var j;j=f.hasOwnProperty(g)?f[g]:{title:g,fields:[]};d=app.meta.Schema.processField(d);d!=null&&j.fields.push(d);f[g]=j}}for(var h in f)e.push(f[h]);b(e)})},processField:function(a){var b={fieldOptions:{}};b.label=a.label||a.name;b.name=a.name;b.readOnly=a.read_only;app.meta.Schema.calculateFieldType(b,a);if(b.hasOwnProperty("fieldType"))return b;return null},calculateFieldType:function(a,
b){if(b.prop_type=="primitive"&&app.meta.Schema.typeToWidget.hasOwnProperty(b.type))a.fieldType=app.meta.Schema.typeToWidget[b.type];else if(b.prop_type=="ref"||b.prop_type=="enum"){a.fieldType=a.readOnly||b.type=="rnd_sel"?app.meta.Schema.typeToWidget.link:app.meta.Schema.typeToWidget[b.prop_type];a.ref=b.type;var c=k.getInstance().getPreloadForModel(b.type);typeof c!="undefined"?a.fieldOptions.storeFunction=c:a.fieldOptions.storeURL=dojo.config.appSpecific.api_host+"__/"+b.type}}});return e});